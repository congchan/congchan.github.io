<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Computer Science &amp; AI</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://shukebeta.me/"/>
  <updated>2019-02-18T15:53:39.800Z</updated>
  <id>http://shukebeta.me/</id>
  
  <author>
    <name>Cong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Transformer - è‡ªæ³¨æ„åŠ›æœºåˆ¶</title>
    <link href="http://shukebeta.me/NLP-attention-03-self-attention/"/>
    <id>http://shukebeta.me/NLP-attention-03-self-attention/</id>
    <published>2019-01-20T16:00:00.000Z</published>
    <updated>2019-02-18T15:53:39.800Z</updated>
    
    <content type="html"><![CDATA[<p>æ³¨æ„åŠ›æœºåˆ¶çš„åŸç†æ˜¯è®¡ç®—queryå’Œæ¯ä¸ªkeyä¹‹é—´çš„ç›¸ä¼¼æ€§$f_c(q,k_i)$ä»¥è·å¾—æ³¨æ„åŠ›åˆ†é…æƒé‡ã€‚åœ¨å¤§éƒ¨åˆ†NLPä»»åŠ¡ä¸­ï¼Œkeyä¸€èˆ¬ä¹Ÿæ˜¯valueã€‚<br><a id="more"></a></p><p>æ³¨æ„åŠ›æœºåˆ¶ä¸€èˆ¬æ˜¯ç”¨äºæå‡seq2seqæˆ–è€…encoder-decoderæ¶æ„çš„è¡¨ç°ã€‚ä½†è¿™ç¯‡2017 NIPSçš„æ–‡ç« <a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener">Attention is all you need</a>æå‡ºæˆ‘ä»¬å¯ä»¥ä»…ä¾èµ–æ³¨æ„åŠ›æœºåˆ¶å°±å¯ä»¥å®Œæˆå¾ˆå¤šä»»åŠ¡, å³æ‰€è°“è‡ªæ³¨æ„åŠ›æœºåˆ¶. ä¸è¿‡å»æµè¡Œçš„ä½¿ç”¨åŸºäºRNNçš„Seq2Seqæ¨¡å‹æ¡†æ¶ä¸åŒ:</p><ol><li>æ–‡ç« ä¸­ä½¿ç”¨æ³¨æ„æœºåˆ¶å®Œå…¨å–ä»£äº†RNNæ¥æ„å»ºæ•´ä¸ªæ¨¡å‹æ¡†æ¶ã€‚</li><li>Multi-Headed Attention Mechanism: åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¸­ä½¿ç”¨ Multi-Headed self-attentionã€‚</li><li>æ¯”LSTMæ›´å¿«çš„è®¡ç®—é€Ÿåº¦ã€‚</li></ol><p>æ–‡ç« çš„å®éªŒæ•°æ®æš‚ä¸”ä¸è®ºï¼Œå…¶æå‡ºçš„æ ¸å¿ƒæƒ³æ³•å¾ˆé‡è¦ï¼Œå°±æ˜¯LSTMè¿™ç§æ—¶åºæ¨¡å‹é€Ÿåº¦å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå¾ˆéš¾åº”ç”¨åˆ°è¶…å¤§è§„æ¨¡çš„æ•°æ®å’Œçº¿ä¸Šçš„åº”ç”¨ä¸­ã€‚Googleå› å…¶è‡ªèº«ä¸šåŠ¡çš„å¤§è§„æ¨¡æ€§è´¨ï¼Œæœ¬èº«æ˜¯å¾ˆå·¥ç¨‹åŒ–çš„ã€‚æ‰€ä»¥ä»–ä»¬éå¸¸åæ„Ÿéœ€è¦ç¹çç‰¹å¾æå–çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä»–ä»¬æ—©æ—©å°±è½¬æŠ•äº†ç¥ç»ç½‘ç»œã€‚ä¹Ÿéå¸¸ä¸çœ‹å¥½ç¹ççš„ç¥ç»ç½‘ç»œï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ— æ³•å¹¶è¡ŒåŒ–è®¡ç®—çš„ã€‚</p><p>è¿‘äº›å¹´æ¥ï¼ŒRNNï¼ˆåŠå…¶å˜ç§ LSTM, GRUï¼‰å·²æˆä¸ºå¾ˆå¤šnlpä»»åŠ¡å¦‚æœºå™¨ç¿»è¯‘çš„ç»å…¸ç½‘ç»œç»“æ„ã€‚RNNä»å·¦åˆ°å³æˆ–ä»å³åˆ°å·¦çš„æ–¹å¼é¡ºåºå¤„ç†è¯­è¨€ã€‚RNNçš„æŒ‰é¡ºåºå¤„ç†çš„æ€§è´¨ä¹Ÿä½¿å¾—å…¶æ›´éš¾ä»¥å……åˆ†åˆ©ç”¨ç°ä»£å¿«é€Ÿè®¡ç®—è®¾å¤‡ï¼Œä¾‹å¦‚GPUç­‰ä¼˜äºå¹¶è¡Œè€Œéé¡ºåºå¤„ç†çš„è®¡ç®—å•å…ƒã€‚è™½ç„¶å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰çš„æ—¶åºæ€§è¿œå°äºRNNï¼Œä½†CNNä½“ç³»ç»“æ„å¦‚ByteNetæˆ–ConvS2Sä¸­ï¼Œç³…åˆè¿œè·ç¦»éƒ¨åˆ†çš„ä¿¡æ¯æ‰€éœ€çš„æ­¥éª¤æ•°ä»éšç€è·ç¦»çš„å¢åŠ è€Œå¢é•¿ã€‚</p><p>å› ä¸ºä¸€æ¬¡å¤„ç†ä¸€ä¸ªå•è¯ï¼ŒRNNéœ€è¦å¤„ç†å¤šä¸ªæ—¶åºçš„å•è¯æ¥åšå‡ºä¾èµ–äºé•¿è¿œç¦»å•è¯çš„å†³å®šã€‚ä½†å„ç§ç ”ç©¶å’Œå®éªŒé€æ¸è¡¨æ˜ï¼Œå†³ç­–éœ€è¦çš„æ­¥éª¤è¶Šå¤šï¼Œå¾ªç¯ç½‘ç»œå°±è¶Šéš¾ä»¥å­¦ä¹ å¦‚ä½•åšå‡ºè¿™äº›å†³å®šã€‚è€Œæœ¬èº«LSTMå°±æ˜¯ä¸ºäº†è§£å†³long term dependencyé—®é¢˜ï¼Œä½†æ˜¯è§£å†³å¾—å¹¶ä¸å¥½ã€‚å¾ˆå¤šæ—¶å€™è¿˜éœ€è¦é¢å¤–åŠ ä¸€å±‚æ³¨æ„åŠ›å±‚æ¥å¤„ç†long term dependencyã€‚</p><p>æ‰€ä»¥è¿™æ¬¡ä»–ä»¬ç›´æ¥åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¹‹é—´ç›´æ¥ç”¨attentionï¼Œè¿™æ ·å¥å­å•è¯çš„ä¾èµ–é•¿åº¦æœ€å¤šåªæœ‰1ï¼Œå‡å°‘äº†ä¿¡æ¯ä¼ è¾“è·¯å¾„ã€‚ä»–ä»¬ç§°ä¹‹ä¸ºTransformerã€‚Transformeråªæ‰§è¡Œä¸€å°æ®µconstantçš„æ­¥éª¤ï¼ˆæ ¹æ®ç»éªŒé€‰æ‹©ï¼‰ã€‚åœ¨æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œåº”ç”¨self-attentionæœºåˆ¶ï¼Œç›´æ¥æ¨¡æ‹Ÿå¥å­ä¸­æ‰€æœ‰å•è¯ä¹‹é—´çš„å…³ç³»ï¼Œä¸ç®¡å®ƒä»¬ä¹‹é—´çš„ä½ç½®å¦‚ä½•ã€‚æ¯”å¦‚å­â€œI arrived at the bank after crossing the riverâ€ï¼Œè¦ç¡®å®šâ€œbankâ€ä¸€è¯æ˜¯æŒ‡æ²³å²¸è€Œä¸æ˜¯é‡‘èæœºæ„ï¼ŒTransformerå¯ä»¥å­¦ä¼šç«‹å³å…³æ³¨â€œriverâ€è¿™ä¸ªè¯å¹¶åœ¨ä¸€æ­¥ä¹‹å†…åšå‡ºè¿™ä¸ªå†³å®šã€‚</p><h3 id="Transformeræ€»ä½“æ¶æ„"><a href="#Transformeræ€»ä½“æ¶æ„" class="headerlink" title="Transformeræ€»ä½“æ¶æ„"></a>Transformeræ€»ä½“æ¶æ„</h3><p>Transformerä¹Ÿæ˜¯åŸºäºç¼–ç å™¨ï¼ˆè¯»å–è¾“å…¥å¥å­å¹¶ç”Ÿæˆå…¶è¡¨è¾¾ï¼‰-è§£ç å™¨ï¼ˆæŠŠæ–°è¡¨è¾¾è½¬æ¢ä¸ºç›®çš„è¯ï¼‰çš„æ¶æ„ã€‚å…·ä½“åœ°è¯´ï¼Œä¸ºäº†è®¡ç®—ç»™å®šå•è¯çš„ä¸‹ä¸€ä¸ªè¡¨ç¤º - ä¾‹å¦‚â€œbankâ€ - Transformerå°†å…¶ä¸å¥å­ä¸­çš„æ‰€æœ‰å…¶ä»–å•è¯è¿›è¡Œæ¯”è¾ƒã€‚è¿™äº›æ¯”è¾ƒçš„ç»“æœå°±æ˜¯å…¶ä»–å•è¯çš„æ³¨æ„åŠ›æƒé‡ã€‚è¿™äº›æ³¨æ„åŠ›æƒé‡å†³å®šäº†å…¶ä»–å•è¯åº”è¯¥ä¸ºâ€œbankâ€çš„ä¸‹ä¸€ä¸ªè¡¨è¾¾åšå‡ºå¤šå°‘è´¡çŒ®ã€‚åœ¨è®¡ç®—â€œbankâ€çš„æ–°è¡¨ç¤ºæ—¶ï¼Œèƒ½å¤Ÿæ¶ˆé™¤æ­§ä¹‰çš„â€œriverâ€å¯ä»¥è·å¾—æ›´é«˜çš„å…³æ³¨ã€‚å°†æ³¨æ„åŠ›æƒé‡ç”¨æ¥åŠ æƒå¹³å‡æ‰€æœ‰å•è¯çš„è¡¨è¾¾ï¼Œç„¶åå°†åŠ æƒå¹³å‡çš„è¡¨è¾¾å–‚ç»™ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œä»¥ç”Ÿæˆâ€œbankâ€çš„æ–°è¡¨è¾¾ï¼Œä»¥åæ˜ å‡ºè¯¥å¥å­æ­£åœ¨è°ˆè®ºçš„æ˜¯â€œæ²³å²¸â€ã€‚</p><p><img src="/images/transform20fps.gif" alt="" title="image from: https://ai.googleblog.com/2017/08/transformer-novel-neural-network.html"><br>Transformerçš„ç¼–ç é˜¶æ®µæ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼š</p><ol><li>é¦–å…ˆä¸ºæ¯ä¸ªå•è¯ç”Ÿæˆåˆå§‹è¡¨è¾¾æˆ–embeddingsã€‚è¿™äº›ç”±ç©ºå¿ƒåœ†è¡¨ç¤ºã€‚</li><li>ç„¶åï¼Œå¯¹äºæ¯ä¸€ä¸ªè¯, ä½¿ç”¨è‡ªæ³¨æ„åŠ›èšåˆæ¥è‡ªæ‰€æœ‰å…¶ä»–ä¸Šä¸‹æ–‡å•è¯çš„ä¿¡æ¯ï¼Œç”Ÿæˆå‚è€ƒäº†æ•´ä¸ªä¸Šä¸‹æ–‡çš„æ¯ä¸ªå•è¯çš„æ–°è¡¨è¾¾ï¼Œç”±å®å¿ƒçƒè¡¨ç¤ºã€‚å¹¶åŸºäºå‰é¢ç”Ÿæˆçš„è¡¨è¾¾, è¿ç»­åœ°æ„å»ºæ–°çš„è¡¨è¾¾ï¼ˆä¸‹ä¸€å±‚çš„å®å¿ƒåœ†ï¼‰å¯¹æ¯ä¸ªå•è¯å¹¶è¡Œåœ°é‡å¤å¤šæ¬¡è¿™ç§å¤„ç†ã€‚</li></ol><p>è§£ç å™¨æ“ä½œç±»ä¼¼ï¼Œåªæ˜¯ä»å·¦åˆ°å³ä¾æ¬¡ç”Ÿæˆä¸€ä¸ªå­—ã€‚å®ƒä¸ä»…å…³æ³¨å…ˆå‰ç”Ÿæˆçš„å•è¯ï¼Œè€Œä¸”è¿˜å‚è€ƒç¼–ç å™¨ç”Ÿæˆçš„æœ€ç»ˆè¡¨ç¤ºã€‚</p><p><img src="/images/transformer.png" alt="" title="å•å±‚ç¼–ç å™¨ï¼ˆå·¦ï¼‰å’Œè§£ç å™¨ï¼ˆå³ï¼‰ï¼Œç”± N = 6 ä¸ªç›¸åŒçš„å±‚æ„å»ºã€‚"><br><code>N = 6</code>å®é™…è¶…è¿‡6å±‚ã€‚è¿™äº›â€œå±‚â€ä¸­çš„æ¯ä¸€ä¸ªå®é™…ä¸Šç”±ä¸¤å±‚ç»„æˆï¼šposition-wise FNN å’Œä¸€ä¸ªï¼ˆç¼–ç å™¨ï¼‰ï¼Œæˆ–ä¸¤ä¸ªï¼ˆè§£ç å™¨ï¼‰ï¼ŒåŸºäºæ³¨æ„åŠ›çš„å­å±‚ã€‚å…¶ä¸­æ¯ä¸ªè¿˜åŒ…å«4ä¸ªçº¿æ€§æŠ•å½±å’Œæ³¨æ„é€»è¾‘ã€‚</p><p>ç¼–ç å™¨:</p><ol><li>Stage 1 - è¾“å…¥ç¼–ç : åºåˆ—çš„é¡ºåºä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„ã€‚ç”±äºæ²¡æœ‰å¾ªç¯ï¼Œä¹Ÿæ²¡æœ‰å·ç§¯ï¼Œå› æ­¤ä½¿ç”¨â€œä½ç½®ç¼–ç â€è¡¨ç¤ºåºåˆ—ä¸­æ¯ä¸ªæ ‡è®°çš„ç»å¯¹ï¼ˆæˆ–ç›¸å¯¹ï¼‰ä½ç½®çš„ä¿¡æ¯ã€‚<ul><li>positional encodings $\oplus$ embedded input</li></ul></li><li>Stage 2 â€“ Multi-head attention å’Œ Stage 3 â€“ position-wise FFN. ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯ç”¨æ¥æ®‹å·®è¿æ¥, æ¥ç€æ­£åˆ™åŒ–è¾“å‡ºå±‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Stage1_out = Embedding512 + TokenPositionEncoding512</span><br><span class="line">Stage2_out = layer_normalization(multihead_attention(Stage1_out) + Stage1_out)</span><br><span class="line">Stage3_out = layer_normalization(FFN(Stage2_out) + Stage2_out)</span><br><span class="line"></span><br><span class="line">out_enc = Stage3_out</span><br></pre></td></tr></table></figure><p>è§£ç å™¨çš„æ¶æ„ç±»ä¼¼ï¼Œä½†å®ƒåœ¨ç¬¬3é˜¶æ®µé‡‡ç”¨äº†é™„åŠ å±‚, åœ¨è¾“å‡ºå±‚ä¸Šçš„ mask multi-head attention:</p><ol><li>Stage 1 â€“ è¾“å…¥è§£ç : è¾“å…¥ output embeddingï¼Œåç§»ä¸€ä¸ªä½ç½®ä»¥ç¡®ä¿å¯¹ä½ç½®<code>i</code>çš„é¢„æµ‹ä»…å–å†³äº<code>&lt; i</code>çš„ä½ç½®ã€‚</li><li>Stage 2 - Masked Multi-head attention: éœ€è¦æœ‰ä¸€ä¸ªmaskæ¥é˜²æ­¢å½“å‰ä½ç½®<code>i</code>çš„ç”Ÿæˆä»»åŠ¡çœ‹åˆ°åç»­<code>&gt; i</code>ä½ç½®çš„ä¿¡æ¯ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsequent_mask</span><span class="params">(size)</span>:</span></span><br><span class="line">    <span class="string">"Mask out subsequent positions."</span></span><br><span class="line">    attn_shape = (<span class="number">1</span>, size, size)</span><br><span class="line">    subsequent_mask = np.triu(np.ones(attn_shape), k=<span class="number">1</span>).astype(<span class="string">'uint8'</span>)</span><br><span class="line">    <span class="keyword">return</span> torch.from_numpy(subsequent_mask) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # The attention mask shows the position each tgt word (row) is allowed to look at (column).</span></span><br><span class="line"><span class="comment"># Words are blocked for attending to future words during training.</span></span><br><span class="line">plt.figure(figsize=(<span class="number">5</span>,<span class="number">5</span>))</span><br><span class="line">plt.imshow(subsequent_mask(<span class="number">20</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure></li></ol><p><img src="http://nlp.seas.harvard.edu/images/the-annotated-transformer_31_0.png" alt=""></p><p>é˜¶æ®µ2,3å’Œ4åŒæ ·ä½¿ç”¨äº†æ®‹å·®è¿æ¥ï¼Œç„¶ååœ¨è¾“å‡ºä½¿ç”¨å½’ä¸€åŒ–å±‚ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Stage1_out = OutputEmbedding512 + TokenPositionEncoding512</span><br><span class="line"></span><br><span class="line">Stage2_Mask = masked_multihead_attention(Stage1_out)</span><br><span class="line">Stage2_Norm1 = layer_normalization(Stage2_Mask) + Stage1_out</span><br><span class="line">Stage2_Multi = multihead_attention(Stage2_Norm1 + out_enc) +  Stage2_Norm1</span><br><span class="line">Stage2_Norm2 = layer_normalization(Stage2_Multi) + Stage2_Multi</span><br><span class="line"></span><br><span class="line">Stage3_FNN = FNN(Stage2_Norm2)</span><br><span class="line">Stage3_Norm = layer_normalization(Stage3_FNN) + Stage2_Norm2</span><br><span class="line"></span><br><span class="line">out_dec = Stage3_Norm</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥åˆ©ç”¨å¼€æºçš„<a href="https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/models/transformer.py" target="_blank" rel="noopener">Tensor2Tensor</a>ï¼Œé€šè¿‡è°ƒç”¨å‡ ä¸ªå‘½ä»¤æ¥è®­ç»ƒTransformerç½‘ç»œè¿›è¡Œç¿»è¯‘å’Œè§£æã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒSAç®—æ³•è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå¤„ç†å…±æŒ‡æ¶ˆè§£ï¼ˆcoreference resolutionï¼‰ï¼Œä¾‹å¦‚å¥å­ä¸­çš„å•è¯â€œitâ€å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡å¼•ç”¨å¥å­çš„ä¸åŒåè¯ã€‚<img src="https://mchromiak.github.io/articles/2017/Sep/12/Transformer-Attention-is-all-you-need/img/CoreferenceResolution.png" alt="" title="Co-reference resolution. ä¸¤è¾¹çš„&quot;it&quot;æŒ‡å‘ä¸åŒçš„è¯. Adopted from Google Blog."></p><h3 id="å„ä¸ªæŠ€æœ¯ç»†èŠ‚"><a href="#å„ä¸ªæŠ€æœ¯ç»†èŠ‚" class="headerlink" title="å„ä¸ªæŠ€æœ¯ç»†èŠ‚"></a>å„ä¸ªæŠ€æœ¯ç»†èŠ‚</h3><h3 id="Multi-head-Attention"><a href="#Multi-head-Attention" class="headerlink" title="Multi-head Attention"></a>Multi-head Attention</h3><p>ä¼ ç»Ÿçš„Scaled Dot-Product Attention, valueç”±queryå’Œkeyçš„ç‚¹ç§¯æ±‚å¾—ã€‚ç‚¹ä¹˜$q \cdot  k = \sum_{i=1}^{d_k}q_i k_i$å¦‚æœæŒ‰ç…§æ¯”ä¾‹å› å­$1/\sqrt{d_k}$ç¼©æ”¾, å¯ä»¥è®¡ç®—å¾—æ›´å¿«æ›´çœç©ºé—´, å› ä¸ºä½¿ç”¨äº†ä¼˜åŒ–è¿‡çš„çŸ©é˜µä¹˜æ³•ä»£ç . (ç‰¹åˆ«æ˜¯å¯¹äºè¾ƒå¤§çš„$d_k$ï¼Œç‚¹ä¹˜ä¼šæ•°é‡çº§åœ°æ”¾å¤§, softmaxå¯èƒ½ä¼šè¢«æ¨åˆ°æ¢¯åº¦æ¶ˆå¤±åŒºåŸŸ, æ­¤æ—¶æ›´æ¨èç›¸åŠ å› å­)$$\begin{eqnarray} Attention (Q,K,V) = softmax \Big( \frac{QK^T}{\sqrt{d_k}} \Big) V \end{eqnarray}$$<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attention</span><span class="params">(query, key, value, mask=None, dropout=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">  <span class="string">"Compute 'Scaled Dot Product Attention'"</span></span><br><span class="line">  d_k = query.size(<span class="number">-1</span>)</span><br><span class="line">  scores = torch.matmul(query, key.transpose(<span class="number">-2</span>, <span class="number">-1</span>)) \</span><br><span class="line">           / math.sqrt(d_k)</span><br><span class="line">  <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">      scores = scores.masked_fill(mask == <span class="number">0</span>, <span class="number">-1e9</span>)</span><br><span class="line">  p_attn = F.softmax(scores, dim = <span class="number">-1</span>)</span><br><span class="line">  <span class="comment"># (Dropout described below)</span></span><br><span class="line">  p_attn = F.dropout(p_attn, p=dropout)</span><br><span class="line">  <span class="keyword">return</span> torch.matmul(p_attn, value), p_attn</span><br></pre></td></tr></table></figure></p><p>Transformerå°†å…³è”è¾“å…¥å’Œè¾“å‡ºåºåˆ—ä¸­çš„ï¼ˆç‰¹åˆ«æ˜¯è¿œç¨‹ï¼‰ä½ç½®çš„è®¡ç®—é‡å‡å°‘åˆ°$O(1)$ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä»¥é™ä½æœ‰æ•ˆåˆ†è¾¨ç‡ä¸ºä»£ä»·çš„ï¼Œå› ä¸ºæ³¨æ„åŠ›åŠ æƒä½ç½®è¢«å¹³å‡äº†ã€‚ä¸ºäº†å¼¥è¡¥è¿™ç§æŸå¤±, æ–‡ç« æå‡ºäº† Multi-head Attention:<img src="/images/multi_head_attention.png" alt="" title="Multi-Head Attention consists of h attention layers running in parallel. image from https://mchromiak.github.io/articles/2017/Sep/12/Transformer-Attention-is-all-you-need/#positional-encoding-pe"></p><ul><li>$h=8$ attention layers (â€œheadsâ€): å°†key $K$ å’Œ query $Q$ çº¿æ€§æŠ•å½±åˆ° $d_k$ ç»´åº¦, å°†value $V$ æŠ•å½±åˆ°$d_v$ç»´åº¦, (çº¿æ€§æŠ•å½±çš„ç›®çš„æ˜¯å‡å°‘ç»´åº¦) $$head_i = Attention(Q W^Q_i, K W^K_i, V W^V_i) , i=1,\dots,h$$ æŠ•å½±æ˜¯å‚æ•°çŸ©é˜µ$W^Q_i, W^K_i\in\mathbb{R}^{d_{model}\times d_k}, W^V_i\in\mathbb{R}^{d_{model}\times d_v}$ $d_k=d_v=d_{model}/h = 64$</li><li>æ¯å±‚å¹¶è¡Œåœ°åº”ç”¨ scaled-dot attention(ç”¨ä¸åŒçš„çº¿æ€§å˜æ¢), å¾—åˆ°$d_v$ç»´åº¦çš„è¾“å‡º</li><li>æŠŠæ¯ä¸€å±‚çš„è¾“å‡ºæ‹¼æ¥åœ¨ä¸€èµ· $Concat(head_1,\dots,head_h)$</li><li>å†çº¿æ€§å˜æ¢ä¸Šä¸€æ­¥çš„æ‹¼æ¥å‘é‡$MultiHeadAttention(Q,K,V) = Concat(head_1,\dots,head_h) W^O$, where $W^0\in\mathbb{R}^{d_{hd_v}\times d_{model}}$</li></ul><p>å› ä¸ºTransformeråªæ˜¯æŠŠåŸæ¥$d_{model}$ç»´åº¦çš„æ³¨æ„åŠ›å‡½æ•°è®¡ç®—å¹¶è¡Œåˆ†å‰²ä¸º$h$ä¸ªç‹¬ç«‹çš„$d_{model}/h$ç»´åº¦çš„head, æ‰€ä»¥è®¡ç®—é‡ç›¸å·®ä¸å¤§.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiHeadedAttention</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, h, d_model, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    <span class="string">"Take in model size and number of heads."</span></span><br><span class="line">    super(MultiHeadedAttention, self).__init__()</span><br><span class="line">    <span class="keyword">assert</span> d_model % h == <span class="number">0</span></span><br><span class="line">    <span class="comment"># We assume d_v always equals d_k</span></span><br><span class="line">    self.d_k = d_model // h</span><br><span class="line">    self.h = h</span><br><span class="line">    self.p = dropout</span><br><span class="line">    self.linears = clones(nn.Linear(d_model, d_model), <span class="number">4</span>)</span><br><span class="line">    self.attn = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, query, key, value, mask=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="comment"># Same mask applied to all h heads.</span></span><br><span class="line">      mask = mask.unsqueeze(<span class="number">1</span>)</span><br><span class="line">    nbatches = query.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1) Do all the linear projections in batch from d_model =&gt; h x d_k</span></span><br><span class="line">    query, key, value = [l(x).view(nbatches, <span class="number">-1</span>, self.h, self.d_k).transpose(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">                         <span class="keyword">for</span> l, x <span class="keyword">in</span> zip(self.linears, (query, key, value))]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2) Apply attention on all the projected vectors in batch.</span></span><br><span class="line">    x, self.attn = attention(query, key, value, mask=mask, dropout=self.p)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3) "Concat" using a view and apply a final linear.</span></span><br><span class="line">    x = x.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(nbatches, <span class="number">-1</span>, self.h * self.d_k)</span><br><span class="line">    <span class="keyword">return</span> self.linears[<span class="number">-1</span>](x)</span><br></pre></td></tr></table></figure></p><p>Transformerä»¥ä¸‰ç§ä¸åŒçš„æ–¹å¼ä½¿ç”¨Multi-head Attentionï¼š</p><ol><li>åœ¨<code>encoder-decoder attention</code>å±‚ä¸­ï¼Œ<code>queries</code>æ¥è‡ªå‰ä¸€å±‚decoderå±‚ï¼Œå¹¶ä¸” memory keys and values æ¥è‡ªencoderçš„è¾“å‡ºã€‚è¿™è®©decoderçš„æ¯ä¸ªä½ç½®éƒ½å¯ä»¥æ³¨æ„åˆ°è¾“å…¥åºåˆ—çš„æ‰€æœ‰ä½ç½®ã€‚è¿™å…¶å®è¿˜åŸäº†å…¸å‹çš„seq2seqæ¨¡å‹é‡Œå¸¸ç”¨çš„ç¼–ç å™¨ - è§£ç å™¨æ³¨æ„åŠ›æœºåˆ¶ï¼ˆä¾‹å¦‚<a href="https://arxiv.org/abs/1409.0473" target="_blank" rel="noopener">Bahdanau et al., 2014</a>æˆ–Conv2S2ï¼‰ã€‚</li><li>ç¼–ç å™¨æœ¬èº«ä¹ŸåŒ…å«äº†self-attention layersã€‚åœ¨self-attention layersä¸­ï¼Œæ‰€æœ‰ keys, values and queries æ¥è‡ªç›¸åŒçš„ä½ç½®ï¼Œåœ¨è¿™é‡Œæ˜¯ç¼–ç å™¨ä¸­å‰ä¸€å±‚çš„è¾“å‡ºã€‚è¿™æ ·ï¼Œç¼–ç å™¨çš„æ¯ä¸ªä½ç½®éƒ½å¯ä»¥æ³¨æ„åˆ°å‰ä¸€å±‚çš„æ‰€æœ‰ä½ç½®ã€‚</li><li>ç±»ä¼¼åœ°ï¼Œè§£ç å™¨ä¸­çš„ self-attention layers å…è®¸è§£ç å™¨çš„æ¯ä¸ªä½ç½®æ³¨æ„åˆ°è§£ç å™¨ä¸­åŒ…æ‹¬è¯¥ä½ç½®åœ¨å†…çš„æ‰€æœ‰å‰é¢çš„ä½ç½®ï¼ˆæœ‰maskå±è”½äº†åé¢çš„ä½ç½®ï¼‰ã€‚éœ€è¦é˜»æ­¢è§£ç å™¨ä¸­çš„å‘å·¦ä¿¡æ¯æµä»¥ä¿æŒ<code>è‡ªå›å½’</code>å±æ€§(auto-regressive å¯ä»¥ç®€å•ç†è§£ä¸ºæ—¶åºåºåˆ—çš„ç‰¹æ€§, åªèƒ½ä»å·¦åˆ°å³, ä»è¿‡å»åˆ°æœªæ¥)ã€‚æˆ‘ä»¬é€šè¿‡åœ¨scaled dot-product attentionå±‚ä¸­å±è”½ï¼ˆè®¾ç½®ä¸º-âˆï¼‰softmaxè¾“å…¥ä¸­ä¸éæ³•è¿æ¥ç›¸å¯¹åº”çš„æ‰€æœ‰å€¼æ¥ç»´æŒè¯¥ç‰¹æ€§ã€‚</li></ol><h3 id="Self-Attention-SA"><a href="#Self-Attention-SA" class="headerlink" title="Self-Attention (SA)"></a>Self-Attention (SA)</h3><p>åœ¨ç¼–ç å™¨ä¸­ï¼Œè‡ªæ³¨æ„åŠ›å±‚å¤„ç†æ¥è‡ªç›¸åŒä½ç½®çš„è¾“å…¥$queries, keys, value$ï¼Œå³ç¼–ç å™¨å‰ä¸€å±‚çš„è¾“å‡ºã€‚ç¼–ç å™¨ä¸­çš„æ¯ä¸ªä½ç½®éƒ½å¯ä»¥å…³æ³¨å‰ä¸€å±‚çš„æ‰€æœ‰ä½ç½®.</p><p>åœ¨è§£ç å™¨ä¸­ï¼ŒSAå±‚ä½¿æ¯ä¸ªä½ç½®èƒ½å¤Ÿå…³æ³¨è§£ç å™¨ä¸­å½“å‰åŠä¹‹å‰çš„æ‰€æœ‰ä½ç½®ã€‚ä¸ºäº†ä¿æŒ auto-regressive å±æ€§ï¼Œéœ€è¦é˜»æ­¢è§£ç å™¨ä¸­çš„å‘å·¦ä¿¡æ¯æµ, æ‰€ä»¥è¦åœ¨scaled dot-product attentionå±‚ä¸­å±è”½ï¼ˆè®¾ç½®ä¸º-âˆï¼‰softmaxè¾“å…¥ä¸­ä¸éæ³•è¿æ¥ç›¸å¯¹åº”çš„æ‰€æœ‰å€¼.</p><p>ä½œè€…ä½¿ç”¨SAå±‚è€Œä¸æ˜¯CNNæˆ–RNNå±‚çš„åŠ¨æœºæ˜¯:</p><ol><li>æœ€å°åŒ–æ¯å±‚çš„æ€»è®¡ç®—å¤æ‚åº¦: SAå±‚é€šè¿‡$O(1)$æ•°é‡çš„åºåˆ—æ“ä½œè¿æ¥æ‰€æœ‰ä½ç½®. ($O(n)$  in RNN)</li><li>æœ€å¤§åŒ–å¯å¹¶è¡ŒåŒ–è®¡ç®—ï¼šå¯¹äºåºåˆ—é•¿åº¦$n$ &lt; representation dimensionality $d$ï¼ˆå¯¹äºSOTAåºåˆ—è¡¨è¾¾æ¨¡å‹ï¼Œå¦‚word-piece, byte-pairï¼‰ã€‚å¯¹äºéå¸¸é•¿çš„åºåˆ—$n &gt; d$, SAå¯ä»¥ä»…è€ƒè™‘ä»¥ç›¸åº”è¾“å‡ºä½ç½®ä¸ºä¸­å¿ƒçš„è¾“å…¥åºåˆ—ä¸­çš„æŸä¸ªå¤§å°$r$çš„é‚»åŸŸï¼Œä»è€Œå°†æœ€å¤§è·¯å¾„é•¿åº¦å¢åŠ åˆ°$O(n/r)$</li><li>æœ€å°åŒ–ç”±ä¸åŒç±»å‹å±‚ç»„æˆçš„ç½‘ç»œä¸­ä»»æ„ä¸¤ä¸ªè¾“å…¥å’Œè¾“å‡ºä½ç½®ä¹‹é—´çš„æœ€å¤§è·¯å¾„é•¿åº¦ã€‚ä»»ä½•è¾“å…¥å’Œè¾“å‡ºåºåˆ—ä¸­çš„ä½ç½®ç»„åˆä¹‹é—´çš„è·¯å¾„è¶ŠçŸ­ï¼Œè¶Šå®¹æ˜“å­¦ä¹ é•¿è·ç¦»ä¾èµ–ã€‚</li></ol><h3 id="Position-wise-Feed-Forward-Networks"><a href="#Position-wise-Feed-Forward-Networks" class="headerlink" title="Position-wise Feed-Forward Networks"></a>Position-wise Feed-Forward Networks</h3><p>åœ¨ç¼–ç å™¨å’Œè§£ç å™¨ä¸­ï¼Œæ¯ä¸ªå±‚éƒ½åŒ…å«ä¸€ä¸ªå…¨è¿æ¥çš„å‰é¦ˆç½‘ç»œ(FFN)ï¼ŒFFN åˆ†åˆ«åº”ç”¨äºæ¯ä¸ªä½ç½®ï¼Œä½¿ç”¨ç›¸åŒçš„ä¸¤ä¸ªçº¿æ€§å˜æ¢å’Œä¸€ä¸ªReLU $$FFN(x) = max(0, xW_1+b_1) W_2 + b_2$$<br>è™½ç„¶çº¿æ€§å˜æ¢åœ¨ä¸åŒä½ç½®ä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†å®ƒä»¬åœ¨å±‚ä¸å±‚ä¹‹é—´ä½¿ç”¨ä¸åŒçš„å‚æ•°ã€‚å®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºä¸¤ä¸ªå†…æ ¸å¤§å°ä¸º1çš„å·ç§¯å±‚. è¾“å…¥/è¾“å‡ºç»´åº¦æ˜¯$d_{model}=512$, å†…å±‚çš„ç»´åº¦$d_{ff} = 2048$.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionwiseFeedForward</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">  <span class="string">"Implements FFN equation."</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, d_ff, dropout=<span class="number">0.1</span>)</span>:</span></span><br><span class="line">    super(PositionwiseFeedForward, self).__init__()</span><br><span class="line">    <span class="comment"># Torch linears have a `b` by default.</span></span><br><span class="line">    self.w_1 = nn.Linear(d_model, d_ff)</span><br><span class="line">    self.w_2 = nn.Linear(d_ff, d_model)</span><br><span class="line">    self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.w_2(self.dropout(F.relu(self.w_1(x))))</span><br></pre></td></tr></table></figure></p><h3 id="Positional-Encoding"><a href="#Positional-Encoding" class="headerlink" title="Positional Encoding"></a>Positional Encoding</h3><p>åœ¨è§£ç æ—¶åºä¿¡æ¯æ—¶ï¼ŒLSTMæ¨¡å‹é€šè¿‡è®©æ—¶é—´æ­¥çš„æ¦‚å¿µä»¥è¾“å…¥/è¾“å‡ºæµä¸€æ¬¡ä¸€ä¸ªçš„å½¢å¼ç¼–ç çš„. è€ŒTransformeré€‰æ‹©æŠŠæ—¶åºç¼–ç ä¸ºæ­£å¼¦æ³¢ã€‚è¿™äº›ä¿¡å·ä½œä¸ºé¢å¤–çš„ä¿¡æ¯åŠ å…¥åˆ°è¾“å…¥å’Œè¾“å‡ºä¸­ä»¥è¡¨è¾¾æ—¶é—´çš„æµé€.</p><p>è¿™ç§ç¼–ç ä½¿æ¨¡å‹èƒ½å¤Ÿæ„ŸçŸ¥åˆ°å½“å‰æ­£åœ¨å¤„ç†çš„æ˜¯è¾“å…¥ï¼ˆæˆ–è¾“å‡ºï¼‰åºåˆ—çš„å“ªä¸ªéƒ¨åˆ†ã€‚ä½ç½®ç¼–ç å¯ä»¥å­¦ä¹ æˆ–è€…ä½¿ç”¨å›ºå®šå‚æ•°ã€‚ä½œè€…è¿›è¡Œäº†æµ‹è¯•ï¼ˆPPLï¼ŒBLEUï¼‰ï¼Œæ˜¾ç¤ºä¸¤ç§æ–¹å¼è¡¨ç°ç›¸ä¼¼ã€‚æ–‡ä¸­ä½œè€…é€‰æ‹©ä½¿ç”¨å›ºå®šçš„ä½ç½®ç¼–ç å‚æ•°:$$ \begin{eqnarray} PE_{(pos,2i)} = sin(pos/10000^{2i/d_{model}}) \end{eqnarray} $$<br>$$ \begin{eqnarray} PE_{(pos,2i+1)} = cos(pos/10000^{2i/d_{model}})\end{eqnarray} $$ å…¶ä¸­$pos$æ˜¯ä½ç½®ï¼Œ$i$æ˜¯ç»´åº¦ã€‚<br>æ³¢é•¿å½¢æˆä»$2Ï€$åˆ°$10000 \dots 2Ï€$çš„å‡ ä½•çº§æ•°<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ç½®ç¼–ç çš„æ¯ä¸ªç»´åº¦å¯¹åº”äºæ­£å¼¦æ›²çº¿ã€‚æ³¢é•¿å½¢æˆä»2Ï€åˆ°10000â‹…2Ï€çš„å‡ ä½•çº§æ•°ã€‚é€‰æ‹©è¿™ä¸ªå‡½æ•°ï¼Œæ˜¯å› ä¸ºå‡è®¾å®ƒèƒ½è®©æ¨¡å‹å®¹æ˜“åœ°å­¦ä¹ ç›¸å¯¹ä½ç½®ï¼Œå› ä¸ºå¯¹äºä»»æ„å›ºå®šåç§»$k$ï¼Œ$PE_{pos + k}$å¯ä»¥è¡¨ç¤ºä¸º$PE_{pos}$çš„çº¿æ€§å‡½æ•°ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionalEncoding</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">  <span class="string">"Implement the PE function."</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, dropout, max_len=<span class="number">5000</span>)</span>:</span></span><br><span class="line">    super(PositionalEncoding, self).__init__()</span><br><span class="line">    self.dropout = nn.Dropout(p=dropout)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Compute the positional encodings once in log space.</span></span><br><span class="line">    pe = torch.zeros(max_len, d_model)</span><br><span class="line">    position = torch.arange(<span class="number">0</span>, max_len).unsqueeze(<span class="number">1</span>)</span><br><span class="line">    div_term = torch.exp(torch.arange(<span class="number">0</span>, d_model, <span class="number">2</span>) *</span><br><span class="line">                         -(math.log(<span class="number">10000.0</span>) / d_model))</span><br><span class="line">    pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(position * div_term)</span><br><span class="line">    pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(position * div_term)</span><br><span class="line">    pe = pe.unsqueeze(<span class="number">0</span>)</span><br><span class="line">    self.register_buffer(<span class="string">'pe'</span>, pe)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">    x = x + Variable(self.pe[:, :x.size(<span class="number">1</span>)], requires_grad=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span> self.dropout(x)</span><br></pre></td></tr></table></figure></p><p>ä½ç½®ç¼–ç å°†æ ¹æ®ä½ç½®æ·»åŠ æ­£å¼¦æ³¢ã€‚æ¯ä¸ªç»´åº¦çš„æ³¢çš„é¢‘ç‡å’Œåç§»æ˜¯ä¸åŒçš„ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">5</span>))</span><br><span class="line">pe = PositionalEncoding(<span class="number">20</span>, <span class="number">0</span>)</span><br><span class="line">y = pe.forward(Variable(torch.zeros(<span class="number">1</span>, <span class="number">100</span>, <span class="number">20</span>)))</span><br><span class="line">plt.plot(np.arange(<span class="number">100</span>), y[<span class="number">0</span>, :, <span class="number">4</span>:<span class="number">8</span>].data.numpy())</span><br><span class="line">plt.legend([<span class="string">"dim %d"</span>%p <span class="keyword">for</span> p <span class="keyword">in</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]])</span><br></pre></td></tr></table></figure></p><p><img src="http://nlp.seas.harvard.edu/images/the-annotated-transformer_49_0.png" alt=""></p><h3 id="Shared-Weight-Embeddings-and-Softmax"><a href="#Shared-Weight-Embeddings-and-Softmax" class="headerlink" title="Shared-Weight Embeddings and Softmax"></a>Shared-Weight Embeddings and Softmax</h3><p>ä¸å…¶ä»–åºåˆ—è½¬å¯¼æ¨¡å‹ç±»ä¼¼ï¼Œä½¿ç”¨å¯å­¦ä¹ çš„Embeddingså°† input tokens and output tokens è½¬æ¢ä¸ºç»´åº¦$d_{model}$çš„å‘é‡ã€‚é€šè¿‡çº¿æ€§å˜æ¢å’Œsoftmaxå‡½æ•°å°†è§£ç å™¨çš„è¾“å‡ºå‘é‡è½¬æ¢ä¸ºé¢„æµ‹çš„tokenæ¦‚ç‡ã€‚åœ¨Transformeræ¨¡å‹ä¸­ï¼Œä¸¤ä¸ªåµŒå…¥å±‚å’Œpre-softmaxçº¿æ€§å˜æ¢ä¹‹é—´å…±äº«ç›¸åŒçš„æƒé‡çŸ©é˜µï¼Œåœ¨Embeddingså±‚ä¸­ï¼Œå°†æƒé‡ä¹˜ä»¥$\sqrt{d_{\text{model}}}$. è¿™äº›éƒ½æ˜¯å½“å‰ä¸»æµçš„æ“ä½œã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨pytorchç‰ˆæœ¬çš„æ•™ç¨‹ä¸­æä¾›çš„èŒƒä¾‹</span></span><br><span class="line"><span class="comment"># http://nlp.seas.harvard.edu/2018/04/03/attention.html</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Embeddings</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, d_model, vocab)</span>:</span></span><br><span class="line">    super(Embeddings, self).__init__()</span><br><span class="line">    self.lut = nn.Embedding(vocab, d_model)</span><br><span class="line">    self.d_model = d_model</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.lut(x) * math.sqrt(self.d_model)</span><br></pre></td></tr></table></figure></p><h3 id="å¯å‘"><a href="#å¯å‘" class="headerlink" title="å¯å‘"></a>å¯å‘</h3><p>ä½œè€…å·²ç»è¿›è¡Œäº†ä¸€ç³»åˆ—æµ‹è¯•ï¼ˆè®ºæ–‡è¡¨3ï¼‰ï¼Œå…¶ä¸­ä»–ä»¬è®¨è®ºN = 6å±‚çš„å»ºè®®ï¼Œæ¨¡å‹å¤§å°ä¸º512ï¼ŒåŸºäºh = 8ä¸ªheadsï¼Œé”®å€¼ç»´åº¦ä¸º64ï¼Œä½¿ç”¨100Kæ­¥ã€‚</p><p>è¿˜æŒ‡å‡ºï¼Œç”±äºæ¨¡å‹è´¨é‡éšç€$d_k$ï¼ˆè¡ŒBï¼‰çš„å‡å°è€Œé™ä½ï¼Œå› æ­¤å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ç‚¹ç§¯å…¼å®¹æ€§åŠŸèƒ½ã€‚</p><p>å…¶å£°ç§°æå‡ºçš„å›ºå®šæ­£å¼¦ä½ç½®ç¼–ç ï¼Œä¸å­¦ä¹ åˆ°çš„ä½ç½®ç¼–ç ç›¸æ¯”ï¼Œäº§ç”Ÿå‡ ä¹ç›¸ç­‰çš„åˆ†æ•°ã€‚</p><h3 id="ç®—æ³•é€‚åˆå“ªäº›ç±»å‹çš„é—®é¢˜ï¼Ÿ"><a href="#ç®—æ³•é€‚åˆå“ªäº›ç±»å‹çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="ç®—æ³•é€‚åˆå“ªäº›ç±»å‹çš„é—®é¢˜ï¼Ÿ"></a>ç®—æ³•é€‚åˆå“ªäº›ç±»å‹çš„é—®é¢˜ï¼Ÿ</h3><ul><li>åºåˆ—è½¬å¯¼ï¼ˆè¯­è¨€ç¿»è¯‘ï¼‰</li><li>è¯­æ³•é€‰åŒºè§£æçš„ç»å…¸è¯­è¨€åˆ†æä»»åŠ¡ syntactic constituency parsing</li><li>å…±æŒ‡æ¶ˆè§£ coreference resolution</li></ul><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://research.googleblog.com/2017/08/transformer-novel-neural-network.html" target="_blank" rel="noopener">https://research.googleblog.com/2017/08/transformer-novel-neural-network.html</a><br><a href="https://research.googleblog.com/2017/06/accelerating-deep-learning-research.html" target="_blank" rel="noopener">https://research.googleblog.com/2017/06/accelerating-deep-learning-research.html</a><br><a href="https://mchromiak.github.io/articles/2017/Sep/12/Transformer-Attention-is-all-you-need/" target="_blank" rel="noopener">https://mchromiak.github.io/articles/2017/Sep/12/Transformer-Attention-is-all-you-need/</a><br><a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">http://nlp.seas.harvard.edu/2018/04/03/attention.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ³¨æ„åŠ›æœºåˆ¶çš„åŸç†æ˜¯è®¡ç®—queryå’Œæ¯ä¸ªkeyä¹‹é—´çš„ç›¸ä¼¼æ€§$f_c(q,k_i)$ä»¥è·å¾—æ³¨æ„åŠ›åˆ†é…æƒé‡ã€‚åœ¨å¤§éƒ¨åˆ†NLPä»»åŠ¡ä¸­ï¼Œkeyä¸€èˆ¬ä¹Ÿæ˜¯valueã€‚&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨äºæ–‡æœ¬åˆ†ç±»çš„ç¥ç»ç½‘ç»œå¼€æºå·¥å…·</title>
    <link href="http://shukebeta.me/NLP-text-classification/"/>
    <id>http://shukebeta.me/NLP-text-classification/</id>
    <published>2019-01-14T16:00:00.000Z</published>
    <updated>2019-03-14T16:03:56.027Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ–‡æœ¬åˆ†ç±»"><a href="#æ–‡æœ¬åˆ†ç±»" class="headerlink" title="æ–‡æœ¬åˆ†ç±»"></a>æ–‡æœ¬åˆ†ç±»</h2><p>æ–‡æœ¬åˆ†ç±»æ˜¯å¾ˆå¤šä¸šåŠ¡é—®é¢˜ä¸­å¹¿æ³›ä½¿ç”¨åˆ°çš„NLP/ç›‘ç£æœºå™¨å­¦ä¹ ï¼ˆMLï¼‰ã€‚æ–‡æœ¬åˆ†ç±»çš„ç›®æ ‡æ˜¯è‡ªåŠ¨å°†æ–‡æœ¬/æ–‡æ¡£åˆ†ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªé¢„å®šä¹‰ç±»åˆ«ã€‚ç›®å‰çš„æˆç†Ÿæ€è·¯æ˜¯ç”¨è¯å‘é‡è§£ç æ–‡æœ¬ï¼Œç„¶åä½¿ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹æˆ–è€…æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹æ¥åšåˆ†ç±»ã€‚</p><p>æ–‡æœ¬åˆ†ç±»æ˜¯å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œéå¸¸æ´»è·ƒçš„ç ”ç©¶é¢†åŸŸã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ç”¨äºæ–‡æœ¬åˆ†ç±»çš„å‡ ç§ç¥ç»ç½‘ç»œæ¨¡å‹æ–¹æ³•ï¼Œå¹¶æ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½ï¼Œä»£ç å®ç°ä¸»è¦åŸºäºKerasã€‚æ–‡ä¸­ä»£ç éƒ½åœ¨è¿™ä¸ª<a href="https://github.com/congchan/DeepText" target="_blank" rel="noopener">DeepText</a>GitHubé¡¹ç›®ä¸­.<br><a id="more"></a></p><p>æ–‡æœ¬åˆ†ç±»çš„ä¸€äº›ç¤ºä¾‹åŒ…æ‹¬ï¼š</p><ol><li>ä»ç¤¾äº¤åª’ä½“ä¸­äº†è§£å—ä¼—æƒ…ç»ªï¼ˆğŸ˜ ğŸ˜ ğŸ˜¥ï¼‰</li><li>æ£€æµ‹åƒåœ¾é‚®ä»¶å’Œéåƒåœ¾é‚®ä»¶</li><li>è‡ªåŠ¨æ ‡è®°å®¢æˆ·æŸ¥è¯¢</li><li>å°†æ–°é—»æ–‡ç« ğŸ“°åˆ†ç±»ä¸ºé¢„å®šä¹‰ä¸»é¢˜</li></ol><h2 id="ç«¯åˆ°ç«¯æ–‡æœ¬åˆ†ç±»æµæ°´çº¿"><a href="#ç«¯åˆ°ç«¯æ–‡æœ¬åˆ†ç±»æµæ°´çº¿" class="headerlink" title="ç«¯åˆ°ç«¯æ–‡æœ¬åˆ†ç±»æµæ°´çº¿"></a>ç«¯åˆ°ç«¯æ–‡æœ¬åˆ†ç±»æµæ°´çº¿</h2><p>ç«¯åˆ°ç«¯æ–‡æœ¬åˆ†ç±»æµæ°´çº¿ç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š</p><ol><li>è®­ç»ƒæ–‡æœ¬ï¼šè¾“å…¥æ–‡æœ¬ï¼Œæœ‰ç›‘ç£æ¨¡å‹èƒ½å¤Ÿé€šè¿‡å·²æ ‡æ³¨æ•°æ®æ¥å­¦ä¹ å’Œé¢„æµ‹æ‰€éœ€çš„ç±»ã€‚</li><li>ç‰¹å¾å‘é‡ï¼šç‰¹å¾å‘é‡æ˜¯ç”¨äºè§£ç è¾“å…¥æ•°æ®ç‰¹å¾çš„ä¿¡æ¯çš„å‘é‡ã€‚</li><li>æ ‡ç­¾ï¼šé¢„å®šä¹‰çš„ç±»åˆ«/ç±»ï¼Œä½œä¸ºæ¨¡å‹é¢„æµ‹çš„ç›®æ ‡ã€‚</li><li>ç®—æ³•æ¨¡å‹ï¼šèƒ½å¤Ÿå¤„ç†æ–‡æœ¬åˆ†ç±»çš„ç®—æ³•ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼šCNNï¼ŒRNNï¼ŒHAN, Fasttextï¼‰</li><li>é¢„æµ‹ï¼šå·²ç»åœ¨å†å²æ•°æ®é›†ä¸Šè®­ç»ƒè¿‡çš„æ¨¡å‹ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œæ ‡ç­¾é¢„æµ‹ã€‚</li></ol><p>è¿™é‡Œä½¿ç”¨æ±½è½¦æ¶ˆè´¹è€…çš„è¯„æµ‹æ•°æ®é›†ï¼Œåœ¨<code>tsv</code>æ–‡ä»¶ä¸­, ç¬¬ä¸€åˆ—æ˜¯åºå·å¯¹æˆ‘ä»¬æ²¡ç”¨, ç¬¬äºŒåˆ—æ˜¯<code>label(0, 1)</code>ï¼Œåˆ†åˆ«ä»£è¡¨<code>ï¼ˆæ¶ˆæï¼Œç§¯æï¼‰</code>è¯„ä»·ï¼Œç¬¬ä¸‰åˆ—æ˜¯æ–‡æœ¬.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1æ“æ§æ€§èˆ’æœã€æ²¹è€—ä½ï¼Œæ€§ä»·æ¯”é«˜</span><br><span class="line">0åŠ¨åŠ›çš„ç¡®æœ‰ç‚¹ç‚¹è®©æˆ‘ç›¸ä¿¡äº†upçš„ç¡®æ˜¯ä¸ªä»£æ­¥è½¦è€Œå·²!</span><br><span class="line">11ã€‚è½¦çš„å¤–è§‚å¾ˆå–œæ¬¢ã€‚2ã€‚çœæ²¹ï¼Œç°åœ¨ç£¨åˆæœŸ7.3ï¼Œç›¸ä¿¡ä»¥åè¿˜ä¼šä¸‹é™ã€‚</span><br><span class="line">1å†…é¥°çš„åšå·¥å’Œç”¨æ–™åŒçº§åˆ«åŒä»·ä½æœ€åšé“çš„</span><br><span class="line">0å‡éœ‡ç³»ç»Ÿå¤ªç¡¬ï¼</span><br></pre></td></tr></table></figure></p><p>æ•°æ®å¤„ç†ä½¿ç”¨çš„ç±»ï¼Œå…·ä½“è§<a href="https://github.com/congchan/DeepText/blob/a33fe1b8e895916b26bc658f0a02ac8253291d8a/data_process.py#L29" target="_blank" rel="noopener">ä»£ç é“¾æ¥</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcessor</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">""" Base class for data converters for sequence classification data sets.</span></span><br><span class="line"><span class="string">        helper funcitons [read_tsv, read_text, read_json]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleProcessor</span><span class="params">(DataProcessor)</span>:</span></span><br><span class="line">    <span class="string">""" Sample processor for the classification data set.</span></span><br><span class="line"><span class="string">        Tranform the text to tensor for training</span></span><br><span class="line"><span class="string">        if use pre-train model, need vocabulary file</span></span><br><span class="line"><span class="string">        usage:</span></span><br><span class="line"><span class="string">            process data files</span></span><br><span class="line"><span class="string">            &gt;&gt;&gt; processer = SampleProcessor(config, )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            provide your own data in list format [train_X, train_Y, test_X, test_Y]</span></span><br><span class="line"><span class="string">            &gt;&gt;&gt; processer = SampleProcessor(config, data)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br></pre></td></tr></table></figure></p><h3 id="è¯å‘é‡"><a href="#è¯å‘é‡" class="headerlink" title="è¯å‘é‡"></a>è¯å‘é‡</h3><p>ä½¿ç”¨åŒ…å«å¤–éƒ¨çŸ¥è¯†çš„embeddingè¡¨è¾¾å­—è¯æ˜¯ç›®å‰çš„ä¸»æµæ–¹æ³•ï¼Œç»å…¸çš„å¦‚word2vecï¼ŒGLoVeï¼Œè¾ƒæ–°è¿›çš„ ELMoï¼ŒBERTï¼Œç­‰é¢„è®­ç»ƒå‘é‡ï¼Œé›†æˆäº†å…³äºå•è¯çš„æ–°ä¿¡æ¯ï¼ˆè¯æ±‡å’Œè¯­ä¹‰ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å·²ç»åœ¨éå¸¸å¤§çš„æ•°æ®é›†ä¸Šè¿›è¡Œäº†è®­ç»ƒå’Œæç‚¼ã€‚</p><p>åœ¨è¿™é‡Œçš„æ¨¡å‹ï¼Œéƒ½å…è®¸æˆ‘ä»¬ç›´æ¥è½½å…¥å¤–éƒ¨çš„ embedding å‚æ•°ã€‚</p><p>ç‰¹åˆ«æ˜¯æä¾›äº†é€šè¿‡é¢„è®­ç»ƒçš„BERTè·å–ä¸­æ–‡å•è¯çš„å‘é‡è¡¨è¾¾çš„æ¥å£. æœ€å¥½æ˜¯ä½¿ç”¨åœ¨è‡ªå·±æ–‡æœ¬ä¸Šfine-tuneè¿‡çš„é¢„è®­ç»ƒBERTæ¨¡å‹.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_bert_embedding</span><span class="params">(vob_size, emb_size, word2id)</span>:</span></span><br><span class="line">    <span class="string">""" Get bert pre-trained representation,</span></span><br><span class="line"><span class="string">        for example, pre-trained chinese_L-12_H-768_A-12,</span></span><br><span class="line"><span class="string">            the hidden_size is 768</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> rep_matrix</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥ä½ çš„è¯æ±‡è¡¨, è¿”å›å„ä¸ªè¯æ±‡å¯¹åº”çš„å‘é‡, ä»¥è¯å…¸å½¢å¼è¿”å›. å†…éƒ¨çš„å·¥ä½œæœºåˆ¶æ˜¯æŠŠæ¯ä¸€ä¸ªå•è¯éƒ½ç”¨æ‹¼æ¥èµ·æ¥, ä¹‹é—´ç”¨BERTçš„å¥å­åˆ†éš”ç¬¦<code>[SEP]</code>éš”å¼€. åœ¨è¿”å›çš„token level çš„å‘é‡ä¸­é‡æ–°poolå‡ºå„ä¸ªè¯æ±‡çš„è¡¨è¾¾. è¿™ä¸ªæ–¹æ³•å…·ä½“çš„æ•ˆæœæœ‰å¾…éªŒè¯.</p><h3 id="Fasttextæ–‡æœ¬åˆ†ç±»"><a href="#Fasttextæ–‡æœ¬åˆ†ç±»" class="headerlink" title="Fasttextæ–‡æœ¬åˆ†ç±»"></a>Fasttextæ–‡æœ¬åˆ†ç±»</h3><p>Fasttext éå¸¸é€‚åˆå¤„ç†ä¸€äº›æ˜¾è€Œæ˜“è§ï¼Œä¸éœ€è¦æ¨ç†ï¼Œæƒ…å†µæ¯”è¾ƒå•çº¯çš„æ–‡æœ¬åˆ†ç±»é—®é¢˜ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªè¯è¢‹æ¨¡å‹ï¼ŒæŠŠæ–‡æœ¬æ‰€æœ‰å•è¯çš„å‘é‡poolåœ¨ä¸€èµ·ï¼Œå¾—å‡ºæ•´ä¸ªæ–‡æœ¬çš„å‘é‡è¡¨è¾¾ï¼Œè¿™ä¸ªæ–‡æœ¬å‘é‡ä½¿ç”¨softmaxåˆ†ç±»å™¨å¾—å‡ºä¸åŒæ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒã€‚ä¸ºäº†æ•æ‰è¯ä¹‹é—´çš„é¡ºåºï¼ŒfasttextåŠ å…¥äº†ngramç‰¹å¾ã€‚è¯¦ç»†æ¨èçœ‹è¿™ä¸¤ç¯‡æ–‡ç« </p><ol><li>Enriching Word Vectors with Subword Information, P. Bojanowski, E. Grave, A. Joulin, T. Mikolov</li><li>Bag of Tricks for Efficient Text Classification, A. Joulin, E. Grave, P. Bojanowski, T. Mikolov<br><img src="/images/fasttext.png" alt="" title="Image taken from the original paper"><br><a href="https://github.com/congchan/DeepText/blob/a33fe1b8e895916b26bc658f0a02ac8253291d8a/models.py#L133" target="_blank" rel="noopener">ä»£ç é“¾æ¥</a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fasttext</span><span class="params">(max_length, emb_size, max_words, class_num, pre_train_emb=None)</span>:</span></span><br><span class="line">  <span class="string">""" return single label classification fasttext model</span></span><br><span class="line"><span class="string">      paper: Bag of Tricks for Efficient Text Classification</span></span><br><span class="line"><span class="string">      The original paper use average pooling.</span></span><br><span class="line"><span class="string">      In many Kaggle application, Max Pooling is found to be useful</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  input = Input(shape=(max_length,), dtype=<span class="string">'int32'</span>, name=<span class="string">'input'</span>)</span><br><span class="line"></span><br><span class="line">  embeddings_initializer = <span class="string">'uniform'</span></span><br><span class="line">  <span class="keyword">if</span> pre_train_emb <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">      embeddings_initializer = initializers.Constant(pre_train_emb)</span><br><span class="line">  embed_input = Embedding(output_dim=emb_size, dtype=<span class="string">'float32'</span>, input_dim=max_words + <span class="number">1</span>,</span><br><span class="line">                          input_length=max_length,</span><br><span class="line">                          embeddings_initializer=embeddings_initializer,</span><br><span class="line">                          trainable=<span class="keyword">True</span></span><br><span class="line">                          )(input)</span><br><span class="line"></span><br><span class="line">  drop_out_input = Dropout(<span class="number">0.5</span>, name=<span class="string">'dropout_layer'</span>)(embed_input)</span><br><span class="line">  ave_pool = GlobalAveragePooling1D()(drop_out_input)</span><br><span class="line">  max_pool = GlobalMaxPooling1D()(drop_out_input)</span><br><span class="line">  concat_pool = concatenate([ave_pool, max_pool])</span><br><span class="line">  output = Dense(class_num, activation=<span class="string">'softmax'</span>, name=<span class="string">'output'</span>)(concat_pool)</span><br><span class="line">  model = Model(inputs=[input], outputs=output)</span><br><span class="line">  model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=<span class="string">'adam'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">  <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure></li></ol><p>å¯¹äºä¸­æ–‡æ–‡æœ¬ï¼Œå¦‚æœæ•°æ®é›†ä¸æ˜¯å¾ˆå¹²å‡€çš„è¯ï¼ˆæ¯”å¦‚æœ‰é”™åˆ«å­—ï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨ç‰¹æ®Šè¶…å‚çš„fasttextã€‚ä¸€èˆ¬æ¥è¯´fasttextåœ¨è‹±æ–‡ä¸­çš„<code>char+ngram</code>çš„çª—å£å¤§å°ä¸€èˆ¬å–å€¼<code>3 ~ 6</code>ï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸­æ–‡æ—¶ï¼Œä¸ºäº†å»é™¤è¾“å…¥ä¸­çš„å™ªå£°ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªçª—å£é™åˆ¶ä¸º<code>1~2</code>ï¼Œå› ä¸ºå°çª—å£æœ‰åˆ©äºæ¨¡å‹å»æ•è·<strong>é”™åˆ«å­—</strong>ï¼ˆé”™è¯¯è¯ä¸€èˆ¬éƒ½æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå­—è¡¨è¾¾æˆåŒéŸ³å¼‚å½¢çš„å¦ä¸€ä¸ªå­—ï¼‰ï¼Œæ¯”å¦‚å°ngramçª—å£fasttextå­¦å‡ºæ¥çš„<code>&quot;ä¼¼ä¹&quot;</code>è¿‘ä¼¼è¯å¾ˆæœ‰å¯èƒ½åŒ…å«<code>&quot;æ˜¯ä¹&quot;</code>ç­‰å†…éƒ¨åŒ…å«é”™åˆ«å­—çš„è¯ï¼Œè¿™æ ·ç­‰äºè®©fasttextæ‹¥æœ‰äº†è¯†åˆ«é”™åˆ«å­—çš„è¯çš„èƒ½åŠ›ã€‚</p><h3 id="å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ–‡æœ¬åˆ†ç±»"><a href="#å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ–‡æœ¬åˆ†ç±»" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ–‡æœ¬åˆ†ç±»"></a>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ–‡æœ¬åˆ†ç±»</h3><p>CNNé€šå¸¸ç”¨äºè®¡ç®—æœºè§†è§‰ï¼Œä½†å®ƒä»¬æœ€è¿‘å·²åº”ç”¨äºå„ç§NLPä»»åŠ¡ï¼Œç»“æœå¾ˆæœ‰å‰æ™¯ã€‚</p><p>ç®€è¦åœ°è¯´ï¼Œåœ¨æ–‡æœ¬æ•°æ®ä¸Šä½¿ç”¨CNNæ—¶ï¼Œå½“æ£€æµ‹åˆ°ç‰¹æ®Šçš„ patternï¼Œæ¯ä¸ªå·ç§¯çš„ç»“æœéƒ½å°†è§¦å‘ã€‚é€šè¿‡æ”¹å˜å†…æ ¸çš„å¤§å°å¹¶è¿æ¥å®ƒä»¬çš„è¾“å‡ºï¼Œä½ å¯ä»¥è‡ªå·±æ£€æµ‹å¤šä¸ªå¤§å°çš„æ¨¡å¼ï¼ˆ2, 3æˆ–5ä¸ªç›¸é‚»çš„å•è¯ï¼‰ã€‚Patterns å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼ˆå¦‚ ngramsï¼‰ï¼Œå› æ­¤CNNå¯ä»¥åœ¨å¥å­ä¸­è¯†åˆ«å®ƒä»¬è€Œä¸ç®¡å®ƒä»¬çš„ä½ç½®å¦‚ä½•ã€‚<br><img src="/images/textCNN.png" alt="" title="Image Reference : Understanding convolutional neural networks for nlp"></p><p>å‚æ•°ä½¿ç”¨ 128 ä¸ª filtersï¼Œå¤§å°ä»1åˆ°4ã€‚æ¨¡å‹æ¶æ„å¦‚å›¾<img src="/images/textCNNarch.png" alt="" title="reference from https://medium.com/jatana/report-on-text-classification-using-cnn-rnn-han-f0e887214d5f"><br><a href="https://github.com/congchan/DeepText/blob/a33fe1b8e895916b26bc658f0a02ac8253291d8a/models.py#L161" target="_blank" rel="noopener">ä»£ç é“¾æ¥</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_cnn</span><span class="params">(max_length, emb_size, max_words, class_num, pre_train_emb=None)</span>:</span></span><br><span class="line">  <span class="string">" textCNN model "</span></span><br><span class="line">  ...</span><br><span class="line">  cnn1_1    = Conv1D(<span class="number">128</span>, <span class="number">1</span>, padding=<span class="string">'same'</span>, strides=<span class="number">1</span>)(drop_out_layer)</span><br><span class="line">  ...</span><br><span class="line">  cnn1      = GlobalMaxPooling1D()(cnn1_2_at)</span><br><span class="line"></span><br><span class="line">  cnn2_1    = Conv1D(<span class="number">128</span>, <span class="number">2</span>, padding=<span class="string">'same'</span>, strides=<span class="number">1</span>)(drop_out_layer)</span><br><span class="line">  ...</span><br><span class="line">  cnn2      = GlobalMaxPooling1D()(cnn2_2_at)</span><br><span class="line"></span><br><span class="line">  cnn3_1    = Conv1D(<span class="number">128</span>, <span class="number">4</span>, padding=<span class="string">'same'</span>, strides=<span class="number">1</span>)(drop_out_layer)</span><br><span class="line">  ...</span><br><span class="line">  cnn3      = GlobalMaxPooling1D()(cnn3_2_at)</span><br><span class="line"></span><br><span class="line">  concat_cnn = concatenate([cnn1, cnn2, cnn3], axis=<span class="number">-1</span>)</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure></p><p>ç”¨äºtextçš„CNNä¸ä»…æ›´å®¹æ˜“å¹¶è¡ŒåŒ–è¿ç®—ï¼Œè€Œä¸”å¾ˆå®¹æ˜“æˆä¸ºä¸€ä¸ªæ•°æ®é›†ä¸Šçš„å¾ˆå¼ºçš„baselineï¼ˆé™¤éè¿™ä¸ªåˆ†ç±»ä»»åŠ¡å¾ˆéš¾ï¼‰ã€‚æ ¹æ®æ•°æ®çš„æƒ…å†µé€‰æ‹©æ¨¡å‹ï¼Œå¦‚æœngramç‰¹å¾å¾ˆé‡è¦ï¼Œä½¿ç”¨textCNNï¼Œå¦‚æœæ–‡æœ¬é•¿è·ç¦»ä¾èµ–æ¯”è¾ƒæ˜æ˜¾ï¼Œè€ƒè™‘ä½¿ç”¨RNNã€‚</p><h3 id="RNNç”¨äºæ–‡æœ¬åˆ†ç±»"><a href="#RNNç”¨äºæ–‡æœ¬åˆ†ç±»" class="headerlink" title="RNNç”¨äºæ–‡æœ¬åˆ†ç±»"></a>RNNç”¨äºæ–‡æœ¬åˆ†ç±»</h3><p>RNNç”¨äºæ–‡æœ¬åˆ†ç±»çš„è¯ï¼Œseq2one æ¶æ„ï¼ŒæŠŠä¸å®šé•¿åºåˆ—è§£ç ä¸ºå®šé•¿å‘é‡ï¼Œå†æŠŠè¿™ä¸ªè¾“å‡ºå‘é‡ç”¨softmaxå‡½æ•°è®¡ç®—å‡ºå„æ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒã€‚RNN(LSTM/GRU)å› ä¸ºå¤„ç†é•¿æ–‡æœ¬çš„èƒ½åŠ›è¾ƒå¼±ï¼Œç›®å‰ä¸€èˆ¬éœ€è¦åŠ ä¸Šæ³¨æ„åŠ›æœºåˆ¶ã€‚è¿™é‡Œæš‚æ—¶ç®€å•ç²—æš´çš„ç”¨åŒå‘GRUæ¥å®šä¹‰æ ¸å¿ƒçš„encoder.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_rnn</span><span class="params">(max_length, emb_size, max_words, class_num, pre_train_emb=None)</span>:</span></span><br><span class="line">    <span class="string">" Text RNN model using GRU cell"</span></span><br><span class="line">    <span class="keyword">return</span> _bilstm_attention(max_length, emb_size, max_words, class_num, <span class="keyword">False</span>, pre_train_emb)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text_rnn_attention</span><span class="params">(max_length, emb_size, max_words, class_num, pre_train_emb=None)</span>:</span></span><br><span class="line">  <span class="string">" Text RNN model using GRU cell with attention mechanism"</span></span><br><span class="line">  <span class="keyword">return</span> _bilstm_attention(max_length, emb_size, max_words, class_num, <span class="keyword">True</span>, pre_train_emb)</span><br></pre></td></tr></table></figure></p><h4 id="RCNN"><a href="#RCNN" class="headerlink" title="RCNN"></a>RCNN</h4><h3 id="Hierarchical-Attention-Network-HAN"><a href="#Hierarchical-Attention-Network-HAN" class="headerlink" title="Hierarchical Attention Network (HAN)"></a>Hierarchical Attention Network (HAN)</h3><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>Enriching Word Vectors with Subword Information, P. Bojanowski, E. Grave, A. Joulin, T. Mikolov<br>Bag of Tricks for Efficient Text Classification, A. Joulin, E. Grave, P. Bojanowski, T. Mikolov<br><a href="https://arxiv.org/abs/1408.5882" target="_blank" rel="noopener">https://arxiv.org/abs/1408.5882</a> Yoon Kim<br><a href="http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/" target="_blank" rel="noopener">http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/</a> by Denny Britz.<br>Understanding convolutional neural networks for nlp<br><a href="https://medium.com/jatana/report-on-text-classification-using-cnn-rnn-han-f0e887214d5f" target="_blank" rel="noopener">https://medium.com/jatana/report-on-text-classification-using-cnn-rnn-han-f0e887214d5f</a><br><a href="https://www.cs.cmu.edu/~diyiy/docs/naacl16.pdf" target="_blank" rel="noopener">Hierarchical Attention Networks for Document Classification </a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ–‡æœ¬åˆ†ç±»&quot;&gt;&lt;a href=&quot;#æ–‡æœ¬åˆ†ç±»&quot; class=&quot;headerlink&quot; title=&quot;æ–‡æœ¬åˆ†ç±»&quot;&gt;&lt;/a&gt;æ–‡æœ¬åˆ†ç±»&lt;/h2&gt;&lt;p&gt;æ–‡æœ¬åˆ†ç±»æ˜¯å¾ˆå¤šä¸šåŠ¡é—®é¢˜ä¸­å¹¿æ³›ä½¿ç”¨åˆ°çš„NLP/ç›‘ç£æœºå™¨å­¦ä¹ ï¼ˆMLï¼‰ã€‚æ–‡æœ¬åˆ†ç±»çš„ç›®æ ‡æ˜¯è‡ªåŠ¨å°†æ–‡æœ¬/æ–‡æ¡£åˆ†ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªé¢„å®šä¹‰ç±»åˆ«ã€‚ç›®å‰çš„æˆç†Ÿæ€è·¯æ˜¯ç”¨è¯å‘é‡è§£ç æ–‡æœ¬ï¼Œç„¶åä½¿ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹æˆ–è€…æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹æ¥åšåˆ†ç±»ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡æœ¬åˆ†ç±»æ˜¯å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œéå¸¸æ´»è·ƒçš„ç ”ç©¶é¢†åŸŸã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ç”¨äºæ–‡æœ¬åˆ†ç±»çš„å‡ ç§ç¥ç»ç½‘ç»œæ¨¡å‹æ–¹æ³•ï¼Œå¹¶æ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½ï¼Œä»£ç å®ç°ä¸»è¦åŸºäºKerasã€‚æ–‡ä¸­ä»£ç éƒ½åœ¨è¿™ä¸ª&lt;a href=&quot;https://github.com/congchan/DeepText&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DeepText&lt;/a&gt;GitHubé¡¹ç›®ä¸­.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>æ¦‚ç‡å›¾æ¨¡å‹ - æœ´ç´ è´å¶æ–¯ - éšé©¬å°”ç§‘å¤« - æ¡ä»¶éšæœºåœº - é€»è¾‘å›å½’</title>
    <link href="http://shukebeta.me/NLP-HMM-CRF/"/>
    <id>http://shukebeta.me/NLP-HMM-CRF/</id>
    <published>2018-12-15T16:00:00.000Z</published>
    <updated>2019-01-01T10:43:51.580Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰"><a href="#è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰" class="headerlink" title="è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰"></a>è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰</h2><p>POSä»»åŠ¡æ˜¯æŒ‡æ ¹æ®è§‚å¯Ÿå¾—åˆ°çš„åºåˆ—, æ¨æ–­å‡ºå¯¹åº”çš„è¯æ€§æ ‡æ³¨, æ¯”å¦‚<code>Bob drank coffee at Starbucks</code>, æ ‡æ³¨å¯èƒ½ä¸º<code>Bob (NOUN) drank (VERB) coffee (NOUN) at (PREPOSITION) Starbucks (NOUN)</code>.</p><p>é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰å‘½åå®ä½“è¯†åˆ«, ä»¥åŠå…¶ä»–æ¶‰åŠåˆ°éœ€è¦æ ¹æ®è§‚å¯Ÿåºåˆ—æ¨æ–­éšå«çŠ¶æ€çš„é—®é¢˜, éƒ½å¯ä»¥è€ƒè™‘ç”¨éšé©¬å°”å¯å¤«æ¨¡å‹(Hidden Markov Model, HMM)æˆ–è€…æ¡ä»¶éšæœºåœº(conditional random fields, CRF)æ¥å¤„ç†.</p><a id="more"></a><h2 id="æ¦‚ç‡å›¾æ¨¡å‹"><a href="#æ¦‚ç‡å›¾æ¨¡å‹" class="headerlink" title="æ¦‚ç‡å›¾æ¨¡å‹"></a>æ¦‚ç‡å›¾æ¨¡å‹</h2><p>Graphical Models, ç”¨å›¾çš„å½¢å¼è¡¨ç¤ºéšæœºå˜é‡ä¹‹é—´æ¡ä»¶ä¾èµ–å…³ç³»çš„æ¦‚ç‡æ¨¡å‹ï¼Œæ˜¯æ¦‚ç‡è®ºä¸å›¾è®ºçš„ç»“åˆã€‚å›¾ä¸­çš„èŠ‚ç‚¹è¡¨ç¤ºéšæœºå˜é‡ï¼Œç¼ºå°‘è¾¹è¡¨ç¤ºæ¡ä»¶ç‹¬ç«‹å‡è®¾ã€‚<br>G = (V, E). å…¶ä¸­ V: vertex, é¡¶ç‚¹/èŠ‚ç‚¹, è¡¨ç¤ºéšæœºå˜é‡. E: edge, è¾¹/å¼§. å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ä¸å­˜åœ¨è¾¹, åˆ™äºŒè€…æ¡ä»¶ç‹¬ç«‹.<br><img src="/images/probabilistic_graphical_models.png" alt="" title="image from: Probabilistic Graphical Models Principles and Techniques"><br>ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°, è´å¶æ–¯ç½‘ç»œ(Bayesian Networks, BNs)æ˜¯æœ‰å‘å›¾, æ¯ä¸ªèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒè¡¨ç¤ºä¸º<code>P(å½“å‰èŠ‚ç‚¹ | çˆ¶èŠ‚ç‚¹)</code>.</p><p>è€Œé©¬å°”å¯å¤«ç½‘ç»œåˆ™æ˜¯æ— å‘å›¾, åŒ…å«äº†ä¸€ç»„å…·æœ‰é©¬å°”å¯å¤«æ€§è´¨çš„éšæœºå˜é‡. é©¬å°”å¯å¤«éšæœºåœº(Markov Random Fields, MRF)æ˜¯ç”±å‚æ•°$Î»=(S, Ï€, A)$è¡¨ç¤º, å…¶ä¸­Sæ˜¯çŠ¶æ€çš„é›†åˆï¼ŒÏ€æ˜¯åˆå§‹çŠ¶æ€çš„æ¦‚ç‡, Aæ˜¯çŠ¶æ€é—´çš„è½¬ç§»æ¦‚ç‡ã€‚ä¸€é˜¶é©¬å°”å¯å¤«é“¾å°±æ˜¯å‡è®¾tæ—¶åˆ»çš„çŠ¶æ€åªä¾èµ–äºå‰ä¸€æ—¶åˆ»çš„çŠ¶æ€ï¼Œä¸å…¶ä»–æ—¶åˆ»çš„çŠ¶æ€å’Œè§‚æµ‹æ— å…³ã€‚è¿™ä¸ªæ€§è´¨å¯ä»¥ç”¨äºç®€åŒ–æ¦‚ç‡é“¾çš„è®¡ç®—ã€‚ä½¿ç”¨ç±»ä¼¼æ€§è´¨ä½œä¸ºå‡è®¾çš„æ¨¡å‹è¿˜æœ‰Bi-gramè¯­è¨€æ¨¡å‹ç­‰.</p><h3 id="æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä¸éšé©¬å°”å¯å¤«æ¨¡å‹"><a href="#æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä¸éšé©¬å°”å¯å¤«æ¨¡å‹" class="headerlink" title="æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä¸éšé©¬å°”å¯å¤«æ¨¡å‹"></a>æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ä¸éšé©¬å°”å¯å¤«æ¨¡å‹</h3><p>æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨(NBs)å‡è®¾æ¡ä»¶ç‹¬ç«‹æ€§(æœ´ç´ è´å¶æ–¯å‡è®¾, Hand and Yu, 2001)ï¼š$p(x_i | y, x_j) = p(x_i | y)$, åœ¨ç»™å®šç›®æ ‡å€¼ y æ—¶ï¼Œxçš„å±æ€§å€¼ä¹‹é—´ç›¸äº’æ¡ä»¶ç‹¬ç«‹ã€‚è¿™æ ·, è®¡ç®—å¯ä»¥ç®€åŒ–ä¸º $$p(y | \overrightarrow{x}) \propto p(y, \overrightarrow{x}) = p(y) \prod_{i=1} p(x_i | y).$$</p><p>æœ´ç´ è´å¶æ–¯æ¨¡å‹åªè€ƒè™‘äº†å•ä¸ªè¾“å‡ºå˜é‡yã€‚å¦‚æœè¦ä¸ºä¸€ä¸ªè§‚å¯Ÿåºåˆ—$\overrightarrow{x} =(x_1, â€¦, x_n)$é¢„æµ‹å¯¹åº”çš„åˆ†ç±»åºåˆ—$\overrightarrow{y} =ï¼ˆy_1, â€¦, y_n)$ ï¼Œä¸€ä¸ªç®€å•çš„åºåˆ—æ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºå¤šä¸ªNBsçš„ä¹˜ç§¯ã€‚æ­¤æ—¶ä¸è€ƒè™‘åºåˆ—å•ä¸ªä½ç½®ä¹‹é—´çš„ç›¸äº’ä¾èµ–ã€‚$$p(\overrightarrow{y}, \overrightarrow{x}) = \prod^n_{i=1} p(y_i) p(x_i | y_i).$$<br>æ­¤æ—¶æ¯ä¸ªè§‚å¯Ÿå€¼$x_i$ä»…å–å†³äºå¯¹åº”åºåˆ—ä½ç½®çš„ç±»å˜é‡$y_i$ã€‚ç”±äºè¿™ç§ç‹¬ç«‹æ€§å‡è®¾ï¼Œä»ä¸€ä¸ªæ­¥éª¤åˆ°å¦ä¸€ä¸ªæ­¥éª¤çš„è½¬æ¢æ¦‚ç‡ä¸åŒ…æ‹¬åœ¨è¯¥æ¨¡å‹ä¸­ã€‚ç„¶è€Œè¿™ç§å‡è®¾åœ¨å®è·µä¸­å‡ ä¹ä¸ä¼šç¬¦åˆï¼Œè¿™å¯¼è‡´è¿™ç§æ¨¡å‹çš„æ€§èƒ½å¾ˆæœ‰é™ã€‚</p><p>å› æ­¤ï¼Œæ¯”è¾ƒåˆç†çš„å‡è®¾æ˜¯è§‚æµ‹åºåˆ—åœ¨è¿ç»­ç›¸é‚»ä½ç½®é—´çš„è§‚æµ‹å€¼å­˜åœ¨ä¾èµ–ã€‚è¦æ¨¡æ‹Ÿè¿™ç§ä¾èµ–å…³ç³», å°±è¦å¼•å…¥çŠ¶æ€è½¬ç§»æ¦‚ç‡$p(y_i | y_{i-1})$, ç”±æ­¤å¼•å‡ºè‘—åçš„éšé©¬å°”å¯å¤«æ¨¡å‹ Hidden Markov model, HMM, Rabiner (1989):<br>$$p(\overrightarrow{y}, \overrightarrow{x}) = \prod^n_{i=1} p(y_i | y_{i-1}) p(x_i | y_i).$$ $$p(\overrightarrow{x}) = \sum_{y\in \mathcal{Y}} \prod^n_{i=1} p(y_i | y_{i-1}) p(x_i | y_i).$$</p><p>HMMå‚æ•°$Î» = (Y, X, Ï€, A, B)$ ï¼Œå…¶ä¸­Yæ˜¯éšçŠ¶æ€ï¼ˆè¾“å‡ºå˜é‡ï¼‰çš„é›†åˆï¼ŒXæ˜¯è§‚å¯Ÿå€¼ï¼ˆè¾“å…¥ï¼‰é›†åˆï¼ŒÏ€æ˜¯åˆå§‹çŠ¶æ€çš„æ¦‚ç‡ï¼ŒAæ˜¯çŠ¶æ€è½¬ç§»æ¦‚ç‡çŸ©é˜µ$p(y_i | y_{i-1})$ï¼ŒBæ˜¯è¾“å‡ºè§‚å¯Ÿå€¼æ¦‚ç‡çŸ©é˜µ$p(x_i | y_{i})$ã€‚åœ¨POSä»»åŠ¡ä¸­, Xå°±æ˜¯è§‚å¯Ÿåˆ°çš„å¥å­, Yå°±æ˜¯å¾…æ¨å¯¼çš„æ ‡æ³¨åºåˆ—, å› ä¸ºè¯æ€§å¾…æ±‚çš„, æ‰€ä»¥äººä»¬ç§°ä¹‹ä¸º<strong>éšå«çŠ¶æ€</strong>.</p><p>HMMçš„ç¼ºé™·æ˜¯å…¶åŸºäºè§‚å¯Ÿåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ç›¸äº’æ¡ä»¶ç‹¬ç«‹çš„å‡è®¾ã€‚å³åœ¨ä»»ä½•æ—¶åˆ»è§‚å¯Ÿå€¼ä»…ä»…ä¸çŠ¶æ€ï¼ˆå³è¦æ ‡æ³¨çš„æ ‡ç­¾ï¼‰æœ‰å…³ã€‚å¯¹äºç®€å•çš„æ•°æ®é›†ï¼Œè¿™ä¸ªå‡è®¾å€’æ˜¯åˆç†ã€‚ä½†å¤§å¤šæ•°ç°å®ä¸–ç•Œä¸­çš„çœŸå®è§‚å¯Ÿåºåˆ—æ˜¯ç”±å¤šä¸ªç›¸äº’ä½œç”¨çš„ç‰¹å¾å’Œè§‚å¯Ÿåºåˆ—ä¸­è¾ƒé•¿èŒƒå›´å†…çš„å…ƒç´ ä¹‹é—´çš„ä¾èµ–è€Œå½¢æˆçš„ã€‚è€Œæ¡ä»¶éšæœºåœº(conditional random fiel, CRF)æ°æ°å°±å¼¥è¡¥äº†è¿™ä¸ªç¼ºé™·.</p><h2 id="æ¡ä»¶éšæœºåœº"><a href="#æ¡ä»¶éšæœºåœº" class="headerlink" title="æ¡ä»¶éšæœºåœº"></a>æ¡ä»¶éšæœºåœº</h2><p>éšæœºåœº, å¯ä»¥çœ‹æˆæ˜¯ä¸€ç»„éšæœºå˜é‡çš„é›†åˆï¼ˆè¿™ç»„éšæœºå˜é‡å¯¹åº”åŒä¸€ä¸ªæ ·æœ¬ç©ºé—´ï¼‰ã€‚å½“ç»™æ¯ä¸€ä¸ªä½ç½®æŒ‰ç…§æŸç§åˆ†å¸ƒéšæœºèµ‹äºˆä¸€ä¸ªå€¼ä¹‹åï¼Œå…¶å…¨ä½“å°±å«åšéšæœºåœºã€‚è¿™äº›éšæœºå˜é‡ä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿåªæœ‰å½“è¿™äº›å˜<br>é‡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†å…¶å•ç‹¬æ‹¿å‡ºæ¥çœ‹æˆä¸€ä¸ªéšæœºåœºæ‰æœ‰å®é™…æ„ä¹‰ã€‚</p><p>å¦‚æœç»™å®šçš„MRFä¸­æ¯ä¸ªéšæœºå˜é‡ä¸‹é¢è¿˜æœ‰è§‚å¯Ÿå€¼ï¼Œæˆ‘ä»¬è¦ç¡®å®šçš„æ˜¯ç»™å®šè§‚å¯Ÿé›†åˆä¸‹ï¼Œè¿™ä¸ªMRFçš„åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯æ¡ä»¶åˆ†å¸ƒï¼Œé‚£ä¹ˆè¿™ä¸ªMRFå°±ç§°ä¸º conditional random fields (CRF)ã€‚å®ƒçš„æ¡ä»¶åˆ†å¸ƒå½¢å¼å®Œå…¨ç±»ä¼¼äºMRFçš„åˆ†å¸ƒå½¢å¼ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªè§‚å¯Ÿé›†åˆXã€‚æ‰€ä»¥, CRFæœ¬è´¨ä¸Šæ˜¯ç»™å®šäº†æ¡ä»¶(è§‚å¯Ÿå€¼observations)é›†åˆçš„MRF</p><p>1.ç‰¹å¾å‡½æ•°çš„é€‰æ‹©: ç‰¹å¾å‡½æ•°çš„é€‰å–ç›´æ¥å…³ç³»æ¨¡å‹çš„æ€§èƒ½ã€‚<br>2.å‚æ•°ä¼°è®¡: ä»å·²ç»æ ‡æ³¨å¥½çš„è®­ç»ƒæ•°æ®é›†å­¦ä¹ æ¡ä»¶éšæœºåœºæ¨¡å‹çš„å‚æ•°ï¼Œå³å„ç‰¹å¾å‡½æ•°çš„æƒé‡å‘é‡Î»ã€‚<br>3.æ¨¡å‹æ¨æ–­: åœ¨ç»™å®šæ¡ä»¶éšæœºåœºæ¨¡å‹å‚æ•°Î»ä¸‹ï¼Œé¢„æµ‹å‡ºæœ€å¯èƒ½çš„çŠ¶æ€åºåˆ—ã€‚</p><h3 id="CRFç‰¹å¾å‡½æ•°"><a href="#CRFç‰¹å¾å‡½æ•°" class="headerlink" title="CRFç‰¹å¾å‡½æ•°"></a>CRFç‰¹å¾å‡½æ•°</h3><p>åœ¨CRFä¸­ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰ç‰¹å¾å‡½æ•°. ç‰¹å¾å‡½æ•°çš„å®šä¹‰éå¸¸çµæ´», å¯ä»¥æ˜¯ï¼š</p><ol><li>ä¸€ä¸ªå¥å­ s</li><li>å¥å­ä¸­å•è¯çš„ä½ç½® i</li><li>å½“å‰å•è¯çš„æ ‡ç­¾$l_i$</li><li>å‰ä¸€ä¸ªå•è¯çš„æ ‡ç­¾$l_{i-1}$ (å¦‚æœä»…é™äºç›¸é‚»ä½ç½®çš„å•è¯, é‚£ä¹ˆå°±æ˜¯ linear-chain CRF).</li><li>ä»»æ„å…¶ä»–å•è¯çš„æ ‡ç­¾$l_{j}$</li></ol><p>ç„¶åä¸ºæ¯ä¸ªç‰¹å¾å‡½æ•°$f_{j}$åˆ†é…æƒé‡$\lambda_j$, æƒé‡æ˜¯ä»æ•°æ®ä¸­å­¦ä¹ è€Œæ¥. å¯¹$j$ä¸ªç‰¹å¾æ–¹ç¨‹æ±‚å’Œ, å¯¹åºåˆ—æ¯ä¸ªä½ç½®$i$æ±‚å’Œ:<br>$$ score(l | s) = \sum_{j = 1}^m \sum_{i = 1}^n \lambda_j f_j(s, i, l_i, l_{i-1})$$<br>CRFçš„æ¯ä¸ªç‰¹å¾å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªè¾“å…¥çš„å‡½æ•°, å¯¹åº”çš„è¾“å‡ºæ˜¯ä¸€ä¸ªå®æ•°å€¼ï¼ˆåªæ˜¯0æˆ–1ï¼‰ã€‚ä¾‹å¦‚, é€‰æ‹©ç‰¹å¾å‡½æ•°$f_1(s, i, l_i, l_{i-1}) = 1$, å½“ä¸”ä»…å½“$l_i = ADVERB$, ä¸”ç¬¬iä¸ªå•è¯ä»¥â€œ<code>-ly</code>â€ç»“å°¾; å¦åˆ™ä¸º0. å¦‚æœä¸æ­¤ç‰¹å¾ç›¸å…³çš„æƒé‡$\lambda_j$å¾ˆå¤§ä¸”ä¸ºæ­£ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹å¾ç­‰åŒäºè¯´æ¨¡å‹å€¾å‘äºæŠŠä»¥<code>-ly</code>ç»“å°¾çš„å•è¯æ ‡è®°ä¸ºADVERBã€‚</p><p>é€šè¿‡æŒ‡æ•°åŒ–å’Œå½’ä¸€åŒ–æŠŠè¿™äº›å¾—åˆ†è½¬æ¢ä¸ºæ¦‚ç‡å€¼:<br>$$p(l | s) = \frac{exp[score(l|s)]}{\sum_{l^\prime} exp[score(l^\prime|s)]} = \frac{exp[\sum_{j = 1}^m \sum_{i = 1}^n \lambda_j f_j(s, i, l_i, l_{i-1})]}{\sum_{lâ€™} exp[\sum_{j = 1}^m \sum_{i = 1}^n \lambda_j f_j(s, i, l^\prime_i, l^\prime_{i-1})]} $$</p><h3 id="CRFä¸HMM"><a href="#CRFä¸HMM" class="headerlink" title="CRFä¸HMM"></a>CRFä¸HMM</h3><p>åªéœ€è¦åœ¨CRFçš„å¯¹æ•°çº¿æ€§å½¢å¼ä¸­, è®¾ç½®æƒé‡ä¸ºå¯¹åº”HMMå–å¯¹æ•°åçš„äºŒå…ƒè½¬æ¢å’Œå‘å°„æ¦‚ç‡: $\log p(l,s) = \log p(l_0) + \sum_i \log p(l_i | l_{i-1}) + \sum_i \log p(w_i | l_i)$</p><ul><li>å¯¹äºHMMçš„æ¯ä¸ªçŠ¶æ€è½¬æ¢æ¦‚ç‡$p(l_i = y | l_{i-1} = x)$, CRFå®šä¹‰ä¸€ç»„ç‰¹å¾å‡½æ•°ä¸º$f_{x,y}(s, i, l_i, l_{i-1}) = 1$ å¦‚æœ $l_i = y$ ä¸” $l_{i-1} = x$, ä¸ºè¿™äº›ç‰¹å¾èµ‹äºˆæƒé‡$w_{x,y} = \log p(l_i = y | l_{i-1} = x)$</li><li>ç±»ä¼¼çš„, å¯¹äºHMMçš„æ¯ä¸ªå‘å°„æ¦‚ç‡$p(w_i = z | l_{i} = x)$, CRFå®šä¹‰ä¸€ç»„ç‰¹å¾å‡½æ•°ä¸º$g_{x,y}(s, i, l_i, l_{i-1}) = 1$ å¦‚æœ $w_i = z$ ä¸” $l_i = x$, èµ‹äºˆæƒé‡$w_{x,z} = \log p(w_i = z | l_i = x)$.</li></ul><p>å¦‚æ­¤, CRFè®¡ç®—çš„åˆ†å€¼$p(l|s)$å°±ç²¾ç¡®åœ°æ­£æ¯”äºå¯¹åº”çš„HMM, ä¹Ÿå°±æ˜¯è¯´, ä»»æ„çš„HMMéƒ½å¯ä»¥ç”±CRFè¡¨è¾¾å‡ºæ¥.</p><p>CRFæ¯”HMMæ›´å¼ºå¤§, æ›´å¹¿æ³›</p><ol><li>CRFå¯ä»¥å®šä¹‰æ›´å¹¿æ³›çš„ç‰¹å¾å‡½æ•°ï¼šHMMå—é™äºç›¸é‚»ä½ç½®çš„çŠ¶æ€è½¬æ¢ï¼ˆäºŒå…ƒè½¬æ¢ï¼‰å’Œå‘å°„æ¦‚ç‡å‡½æ•°ï¼Œè¿«ä½¿æ¯ä¸ªå•è¯ä»…ä¾èµ–äºå½“å‰æ ‡ç­¾ï¼Œå¹¶ä¸”æ¯ä¸ªæ ‡ç­¾ä»…ä¾èµ–äºå‰ä¸€ä¸ªæ ‡ç­¾ã€‚è€ŒCRFå¯ä»¥ä½¿ç”¨æ›´å¤šæ ·çš„å…¨å±€ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¥å­çš„ç»“å°¾åŒ…å«é—®å·ï¼Œåˆ™å¯ä»¥ç»™ç»™CRFæ¨¡å‹å¢åŠ ä¸€ä¸ªç‰¹å¾å‡½æ•°ï¼Œè®°å½•æ­¤æ—¶å°†å¥å­çš„ç¬¬ä¸€ä¸ªå•è¯æ ‡è®°ä¸ºVERBçš„æ¦‚ç‡ã€‚è¿™ä½¿å¾—CRFå¯ä»¥ä½¿ç”¨é•¿è·ç¦»ä¾èµ–çš„ç‰¹å¾ã€‚</li><li>CRFå¯ä»¥æœ‰ä»»æ„çš„æƒé‡å€¼ï¼šHMMçš„æ¦‚ç‡å€¼å¿…é¡»æ»¡è¶³ç‰¹å®šçš„çº¦æŸï¼Œ $0 &lt;= p(w_i | l_i) &lt;= 1, \sum_w p(w_i = w | l_1) = 1)$, è€ŒCRFçš„æƒé‡å€¼æ˜¯ä¸å—é™åˆ¶çš„ã€‚</li></ol><p>CRFæ—¢å…·æœ‰åˆ¤åˆ«å¼æ¨¡å‹çš„ä¼˜ç‚¹ï¼Œåˆè€ƒè™‘åˆ°é•¿è·ç¦»ä¸Šä¸‹æ–‡æ ‡è®°é—´çš„è½¬ç§»æ¦‚ç‡ï¼Œä»¥åºåˆ—åŒ–å½¢å¼è¿›è¡Œå…¨å±€å‚æ•°ä¼˜åŒ–å’Œè§£ç çš„ç‰¹ç‚¹ï¼Œè§£å†³äº†å…¶ä»–åˆ¤åˆ«å¼æ¨¡å‹(å¦‚MEMM)éš¾ä»¥é¿å…çš„æ ‡è®°åè§é—®é¢˜ã€‚</p><h3 id="CRFä¸Logistic-Regression"><a href="#CRFä¸Logistic-Regression" class="headerlink" title="CRFä¸Logistic Regression"></a>CRFä¸Logistic Regression</h3><p>CRFçš„æ¦‚ç‡è®¡ç®—ä¸Logistic Regression (LR)çš„å½¢å¼ç±»ä¼¼ï¼Œ<br>$$CRF: p(l | s) = \frac{exp[\sum_{j = 1}^m \sum_{i = 1}^n \lambda_j f_j(s, i, l_i, l_{i-1})]}{\sum_{lâ€™} exp[\sum_{j = 1}^m \sum_{i = 1}^n \lambda_j f_j(s, i, l^\prime_i, l^\prime_{i-1})]} $$<br>$$LR: P(y|x) = \frac{\exp \bigg( \sum\limits_{i=1}^{N} w_{i} \cdot f_{i}(x,y) \bigg)} {\sum\limits_{yâ€™ \in Y} \exp \bigg( \sum\limits_{i=1}^{N} w_{i} \cdot f_{i}(x,yâ€™) \bigg)}$$<br>åœ¨LRä¸­, $f_i(y, x)$æ˜¯ä¸€ä¸ªç‰¹å¾ï¼Œ$w_i$æ˜¯ä¸è¯¥ç‰¹å¾ç›¸å…³çš„æƒé‡ã€‚æå–çš„ç‰¹å¾æ˜¯äºŒå…ƒç‰¹å¾ï¼Œå–å€¼0æˆ–1ï¼Œé€šå¸¸ç§°ä¸ºæŒ‡ç¤ºå‡½æ•°ã€‚è¿™äº›ç‰¹å¾ä¸­çš„æ¯ä¸€ä¸ªéƒ½ç”±ä¸è¾“å…¥$x$å’Œåˆ†ç±»$y$ç›¸å…³è”çš„å‡½æ•°è®¡ç®—ã€‚</p><p>å®é™…ä¸Šï¼ŒCRFåŸºæœ¬ä¸Šå°±æ˜¯é€»è¾‘å›å½’çš„åºåˆ—åŒ–ï¼šä¸é€»è¾‘å›å½’æ˜¯ç”¨äºåˆ†ç±»çš„å¯¹æ•°çº¿æ€§æ¨¡å‹ä¸åŒï¼ŒCRFæ˜¯æ ‡ç­¾åºåˆ—çš„å¯¹æ•°çº¿æ€§æ¨¡å‹ã€‚</p><h3 id="CRFæ¨¡å‹è®­ç»ƒ"><a href="#CRFæ¨¡å‹è®­ç»ƒ" class="headerlink" title="CRFæ¨¡å‹è®­ç»ƒ"></a>CRFæ¨¡å‹è®­ç»ƒ</h3><p>å¦‚ä½•é€šè¿‡æ•°æ®è®­ç»ƒCRFæ¨¡å‹, ä¼°è®¡ç‰¹å¾å‡½æ•°çš„æƒé‡? åˆ©ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMaximum Likelihood Estimationï¼ŒMLE)å’Œæ¢¯åº¦ä¼˜åŒ–(gradient descent).</p><p>$\log p(l | s)$ç›¸å¯¹äºå‚æ•°$Î»_i$çš„æ¢¯åº¦ä¸º:$$\frac{\partial}{\partial w_j} \log p(l | s) = \sum_{j = 1}^m f_i(s, j, l_j, l_{j-1}) - \sum_{lâ€™} p(lâ€™ | s) \sum_{j = 1}^m f_i(s, j, l^\prime_j, l^\prime_{j-1})$$<br>å¯¼æ•°çš„ç¬¬ä¸€é¡¹æ˜¯çœŸå®æ ‡ç­¾ä¸‹çš„ç‰¹å¾$f_i$çš„è´¡çŒ®ï¼Œç¬¬äºŒé¡¹æ˜¯å½“å‰æ¨¡å‹ä¸‹ç‰¹å¾$f_i$çš„æœŸæœ›è´¡çŒ®ã€‚</p><p>å¯¹äºä¸€å †è®­ç»ƒæ ·ä¾‹ï¼ˆå¥å­å’Œç›¸å…³çš„è¯æ€§æ ‡ç­¾ï¼‰ã€‚éšæœºåˆå§‹åŒ–CRFæ¨¡å‹çš„æƒé‡ã€‚è¦å°†è¿™äº›éšæœºåˆå§‹åŒ–çš„æƒé‡è½¬ç§»åˆ°æ­£ç¡®çš„æƒé‡ï¼Œå¯¹äºæ¯ä¸ªè®­ç»ƒç¤ºä¾‹:</p><ul><li>éå†æ¯ä¸ªç‰¹å¾å‡½æ•°$f_i$ï¼Œè®¡ç®—è®­ç»ƒç¤ºä¾‹ç›¸å¯¹äº$Î»_i$çš„å¯¹æ•°æ¦‚ç‡çš„æ¢¯åº¦</li><li>ä»¥learning rate $\alpha$çš„é€Ÿç‡æ²¿æ¢¯åº¦æ–¹å‘ä¸æ–­ä¿®æ­£$Î»_i$: $\lambda_i = \lambda_i + \alpha [\sum_{j = 1}^m f_i(s, j, l_j, l_{j-1}) - \sum_{lâ€™} p(lâ€™ | s) \sum_{j = 1}^m f_i(s, j, l^\prime_j, l^\prime_{j-1})]$</li><li>é‡å¤è¿™äº›è®­ç»ƒæ­¥éª¤ï¼Œç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°ä½äºæŸä¸ªé˜ˆå€¼ï¼‰ã€‚</li></ul><p>CRFçš„ç¼ºç‚¹æ˜¯æ¨¡å‹è®­ç»ƒæ—¶æ”¶æ•›é€Ÿåº¦æ¯”è¾ƒæ…¢.</p><p>è®­ç»ƒåçš„CRFæ¨¡å‹, å¯ä»¥ç”¨äºé¢„æµ‹ä¸€ä¸ªæœªæ ‡è®°åºåˆ—çš„æœ€å¤§å¯èƒ½æ ‡è®°. æˆ‘ä»¬éœ€è¦æ¯ä¸ªæ ‡è®°çš„æ¦‚ç‡$p(l | s)$, å¯¹äºå¤§å°ä¸ºkçš„æ ‡ç­¾é›†å’Œé•¿åº¦ä¸ºmçš„å¥å­, éœ€è¦æ¯”è¾ƒçš„$p(l | s)$ç»„åˆæœ‰$k^m$ç§. ä½†æ˜¯è®¡ç®—æ—¶, å¯ä»¥åˆ©ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹æ³•, åŸç†ç±»ä¼¼äºViterbiç®—æ³•.</p><h3 id="CRFä¸­æ–‡å‘½åå®ä½“è¯†åˆ«"><a href="#CRFä¸­æ–‡å‘½åå®ä½“è¯†åˆ«" class="headerlink" title="CRFä¸­æ–‡å‘½åå®ä½“è¯†åˆ«"></a>CRFä¸­æ–‡å‘½åå®ä½“è¯†åˆ«</h3><p>æ¯”å¦‚ä¸­æ–‡å‘½åå®ä½“è¯†åˆ«ä»»åŠ¡, å‡å¦‚éœ€è¦åˆ¤æ–­äººåã€åœ°åã€ç»„ç»‡åä¸‰ç±»å‘½åå®ä½“.</p><p>å¯¹äºäººå, é€šè¿‡ä¸€äº›æ¨¡æ¿æ¥ç­›é€‰ç‰¹å¾ã€‚æ¨¡æ¿æ˜¯å¯¹ä¸Šä¸‹æ–‡çš„ç‰¹å®šä½ç½®å’Œç‰¹å®šä¿¡æ¯çš„è€ƒè™‘, é€‚ç”¨äºäººåçš„ç‰¹å¾æ¨¡æ¿:</p><ul><li>äººåçš„æŒ‡ç•Œè¯ï¼šä¸»è¦åŒ…æ‹¬ç§°è°“è¯ã€åŠ¨è¯å’Œå‰¯è¯ç­‰ï¼Œå¥é¦–ä½ç½®å’Œæ ‡ç‚¹ç¬¦å·ä¹Ÿå¯ã€‚æ ¹æ®æŒ‡ç•Œè¯ä¸äººåå…±ç°çš„æ¦‚ç‡çš„å¤§å°ï¼Œå°†äººåçš„å·¦å³æŒ‡ç•Œè¯å„åˆ†ä¸ºä¸¤çº§ï¼Œç”Ÿæˆ4ä¸ªäººåæŒ‡ç•Œè¯åˆ—è¡¨ï¼š<img src="/images/äººåæŒ‡ç•Œè¯.png" alt=""></li><li>äººåè¯†åˆ«ç‰¹å¾çš„åŸå­æ¨¡æ¿ï¼Œæ¯ä¸ªæ¨¡æ¿éƒ½åªè€ƒè™‘äº†ä¸€ç§å› ç´ ï¼š<img src="/images/äººåè¯†åˆ«ç‰¹å¾åŸå­æ¨¡æ¿.png" alt=""></li></ul><p>å½“ç‰¹å¾å‡½æ•°å–ç‰¹å®šå€¼æ—¶ï¼Œç‰¹å¾æ¨¡æ¿è¢«å®ä¾‹åŒ–, å°±å¯ä»¥å¾—åˆ°å…·ä½“çš„ç‰¹å¾ã€‚æ¯”å¦‚å½“å‰è¯çš„å‰ä¸€ä¸ªè¯ $w_{i-1}$ åœ¨äººå1çº§å·¦æŒ‡ç•Œè¯åˆ—è¡¨ä¸­å‡ºç°, $f_i(x, y) = 1, if: PBW1(w_{i-1}) = true, y = PERSON$</p><p>ç±»ä¼¼çš„ï¼Œåšåœ°åã€ç»„ç»‡åçš„ç‰¹å¾æå–å’Œé€‰æ‹©ï¼Œå¹¶å°†å…¶å®ä¾‹åŒ–ï¼Œå¾—åˆ°æ‰€æœ‰çš„ç‰¹å¾å‡½æ•°ã€‚</p><p>è¯„æµ‹æŒ‡æ ‡:<br>å¬å› recall = $ \frac{æ­£ç¡®è¯†åˆ«çš„å‘½åå®ä½“é¦–éƒ¨ï¼ˆå°¾éƒ¨ï¼‰çš„ä¸ªæ•°}{æ ‡å‡†ç»“æœä¸­å‘½åå®ä½“é¦–éƒ¨ï¼ˆå°¾éƒ¨ï¼‰çš„çš„æ€»æ•°} \times 100\%$</p><p>ç²¾ç¡®ç‡ precision = $ \frac{æ­£ç¡®è¯†åˆ«çš„å‘½åå®ä½“é¦–éƒ¨ï¼ˆå°¾éƒ¨ï¼‰çš„ä¸ªæ•°}{è¯†åˆ«å‡ºçš„å‘½åå®ä½“é¦–éƒ¨ï¼ˆå°¾éƒ¨ï¼‰çš„æ€»æ•°} \times 100\%$</p><p>F1 =  $ \frac{2 \times precision \times recall}{precision + recall}$</p><h2 id="ç”Ÿæˆå¼æ¨¡å‹å’Œåˆ¤åˆ«å¼æ¨¡å‹"><a href="#ç”Ÿæˆå¼æ¨¡å‹å’Œåˆ¤åˆ«å¼æ¨¡å‹" class="headerlink" title="ç”Ÿæˆå¼æ¨¡å‹å’Œåˆ¤åˆ«å¼æ¨¡å‹"></a>ç”Ÿæˆå¼æ¨¡å‹å’Œåˆ¤åˆ«å¼æ¨¡å‹</h2><p>ä»æœ´ç´ è´å¶æ–¯, åˆ°HMM; ä»Logistic Regressionåˆ°CRF, è¿™äº›æ¦‚ç‡å›¾æ¨¡å‹æœ‰å¦‚ä¸‹è½¬æ¢å…³ç³»:<br><img src="/images/relationship_nbs_hmm_lr_crf.png" alt="" title="Diagram of the relationship between naive Bayes, logistic regression, HMMs, linear-chain CRFs, generative models, and general CRFs. image from: An Introduction to Conditional Random Fields, by Charles Sutton and Andrew McCallum"></p><p>è€Œåœ¨æœ´ç´ è´å¶æ–¯ä¸Logistic Regression, ä»¥åŠHMMå’ŒCRFä¹‹é—´, åˆæœ‰ç”Ÿæˆå¼å’Œåˆ¤åˆ«å¼çš„åŒºåˆ«.</p><ul><li>ç”Ÿæˆå¼æ¨¡å‹æè¿°æ ‡ç­¾å‘é‡yå¦‚ä½•æœ‰æ¦‚ç‡åœ°<strong>ç”Ÿæˆ</strong>ç‰¹å¾å‘é‡x, å³å°è¯•æ„å»ºxå’Œyçš„è”åˆåˆ†å¸ƒ$p(y, x)$, å…¸å‹çš„æ¨¡å‹æœ‰HMMï¼Œè´å¶æ–¯æ¨¡å‹ï¼ŒMRFã€‚ç”Ÿæˆå¼æ¨¡å‹</li><li>è€Œåˆ¤åˆ«æ¨¡å‹ç›´æ¥æè¿°å¦‚ä½•æ ¹æ®ç‰¹å¾å‘é‡xåˆ¤æ–­å…¶æ ‡ç­¾y, å³å°è¯•æ„å»º$p(y | x)$çš„æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ, å…¸å‹æ¨¡å‹å¦‚å¦‚LR, SVMï¼ŒCRFï¼ŒMEMMç­‰.</li></ul><p>åŸåˆ™ä¸Šï¼Œä»»ä½•ç±»å‹çš„æ¨¡å‹éƒ½å¯ä»¥ä½¿ç”¨è´å¶æ–¯è§„åˆ™è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œä½†å®é™…ä¸Šè¿™äº›æ–¹æ³•æ˜¯ä¸åŒçš„. ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹éƒ½æè¿°äº†$p(y, x)$çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½†åŠªåŠ›çš„æ–¹å‘ä¸åŒã€‚ç”Ÿæˆæ¨¡å‹ï¼Œä¾‹å¦‚æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨å’ŒHMMï¼Œæ˜¯ä¸€ç±»å¯ä»¥å› å¼åˆ†è§£ä¸º$p(y, x) = p(y)p(x|y)$çš„è”åˆåˆ†å¸ƒ, ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬æè¿°äº†å¦‚ä½•ä¸ºç»™å®šæ ‡ç­¾çš„ç‰¹å¾é‡‡æ ·æˆ–â€œç”Ÿæˆâ€å€¼ã€‚ç”Ÿæˆå¼æ¨¡å‹ä»ç»Ÿè®¡çš„è§’åº¦è¡¨ç¤ºæ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œèƒ½å¤Ÿåæ˜ åŒç±»æ•°æ®æœ¬èº«çš„ç›¸ä¼¼åº¦ï¼Œä¸å…³å¿ƒåˆ¤åˆ«è¾¹ç•Œã€‚ç”Ÿæˆå¼æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯:<br>â€¢ å®é™…ä¸Šå¸¦çš„ä¿¡æ¯è¦æ¯”åˆ¤åˆ«æ¨¡å‹ä¸°å¯Œï¼Œ ç ”ç©¶å•ç±»é—®é¢˜æ¯”åˆ¤åˆ«æ¨¡å‹çµæ´»æ€§å¼º<br>â€¢ èƒ½æ›´å……åˆ†çš„åˆ©ç”¨å…ˆéªŒçŸ¥è¯†<br>â€¢ æ¨¡å‹å¯ä»¥é€šè¿‡å¢é‡å­¦ä¹ å¾—åˆ°<br>ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾: â€¢ å­¦ä¹ è¿‡ç¨‹æ¯”è¾ƒå¤æ‚; â€¢ åœ¨ç›®æ ‡åˆ†ç±»é—®é¢˜ä¸­å‡†ç¡®åº¦ä¸é«˜</p><p>è€Œåˆ¤åˆ«å¼æ¨¡å‹, æ¯”å¦‚ LR, æ˜¯ä¸€ç³»åˆ—æ¡ä»¶åˆ†å¸ƒ$p(y | x)$. ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†ç±»è§„åˆ™æ˜¯ç›´æ¥å»ºæ¨¡çš„ã€‚åŸåˆ™ä¸Šï¼Œåˆ¤åˆ«æ¨¡å‹ä¹Ÿå¯é€šè¿‡ä¸ºè¾“å…¥æä¾›è¾¹é™…åˆ†å¸ƒ$p(x)$æ¥è·å¾—è”åˆåˆ†å¸ƒ$p(y, x)$ï¼Œä½†å¾ˆå°‘éœ€è¦è¿™æ ·ã€‚æ¡ä»¶åˆ†å¸ƒ$p(y | x)$ä¸åŒ…æ‹¬$p(x)$çš„ä¿¡æ¯ï¼Œåœ¨åˆ†ç±»ä»»åŠ¡ä¸­å…¶å®æ— è®ºå¦‚ä½•ä¹Ÿç”¨ä¸åˆ°ã€‚å…¶æ¬¡ï¼Œå¯¹$p(x)$å»ºæ¨¡çš„å›°éš¾ä¹‹å¤„åœ¨äºå®ƒé€šå¸¸åŒ…å«å¾ˆå¤šå»ºæ¨¡éš¾åº¦è¾ƒé«˜çš„æœ‰é«˜åº¦ä¾èµ–æ€§çš„ç‰¹å¾ã€‚åˆ¤åˆ«å¼æ¨¡å‹å¯»æ‰¾ä¸åŒç±»åˆ«ä¹‹é—´çš„æœ€ä¼˜åˆ†ç±»é¢ï¼Œåæ˜ çš„æ˜¯å¼‚ç±»æ•°æ®ä¹‹é—´çš„å·®å¼‚ã€‚ä¼˜ç‚¹æ˜¯:<br>â€¢ åˆ†ç±»è¾¹ç•Œæ›´çµæ´»ï¼Œæ¯”ä½¿ç”¨çº¯æ¦‚ç‡æ–¹æ³•æˆ–ç”Ÿäº§æ¨¡å‹å¾—åˆ°çš„æ›´é«˜çº§ã€‚<br>â€¢ èƒ½æ¸…æ™°çš„åˆ†è¾¨å‡ºå¤šç±»æˆ–æŸä¸€ç±»ä¸å…¶ä»–ç±»ä¹‹é—´çš„å·®å¼‚ç‰¹å¾<br>â€¢ åœ¨èšç±»ã€viewpoint changes, partial occlusion and scale variationsä¸­çš„æ•ˆæœè¾ƒå¥½<br>â€¢é€‚ç”¨äºè¾ƒå¤šç±»åˆ«çš„è¯†åˆ«<br>ç¼ºç‚¹æ˜¯ï¼šâ€¢ ä¸èƒ½åæ˜ è®­ç»ƒæ•°æ®æœ¬èº«çš„ç‰¹æ€§ã€‚â€¢ èƒ½åŠ›æœ‰é™ï¼Œå¯ä»¥åˆ†ç±», ä½†æ— æ³•æŠŠæ•´ä¸ªåœºæ™¯æè¿°å‡ºæ¥ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="http://blog.echen.me/2012/01/03/introduction-to-conditional-random-fields/" target="_blank" rel="noopener">http://blog.echen.me/2012/01/03/introduction-to-conditional-random-fields/</a><br>Classical probabilistic models and conditional random fields<br><a href="http://homepages.inf.ed.ac.uk/csutton/publications/crftut-fnt.pdf" target="_blank" rel="noopener">An Introduction to Conditional Random Fields</a>, by Charles Sutton and Andrew McCallum</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰&quot;&gt;&lt;a href=&quot;#è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰&quot; class=&quot;headerlink&quot; title=&quot;è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰&quot;&gt;&lt;/a&gt;è¯æ€§æ ‡æ³¨ï¼ˆPart-of-Speech-Taggingï¼‰&lt;/h2&gt;&lt;p&gt;POSä»»åŠ¡æ˜¯æŒ‡æ ¹æ®è§‚å¯Ÿå¾—åˆ°çš„åºåˆ—, æ¨æ–­å‡ºå¯¹åº”çš„è¯æ€§æ ‡æ³¨, æ¯”å¦‚&lt;code&gt;Bob drank coffee at Starbucks&lt;/code&gt;, æ ‡æ³¨å¯èƒ½ä¸º&lt;code&gt;Bob (NOUN) drank (VERB) coffee (NOUN) at (PREPOSITION) Starbucks (NOUN)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰å‘½åå®ä½“è¯†åˆ«, ä»¥åŠå…¶ä»–æ¶‰åŠåˆ°éœ€è¦æ ¹æ®è§‚å¯Ÿåºåˆ—æ¨æ–­éšå«çŠ¶æ€çš„é—®é¢˜, éƒ½å¯ä»¥è€ƒè™‘ç”¨éšé©¬å°”å¯å¤«æ¨¡å‹(Hidden Markov Model, HMM)æˆ–è€…æ¡ä»¶éšæœºåœº(conditional random fields, CRF)æ¥å¤„ç†.&lt;/p&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>å¾ªç¯ç¥ç»ç½‘ç»œ</title>
    <link href="http://shukebeta.me/NLP-recurrent-neural-networks/"/>
    <id>http://shukebeta.me/NLP-recurrent-neural-networks/</id>
    <published>2018-12-14T16:00:00.000Z</published>
    <updated>2019-01-01T06:46:51.583Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p>å½“äººç±»é˜…è¯»æ—¶ï¼Œä¼šæ ¹æ®å¯¹ä¹‹å‰å•è¯çš„ç†è§£å’Œè®°å¿†æ¥è¾…åŠ©ç†è§£å½“å‰çœ‹åˆ°çš„æ¯ä¸ªå•è¯ã€‚ä¹Ÿå°±æ˜¯äººèƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†è¯­è¨€çš„é•¿è·ç¦»ä¾èµ–ç‰¹æ€§ï¼ˆlong-term dependencyï¼‰ã€‚åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ï¼Œå¾ˆå¤šä¼ ç»Ÿçš„æ¨¡å‹æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ¯”å¦‚å‰é¦ˆç¥ç»ç½‘ç»œï¼›è€Œä¼ ç»Ÿçš„n-gramæ¨¡å‹å›ºç„¶å¯ä»¥é€šè¿‡æŠŠæŠŠnç³»æ•°å¢å¤§æ¥æ•æ‰é•¿è·ç¦»ä¾èµ–ï¼Œä½†å¸¦æ¥çš„éå¸¸å·¨å¤§çš„å†…å­˜æ¶ˆè€—ã€‚<br><a id="more"></a></p><p>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNs)å¯ä»¥çœ‹åšæ˜¯å¤šä¸ª<strong>å…±äº«å‚æ•°</strong>çš„å‰é¦ˆç¥ç»ç½‘ç»œä¸æ–­å åŠ çš„ç»“æœ<br><img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/RNN-unrolled.png" alt="" title="A recurrent neural network and the unfolding in time of the computation involved in its forward computation. &quot;image from: http://colah.github.io"></p><p>è¿™é‡Œçš„æ ¸å¿ƒæ˜¯æƒ³åŠæ³•è§£ç å†å²ä¿¡æ¯, å³é€šè¿‡é€’å½’æ–¹ç¨‹$s_i = R(x_i, s_{iâˆ’1})$è®©$s_i$è§£ç åºåˆ—$x_{1:n}$. æ¯”å¦‚æŠŠæ‰€æœ‰å†å²ä¿¡æ¯ç´¯åŠ å°±æ˜¯ä¸€ç§éå¸¸ç®€å•ç²—æš´çš„æ–¹å¼, è¿™æ ·å¾—åˆ°çš„æ˜¯è¿ç»­è¯è¢‹æ¨¡å‹(continuous-bag-of-words model)$s_i = R_{CBOW}(x_i, s_{i-1}) = x_i + s_{iâˆ’1}$, è™½ç„¶ç®€å•ï¼Œä½†è¿™ç§RNNå…¶å®å¿½ç•¥äº†æ•°æ®çš„æ—¶åºæ€§è´¨ã€‚</p><p>ä¸€èˆ¬æ„ä¹‰ä¸Šçš„RNNæ˜¯æŒ‡Elman Network or Simple-RNN (S-RNN)(<code>Elman [1990]</code>), $s_i = R_{SRNN}(x_i, s_{i-1}) = g(x_iW^x + s_{iâˆ’1}W^s + b)$, ä¹Ÿå°±æ˜¯æŠŠå†å²ä¿¡æ¯å…ˆè¿›è¡Œçº¿æ€§å˜æ¢(ä¹˜ä»¥çŸ©é˜µ), å†å’ŒbiasåŠ èµ·æ¥, å†é€šè¿‡ä¸€ä¸ªéçº¿æ€§æ¿€æ´»å‡½æ•°(tanhæˆ–ReLU). æ·»åŠ äº†çº¿æ€§å˜æ¢å†è¿›è¡Œéçº¿æ€§æ¿€æ´», ä½¿ç½‘ç»œå¯¹è¾“å…¥çš„é¡ºåºå˜å¾—æ•æ„Ÿã€‚</p><p><img src="http://d3kbpzbmcynnmx.cloudfront.net/wp-content/uploads/2015/09/rnn.jpg" alt="" title="image from: Nature"><br>åœ¨ä½¿ç”¨æ—¶, ç»™å®šè¾“å…¥åºåˆ—ï¼ˆå•è¯åºåˆ—æˆ–è¯­éŸ³ï¼‰å¾—å‡ºè¾“å‡ºåºåˆ—çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æŠŠæ¯ä¸ªè¯$x_{t}$(ä»¥å‘é‡è¡¨ç¤º)é€ä¸ªè¾“å…¥RNN</li><li>æ¯ä¸€æ—¶é—´æ­¥$t$éƒ½æœ‰å¯¹åº”çš„éšå«çŠ¶æ€$s_t$ï¼Œç”¨äºè§£ç å†å²ä¿¡æ¯: $s_t = g(Ux_t + Ws_{t-1} + b)$.</li><li>æ¯ä¸€æ—¶é—´æ­¥éƒ½å¯ä»¥æœ‰ä¸€ä¸ªè¾“å‡ºï¼ˆè™½ç„¶å¤§éƒ¨åˆ†åº”ç”¨åªç”¨åˆ°æœ€åä¸€æ—¶é—´æ­¥ï¼‰$o(t)$ï¼š ä¾‹å¦‚ï¼Œè¯­è¨€æ¨¡å‹æƒ³è¦é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ï¼Œé‚£ä¹ˆè¾“å‡ºå°±æ˜¯åœ¨è¯æ±‡è¡¨ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒå‘é‡ï¼Œ$o_t = softmax(Vs_t)$.</li><li>å…¶ä¸­ï¼Œå„ä¸ªæ—¶é—´æ­¥å…±äº«å‡ ä¸ªå‚æ•°çŸ©é˜µï¼ˆ$U, V, W$ï¼‰</li></ul><p>In addition to the above normal many to many structure RNNs, there are other non-sequence input or output: Many to one, e.g. when predicting the sentiment of a sentence we may only care about the final output, not the sentiment after each word. One to many: Music generation.<br><img src="http://karpathy.github.io/assets/rnn/diags.jpeg" alt="" title="source from http://karpathy.github.io/2015/05/21/rnn-effectiveness/"></p><p>é™¤äº†åº”ç”¨äºè¯­è¨€æ¨¡å‹, RNNs è¿˜å¯ä»¥åº”ç”¨äº<br>Â· tagging, e.g. part-of-speech tagging, named entity recognition (many to many RNNs)<br>Â· sentence classification, e.g. sentiment classification (many to one RNNs)<br>Â· generate text, e.g. speech recognition, machine translation, summarization</p><h3 id="RNNs-Backpropagation"><a href="#RNNs-Backpropagation" class="headerlink" title="RNNs Backpropagation"></a>RNNs Backpropagation</h3><p>Backpropagation Through Time (BPTT): Because the parameters are shared by all time steps in the network, the gradient at each output depends not only on the calculations of the current time step, but also the previous time steps.</p><p>RNNs trained with BPTT have difficulties learning long-term dependencies (e.g. dependencies between steps that are far apart) due to what is called the vanishing/exploding gradient problem.</p><h3 id="æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸"><a href="#æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸"></a>æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸</h3><p>The Vanishing/Exploding Gradient problemã€‚</p><p>RNNs shares the same matrix (w, u, etc.) at each time step during forward prop and backprop. æ±‚å¯¼æ•°æ—¶, æ ¹æ®é“¾å¼æ³•åˆ™, losså¯¹å„å‚æ•°çš„å¯¼æ•°ä¼šè½¬æ¢ä¸ºlosså¯¹è¾“å‡ºyçš„å¯¼æ•°, ä¹˜ä»¥yå¯¹éšå«å±‚çš„å¯¼æ•°, ä¹˜ä»¥éšå«å±‚ç›¸å¯¹éšå«å±‚ä¹‹é—´çš„å¯¼æ•°, å†ä¹˜ä»¥éšå«å±‚å¯¹å‚æ•°çš„å¯¼æ•°.<img src="/images/vanish_gradient.png" alt=""></p><p>ä¸åŒéšå«å±‚ï¼ˆä¸¾ä¾‹å¦‚$h_t$å’Œ$h_k$ï¼‰ä¹‹é—´å¦‚æœç›¸éš”å¤ªè¿œ, $h_t$å¯¹$h_k$çš„å¯¼æ•°å°±å˜æˆå¤šä¸ªjacobiançŸ©é˜µçš„ç›¸ä¹˜ï¼Œ å¯¹å„ä¸ªjacobianèŒƒæ•°ï¼ˆnormsï¼‰è¿›è¡Œåˆ†æåï¼Œå‘ç°$h_t$å¯¹$h_k$çš„å¯¼æ•°å€¼åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå¾ˆå¿«å˜å¾—å¾ˆæç«¯ï¼ˆéå¸¸å°æˆ–è€…éå¸¸å¤§ï¼‰ã€‚</p><p>Gradientä½œä¸ºä¼ å¯¼è¯¯å·®ä»¥å¸®åŠ©ç³»ç»Ÿçº æ­£å‚æ•°çš„å…³é”®è§’è‰²ï¼Œå¦‚æœæœ¬èº«å˜å¾—æ¥è¿‘äº<code>0</code>æˆ–è€…<code>nan</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•åˆ¤æ–­tå’Œt+nçš„æ•°æ®çš„ä¾èµ–æ€§ï¼ˆæ˜¯æ²¡æœ‰ä¾èµ–ï¼Ÿè¿˜æ˜¯å› ä¸ºvanish of gradientï¼Ÿè¿˜æ˜¯å› ä¸ºå‚æ•°è®¾ç½®é”™è¯¯ï¼Ÿï¼‰ã€‚æ¢¯åº¦è¡°å‡ä¼šç›´æ¥é™ä½æ¨¡å‹å­¦ä¹ é•¿è·ç¦»ä¾èµ–å…³ç³»çš„èƒ½åŠ›ï¼Œç»™å®šä¸€ä¸ªæ—¶é—´åºåˆ—ï¼Œä¾‹å¦‚æ–‡æœ¬åºåˆ—ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œè¾ƒéš¾æ•æ‰ä¸¤ä¸ªæ—¶åˆ»è·ç¦»è¾ƒå¤§çš„æ–‡æœ¬å…ƒç´ ï¼ˆå­—æˆ–è¯ï¼‰ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>åœ¨ä½¿ç”¨RNNå­¦ä¹ language modelçš„æ—¶å€™ï¼Œéå¸¸å®¹æ˜“å‡ºç°æ¢¯åº¦çˆ†ç‚¸ï¼Œè§£å†³åŠæ³•æ˜¯ä½¿ç”¨ gradient clipping æ¢¯åº¦è£å‰ªï¼Œå°±æ˜¯é€šè¿‡æŠŠæ¢¯åº¦æ˜ å°„åˆ°å¦ä¸€ä¸ªå¤§å°çš„ç©ºé—´ï¼Œä»¥é™åˆ¶æ¢¯åº¦èŒƒæ•°çš„æœ€å¤§å€¼<a href="https://arxiv.org/abs/1211.5063" target="_blank" rel="noopener">On the difficulty of training Recurrent Neural Networks</a>ã€‚</p><p>è™½ç„¶æ¢¯åº¦è£å‰ªå¯ä»¥åº”å¯¹æ¢¯åº¦çˆ†ç‚¸ï¼Œä½†æ— æ³•è§£å†³æ¢¯åº¦è¡°å‡çš„é—®é¢˜ã€‚ä¸€ä¸ªç¼“è§£æ¢¯åº¦è¡°å‡çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ›´å¥½çš„å‚æ•°åˆå§‹åŒ–æ–¹æ¡ˆå’Œæ¿€æ´»å‡½æ•°ï¼ˆReLUsï¼‰<a href="https://arxiv.org/abs/1504.00941" target="_blank" rel="noopener">A Simple Way to Initialize Recurrent Networks of Rectified Linear Units</a>.</p><p>ä¸è¿‡æ›´ä¸»æµçš„è§£å†³æ¢¯åº¦è¡°å‡çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ›´å¤æ‚çš„rnnéšå«å•å…ƒ: Gated Recurrent Units (GRU) introduced by <a href="https://arxiv.org/abs/1406.1078" target="_blank" rel="noopener">Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation</a> and LSTMs.</p><h2 id="é—¨æ§å¾ªç¯ç½‘ç»œ"><a href="#é—¨æ§å¾ªç¯ç½‘ç»œ" class="headerlink" title="é—¨æ§å¾ªç¯ç½‘ç»œ"></a>é—¨æ§å¾ªç¯ç½‘ç»œ</h2><p>å› ä¸ºæ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼ŒRNNçš„è§£ç èƒ½åŠ›æ˜¯å¾ˆæœ‰é™çš„ã€‚S-RNNæ¶æ„çš„ä¸€ä¸ªæ˜æ˜¾ç¼ºé™·æ˜¯å¯¹å†å²ä¿¡æ¯çš„è®°å¿†æ˜¯ä¸å—æ§åˆ¶ï¼Œåœ¨æ¯ä¸€æ—¶é—´æ­¥çš„è®¡ç®—ï¼Œè¯»å†™æ•´ä¸ªè®°å¿†çŠ¶æ€$s_t$ã€‚è€Œé—¨æ§å¾ªç¯ç½‘ç»œï¼Œæ¯”å¦‚Long Short-Term Memoryï¼ˆLSTMsï¼‰ï¼ŒGated Recurring Unitï¼ˆGRUsï¼‰ï¼Œä½¿ç”¨<strong>é—¨</strong>çš„æ¦‚å¿µï¼Œè®©ç½‘ç»œæ‹¥æœ‰æ§åˆ¶å“ªäº›ä¿¡æ¯éœ€è¦è®°å½•, å“ªäº›éœ€è¦ä¸¢å¼ƒçš„èƒ½åŠ›ã€‚å¦‚ä½•å®ç°è¿™ç§é—¨å‘¢? è€ƒè™‘ä¸€ç§ä»‹äº<code>[0, 1]</code>ä¸­é—´çš„å› å­, è®©è¿™ç§å› å­ä¸å„ç§çŠ¶æ€ä¿¡æ¯ç›¸ä¹˜, å¯ä»¥ä¸ºæ¯ä¸ªçŠ¶æ€ä¿¡æ¯ç‹¬è‡ªè®­ç»ƒä¸€ä¸ªå› å­, ä¹Ÿå°±æ˜¯ç”±ç®€å•çš„ç¥ç»ç½‘ç»œ(éçº¿æ€§æ¿€æ´»å‡½æ•°Sigmoid)æ¥æ§åˆ¶.</p><p>æ˜¯å¦å…è®¸ä¿¡æ¯é€šè¿‡ï¼ˆæ‰“å¼€ï¼‰æˆ–ä¸é€šè¿‡ï¼ˆå…³é—­ï¼‰å–å†³äºå…¶é—¨æ§å•å…ƒå†…éƒ¨Sigmoidæ¿€æ´»å±‚çš„ç‚¹ä¹˜è¿ç®—ã€‚Sigmoidå‡½æ•°å€¼ä»‹äº0å’Œ1ä¹‹é—´ï¼Œå¯ç”¨äºæè¿°å…è®¸é€šè¿‡å•å…ƒæ ¼çš„ä¿¡æ¯é‡ã€‚</p><p>LSTMæ¶æ„å°†çŠ¶æ€å‘é‡$s_i$åˆ†æˆä¸¤åŠï¼Œå…¶ä¸­ä¸€åŠè¢«è§†ä¸ºâ€œè®°å¿†å•å…ƒâ€$C$, è€Œå¦ä¸€åŠè¢«è§†ä¸ºä¸€èˆ¬çš„å·¥ä½œå­˜å‚¨å•å…ƒ-éšå«çŠ¶æ€$h$ã€‚</p><p>1, LSTMç”¨<strong>é—å¿˜é—¨</strong>æ¥å†³å®šä»å‰ä¸€æ—¶é—´æ­¥çš„è®°å¿†å•å…ƒä¸­ä¸¢å¼ƒå“ªäº›ä¿¡æ¯ï¼Œæ§åˆ¶å½“å‰è®°å¿†å•å…ƒåº”è¯¥å¿˜è®°å¤šå°‘æ¥è‡ªå‰ä¸€æ­¥çŠ¶æ€$h_{t-1}$çš„ä¿¡æ¯é‡ï¼Œæ ‡è®°ä¸º<strong>é—å¿˜ä¿¡æ¯</strong>ã€‚é—å¿˜é—¨ç”±ä¸€ä¸ªsigmoidå±‚å­¦ä¹ è€Œæ¥ <img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-f.png" alt="" title="image from: http://colah.github.io/posts/2015-08-Understanding-LSTMs/"></p><p>2, ç”¨<strong>è¾“å…¥é—¨</strong> Input gate (a sigmoid hidden layer) æ¥å†³å®šæœ‰å¤šå°‘æ–°ä¿¡æ¯æ˜¯å€¼å¾—å‚¨å­˜çš„ï¼ˆå½“å‰æ—¶é—´æ­¥$t$ï¼‰ã€‚è¾“å…¥é—¨æ§åˆ¶å“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°. å†é€šè¿‡ä¸€ä¸ªéšå«å±‚(tanh/relu)ç”Ÿæˆæ–°çš„<strong>å€™é€‰ä¿¡æ¯</strong>å‘é‡$\widetilde{C}_t$. <img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-i.png" alt="" title="image from: http://colah.github.io/posts/2015-08-Understanding-LSTMs/"></p><p>è¾“å…¥é—¨å’Œé—å¿˜é—¨ä¸€èµ·ï¼Œæ§åˆ¶æ¯ä¸€æ­¥çš„ä¿¡æ¯å­˜å‚¨å’Œæ”¹å†™, å°†é—å¿˜ä¿¡æ¯å’Œå€™é€‰ä¿¡æ¯ç»„åˆåœ¨ä¸€èµ·ä½œä¸º<strong>æ›´æ–°ä¿¡æ¯</strong>ï¼Œä½œä¸ºå½“å‰æ—¶é—´æ­¥çš„æ–°è®°å¿†å•å…ƒï¼Œ$C_{t}$.<img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-C.png" alt="" title="image from: http://colah.github.io/posts/2015-08-Understanding-LSTMs/"></p><p>3, æœ€åï¼Œç”¨ä¸€ä¸ª<strong>è¾“å‡ºé—¨</strong> Output gate (a sigmoid layer) æ¥æ§åˆ¶å¤šå°‘è®°å¿†å•å…ƒä½œä¸ºå½“å‰æ­¥çš„å·¥ä½œéšå«çŠ¶æ€$h_t$ã€‚å…ˆé€šè¿‡ä¸€ä¸ªtanhæ¿€æ´»å±‚æŠŠå½“å‰è®°å¿†å•å…ƒ$C_t$æ¨é€ä¸º<code>[-1, 1]</code>ä¹‹é—´çš„å€¼, å†ä¹˜ä»¥è¾“å‡ºé—¨.<img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-focus-o.png" alt="" title="image from: http://colah.github.io/posts/2015-08-Understanding-LSTMs/"></p><p>æ€»çš„æ¥è¯´, LSTMæœ‰é—å¿˜é—¨, è¾“å…¥é—¨å’Œè¾“å‡ºé—¨è¿™<strong>ä¸‰ä¸ªé—¨</strong>. åŠ ä¸Šå…¶ä¸­çš„æ›´æ–°ä¿¡æ¯, å½¢å¼ä¸ŠLSTMæœ‰<strong>å››ä¸ªç¥ç»ç½‘ç»œ</strong>, è¾“å…¥éƒ½æ˜¯ä¸Šä¸€æ­¥éšå«çŠ¶æ€å’Œå½“å‰æ­¥çš„è¾“å…¥å‘é‡çš„.</p><h3 id="GRUs"><a href="#GRUs" class="headerlink" title="GRUs"></a>GRUs</h3><p>LSTMsæœ‰ä¸¤ç§éšå«çŠ¶æ€, ä½†GRUs (<a href="http://arxiv.org/pdf/1406.1078v3.pdf" target="_blank" rel="noopener">Cho, et al. (2014)</a>)æŠ›å¼ƒäº†è¿™ç§è®¾è®¡, åªç”¨ä¸€ç§éšå«çŠ¶æ€$h$. è¿™å¯¼è‡´äº†ä¸€ç³»åˆ—çš„å˜åŒ–.</p><p>GRUsé¦–å…ˆæ ¹æ®å½“å‰çš„è¾“å…¥è¯å‘é‡å’Œéšå«çŠ¶æ€è®¡ç®—<strong>æ›´æ–°é—¨</strong>$z_t$å’Œä¸€ä¸ª<strong>é‡ç½®é—¨</strong>$r_t$ã€‚é‡ç½®é—¨ç”¨äºååŠ©è®¡ç®—éšå«å±‚çš„æ›´æ–°ä¿¡æ¯$\widetilde{h}_t$. è¾“å‡ºçš„éšå«çŠ¶æ€$h_t$æ˜¯ç”±æ›´æ–°é—¨$z_t$æ¥æ§åˆ¶.<img src="http://colah.github.io/posts/2015-08-Understanding-LSTMs/img/LSTM3-var-GRU.png" alt="" title="image from: http://colah.github.io/posts/2015-08-Understanding-LSTMs/"></p><p>LSTMsçš„é—å¿˜é—¨å’Œè¾“å…¥é—¨çš„åˆä½œæ ¸å¿ƒæ˜¯<strong>æ›´æ–°ä¿¡æ¯</strong>. è€ŒGRUså°†LSTMsçš„é—å¿˜é—¨å’Œè¾“å…¥é—¨åˆå¹¶æˆä¸€ä¸ªæ›´æ–°é—¨, æŠ›å¼ƒäº†è¾“å‡ºé—¨çš„æ¦‚å¿µ, è®©æ›´æ–°é—¨è´Ÿè´£è®¡ç®—æ–°çš„éšå«çŠ¶æ€. è¿™æ ·GRUså†…éƒ¨æ€»å…±åªæœ‰ä¸¤ä¸ªé—¨, ä¸‰ä¸ªç¥ç»ç½‘ç»œ, æŸç§ç¨‹åº¦ä¸Šç®€åŒ–äº†LSTMsæ¨¡å‹ã€‚</p><p>GRU intuition</p><ul><li>é‡ç½®é—¨èµ‹äºˆäº†æ¨¡å‹ä¸¢å¼ƒä¸æœªæ¥æ— å…³çš„ä¿¡æ¯çš„èƒ½åŠ›ã€‚è‹¥é‡ç½®é—¨æ¥è¿‘äº0ï¼Œåˆ™å¿½ç•¥ä¹‹å‰çš„è®°å¿†ï¼Œä»…å‚¨å­˜æ–°åŠ å…¥çš„ä¿¡æ¯.</li><li>æ›´æ–°é—¨æ§åˆ¶è¿‡å»çš„çŠ¶æ€å¯¹ç°åœ¨çš„å½±å“ç¨‹åº¦ï¼ˆå³å†³å®šæ›´æ–°å¤šå°‘ï¼‰ï¼Œå¦‚æœæ¥è¿‘äº1ï¼Œåˆ™ $h_t=z_t\cdot h_{t-1}$, ç­‰åŒäºæŠŠè¿‡å»çš„ä¿¡æ¯å®Œæ•´å¤åˆ¶åˆ°æœªæ¥ï¼Œç›¸åº”åœ°ç¼“è§£æ¢¯åº¦è¡°å‡ã€‚</li><li>çŸ­è·ç¦»ä¾èµ–çš„å•å…ƒï¼Œè¿‡å»çš„ä¿¡æ¯ä»…ä¿ç•™å¾ˆçŸ­çš„æ—¶é—´ï¼Œé‡ç½®é—¨ä¸€èˆ¬å¾ˆæ´»è·ƒï¼Œä¹Ÿå°±æ˜¯æ•°å€¼åœ¨0å’Œ1ä¹‹é—´é¢‘ç¹å˜åŠ¨ã€‚</li><li>é•¿è·ç¦»ä¾èµ–çš„å•å…ƒï¼Œé‡ç½®é—¨è¾ƒç¨³å®šï¼ˆä¿ç•™è¿‡å»çš„è®°å¿†è¾ƒé•¿æ—¶é—´ï¼‰ï¼Œè€Œæ›´æ–°é—¨è¾ƒæ´»è·ƒã€‚</li></ul><h3 id="ä¸åŒRNNså˜ç§çš„æ¯”è¾ƒ"><a href="#ä¸åŒRNNså˜ç§çš„æ¯”è¾ƒ" class="headerlink" title="ä¸åŒRNNså˜ç§çš„æ¯”è¾ƒ"></a>ä¸åŒRNNså˜ç§çš„æ¯”è¾ƒ</h3><p>Vanilla RNNs Execution:</p><ol><li>Read the whole register h</li><li>Update the whole register</li></ol><p>GRU Execution:</p><ol><li>Select a readable subset</li><li>Read the subset</li><li>Select a writable subset</li><li>Update the subset</li></ol><p><img src="/images/gru.vs.lstm.png" alt="" title="image from: http://web.stanford.edu/class/cs224n"></p><h3 id="é—¨æ§å¾ªç¯ç¥ç»ç½‘ç»œçš„è®­ç»ƒ"><a href="#é—¨æ§å¾ªç¯ç¥ç»ç½‘ç»œçš„è®­ç»ƒ" class="headerlink" title="é—¨æ§å¾ªç¯ç¥ç»ç½‘ç»œçš„è®­ç»ƒ"></a>é—¨æ§å¾ªç¯ç¥ç»ç½‘ç»œçš„è®­ç»ƒ</h3><ol><li>æŠŠå‚æ•°çŸ©é˜µåˆå§‹åŒ–ä¸ºæ­£äº¤</li><li>æŠŠé—å¿˜é—¨çš„biasåˆå§‹åŒ–ä¸º1ï¼Œé»˜è®¤ä¸é—å¿˜</li><li>åˆ«å¿˜äº†æ¢¯åº¦è£å‰ª</li><li>æ³¨æ„dropoutåœ¨RNNsä¸­çš„åº”ç”¨ä¸åŒäºDNNå’ŒCNN</li></ol><h2 id="Bidirectional-RNNs"><a href="#Bidirectional-RNNs" class="headerlink" title="Bidirectional RNNs"></a>Bidirectional RNNs</h2><p>Bidirectional RNNs are based on the idea that the output at time t may not only depend on the previous elements in the sequence, but also future elements. They are just two RNNs stacked on top of each other. The output is then computed based on the hidden state of both RNNs.<br><img src="/images/bidirectional_rnn.png" alt="" title="image from: http://web.stanford.edu/class/cs224n"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>æ–¯å¦ç¦cs224n <a href="http://web.stanford.edu/class/cs224n" target="_blank" rel="noopener">http://web.stanford.edu/class/cs224n</a></p><p><a href="http://colah.github.io" target="_blank" rel="noopener">http://colah.github.io</a></p><p>Neural Network Methods in Natural Language Processing, by Yoav Goldberg</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¾ªç¯ç¥ç»ç½‘ç»œ&quot;&gt;&lt;a href=&quot;#å¾ªç¯ç¥ç»ç½‘ç»œ&quot; class=&quot;headerlink&quot; title=&quot;å¾ªç¯ç¥ç»ç½‘ç»œ&quot;&gt;&lt;/a&gt;å¾ªç¯ç¥ç»ç½‘ç»œ&lt;/h2&gt;&lt;p&gt;å½“äººç±»é˜…è¯»æ—¶ï¼Œä¼šæ ¹æ®å¯¹ä¹‹å‰å•è¯çš„ç†è§£å’Œè®°å¿†æ¥è¾…åŠ©ç†è§£å½“å‰çœ‹åˆ°çš„æ¯ä¸ªå•è¯ã€‚ä¹Ÿå°±æ˜¯äººèƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†è¯­è¨€çš„é•¿è·ç¦»ä¾èµ–ç‰¹æ€§ï¼ˆlong-term dependencyï¼‰ã€‚åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ï¼Œå¾ˆå¤šä¼ ç»Ÿçš„æ¨¡å‹æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ¯”å¦‚å‰é¦ˆç¥ç»ç½‘ç»œï¼›è€Œä¼ ç»Ÿçš„n-gramæ¨¡å‹å›ºç„¶å¯ä»¥é€šè¿‡æŠŠæŠŠnç³»æ•°å¢å¤§æ¥æ•æ‰é•¿è·ç¦»ä¾èµ–ï¼Œä½†å¸¦æ¥çš„éå¸¸å·¨å¤§çš„å†…å­˜æ¶ˆè€—ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>è¯­è¨€æ¨¡å‹</title>
    <link href="http://shukebeta.me/NLP-language-model/"/>
    <id>http://shukebeta.me/NLP-language-model/</id>
    <published>2018-11-11T16:00:00.000Z</published>
    <updated>2019-01-03T08:55:39.836Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¯­è¨€æ¨¡å‹"><a href="#è¯­è¨€æ¨¡å‹" class="headerlink" title="è¯­è¨€æ¨¡å‹"></a>è¯­è¨€æ¨¡å‹</h2><p>è¯­è¨€æ¨¡å‹Language modelingï¼ˆLMï¼‰æœ€åˆæ˜¯é’ˆå¯¹è¯­éŸ³è¯†åˆ«é—®é¢˜è€Œå¼€å‘çš„, ç°åœ¨å¹¿æ³›ç”¨äºå…¶ä»–NLPåº”ç”¨ä¸­, æ¯”å¦‚æœºå™¨ç¿»è¯‘éœ€è¦åˆ©ç”¨LMæ¥ç»™ç¿»è¯‘å‡ºçš„å¥å­æ‰“åˆ†.<br><a id="more"></a><br>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¯­æ–™åº“ - æŸç§è¯­è¨€çš„å¥å­çš„æ— é™é›†åˆ$\mathcal{V^+}$ï¼ˆè¿™äº›å¥å­æ˜¯ç”±æœ‰é™çš„è¯$\mathcal{V}$ç»„æˆçš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä»ç½‘ä¸Šè·å¾—å¤§é‡æ–‡æœ¬ã€‚ç»™å®šäº†æ­¤è¯­æ–™åº“ï¼Œæˆ‘ä»¬æƒ³ä¼°è®¡LMçš„å‚æ•°ã€‚è¿™äº›å‚æ•°åŒ…å«è¯­æ–™åº“ä¸­æ‰€æœ‰å•è¯çš„æœ‰é™é›†åˆ$\mathcal{V}$, ä»¥åŠå¥å­çš„æ¦‚ç‡åˆ†å¸ƒå‡½æ•°$p(x_1, x_2, â€¦, x_n)$ï¼Œå¿…é¡»æ»¡è¶³</p><ol><li>For any $\langle x_1â€¦x_n \rangle \in \mathcal{V^+}$, $p(x_1, x_2, â€¦, x_n) â‰¥ 0$</li><li>$\sum_{\langle x_1â€¦x_n \rangle \in \mathcal{V^+}}p(x_1, x_2, â€¦, x_n) = 1$</li></ol><p>æ¯”å¦‚ï¼Œå½“$\mathcal{V}$åªæœ‰<code>cat, eat, fish</code>, é‚£ä¹ˆå®ƒç»„åˆæˆçš„å¥å­æŒ‰ç…§äººç±»çš„è¯„ä»·æ ‡å‡†, é€šé¡ºç¨‹åº¦ä»é«˜åˆ°ä½æ˜¯: <code>cat eat fish</code>, <code>fish eat cat</code>, <code>cat fish eat</code>, <code>eat cat fish</code>, <code>eat fish cat</code>, <code>fish cat eat</code>. è¿™äº›æ˜¯å¯èƒ½å‡ºç°çš„å¥å­(è¿˜æ²¡å‡ºç°çš„ä¸ä»£è¡¨æœªæ¥ä¸ä¼šå‡ºç°), ä»æ¦‚ç‡åˆ†å¸ƒçš„è§’åº¦çœ‹å¾…, è¿™äº›å¥å­çš„æ¦‚ç‡ä¹‹å’Œæ˜¯<code>1</code>, å› ä¸ºè¿™ä¸‰ä¸ªè¯åªèƒ½ç»„æˆè¿™å‡ ä¸ªå¥å­. è€ŒLMçš„æ„ä¹‰å°±åœ¨äºèƒ½å¤Ÿèµ‹äºˆ<code>cat eat fish</code>æœ€å¤§çš„æ¦‚ç‡, ä»£æ›¿äººæ¥åˆ¤æ–­å¥å­æ˜¯å¦å‡†ç¡®, é€šä¿—çš„è¯´æ˜¯ä¸€ä¸ªå¥å­é€šé¡ºæ‰“åˆ†æœºå™¨.</p><p>å¹¿ä¹‰çš„è¯­è¨€æ¨¡å‹, å¯ä»¥è®¡ç®—ä»»ä½•è¿ç»­çš„å•è¯æˆ–è€…ä»»ä½•å…¶ä»–åºåˆ—æ•°æ®ï¼ˆæ¯”å¦‚è¯­éŸ³ï¼‰å‡ºç°çš„æ¦‚ç‡, å½“ç„¶æ˜¯ä»¥å‚æ•°çš„è®­ç»ƒæ ·æœ¬çš„è§’åº¦æ¥çœ‹å¾…ã€‚é™¤äº†ä¸ºæ¯ä¸ªè¯åºåˆ—æŒ‡å®šæ¦‚ç‡ä¹‹å¤–ï¼Œè¯­è¨€æ¨¡å‹è¿˜æŒ‡å®šç»™å®šçš„å•è¯ï¼ˆæˆ–å•è¯åºåˆ—ï¼‰è·Ÿéšå‰é¢çš„å•è¯åºåˆ—çš„ä¼¼ç„¶æ¦‚ç‡ã€‚</p><p>è¯­è¨€æ¨¡å‹æœ¬èº«å³æ˜¯ä¸€ç§æ¦‚ç‡æ¨¡å‹. æ¦‚ç‡æ¨¡å‹æ˜¯éšæœºç°è±¡çš„æ•°å­¦è¡¨ç¤ºï¼Œç”±æ ·æœ¬ç©ºé—´ï¼Œæ ·æœ¬ç©ºé—´å†…çš„äº‹ä»¶ä»¥åŠä¸æ¯ä¸ªäº‹ä»¶ç›¸å…³çš„æ¦‚ç‡å®šä¹‰ã€‚ç›®æ ‡æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ã€‚</p><p>LMçš„ä»»åŠ¡å°±æ˜¯ä¸ºå•è¯åºåˆ—$w_{1:n}$åˆ†é…æ¦‚ç‡$P(w_{1:n})$, ç­‰åŒäºç»™åºåˆ—çš„æ¯ä¸ªä½ç½®é¢„æµ‹å¯èƒ½å‡ºç°çš„å•è¯ï¼Œç»™å®šå‰é¢çš„å•è¯ï¼ˆä½œä¸ºæ¡ä»¶ï¼‰ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯å‡ºç°çš„æ¦‚ç‡ <code>P(w|w1, w2, w3...)</code>ã€‚å¬èµ·æ¥æœ‰ç‚¹åƒè¯æ€§æ ‡æ³¨(Tagging)â€¦ äº‹å®ä¸Šæœ€åˆä¸ºè¯­è¨€å»ºæ¨¡å¼€å‘çš„å‚æ•°ä¼°è®¡æŠ€æœ¯ä¹Ÿç»™è¯æ€§æ ‡æ³¨åšäº†ä¸å°‘è´¡çŒ®.</p><p>åˆ©ç”¨é“¾å¼æ³•åˆ™, $$P(w_{1:n}) = P(w_1)P(w_2|w_1)P(w_3|w_{1:2})P(w_4|w_{1:3})â€¦P(w_n|w_{1:n-1}),$$ æœ€åä¸€é¡¹åŸºäº<code>n-1</code>ä¸ªè¯çš„æ¡ä»¶æ¦‚ç‡è®¡ç®—éš¾åº¦éå¸¸å¤§ã€‚ä¸ºäº†ç®€åŒ–LMå‚æ•°çš„è®­ç»ƒï¼Œåˆ©ç”¨<code>k</code>é˜¶é©¬å°”å¯å¤«å‡è®¾ï¼Œå£°æ˜åºåˆ—çš„ä¸‹ä¸€ä¸ªè¯ä»…ä¾èµ–äºå‰<code>k</code>ä¸ªè¯ã€‚å¦‚åˆ©ç”¨ä¸€é˜¶é©¬å°”å¯å¤«å‡è®¾å¾—åˆ°<code>P(transparent | the water is so ) â‰ˆ P(transparent | so)</code>.</p><p>ä½¿ç”¨é©¬å°”å¯å¤«å‡è®¾ç®€åŒ–å‰é¢çš„ä¹˜é“¾:<br>$$\begin{align}<br>P(w_{1:n}) &amp;= \prod_{i=1}^n P(w_i | w_1, â€¦, w_{i-1}) \\<br>&amp;\propto \prod_{i=1}^n P(w_i | w_{i-k}, â€¦, w_{i-1}) \end{align}$$<br>åœ¨è¯­æ–™å¤„ç†æ—¶ï¼Œå¼€å¤´çš„å¥å­å‰é¢éœ€è¦ç›¸åº”çš„åŠ ä¸Š<code>k</code>ä¸ªè¡¥ä¸ç¬¦å·<code>&lt;s&gt;</code>ï¼Œæ‰èƒ½è®¡ç®—ç¬¬ä¸€ä¸ªè¯çš„æ¡ä»¶æ¦‚ç‡ã€‚LMä¹Ÿæ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹, ä¸€èˆ¬æ˜¯åœ¨å¥å­æœ«å°¾åŠ ä¸Šç‰¹æ®Šç¬¦å·<code>&lt;/s&gt;</code>è¡¨ç¤ºå¥å­ç»“æŸ, ä»¥æ–¹ä¾¿ç”Ÿæˆä»»åŠ¡æ—¶åˆ¤æ–­å¥å­çš„ç”Ÿæˆç»“æŸ.</p><p>å›ºç„¶Markovå‡è®¾å¯¹äºä»»æ„<code>k</code>é˜¶éƒ½æ˜¯æœ‰åå·®çš„ï¼ˆæ¯•ç«Ÿå¥å­å¯ä»¥æœ‰ä»»æ„é•¿çš„ä¾èµ–æ€§ï¼‰ï¼Œä½†ä»å¯ä»¥ä½¿ç”¨è¾ƒå°çš„kå»ºæ¨¡å‡ºè¾ƒå¼ºçš„LMï¼Œå¹¶ä¸”å‡ åå¹´æ¥ä¸€ç›´æ˜¯è¯­è¨€å»ºæ¨¡çš„ä¸»è¦æ–¹æ³•ã€‚</p><p>å¯¹äºLMå‚æ•°ä¸­æ¯ä¸€é¡¹ä¼¼ç„¶æ¦‚ç‡çš„ä¼°ç®—ï¼Œå¯ä»¥ä½¿ç”¨<strong>æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼ˆMLEï¼‰</strong>ï¼š$$P(w_{i}=m|w_{i-k:i-1}) = \frac{Count(w_{i-k:i})}{Count(w_{i-k:i-1})}$$</p><p>è¿™ä¸ªå°±æ˜¯ç»å…¸çš„N-gramæ¨¡å‹ã€‚</p><h2 id="N-Gramè¯­è¨€æ¨¡å‹"><a href="#N-Gramè¯­è¨€æ¨¡å‹" class="headerlink" title="N-Gramè¯­è¨€æ¨¡å‹"></a>N-Gramè¯­è¨€æ¨¡å‹</h2><p><code>N-Gram</code>è¯­è¨€æ¨¡å‹æ˜¯åŸºäº<code>N-1</code>é˜¶é©¬å°”å¯å¤«å‡è®¾ä¸”ç”±MLEä¼°ç®—å‡ºçš„LMã€‚<code>N-Gram</code>LM é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯å‡ºç°æ¦‚ç‡ä»…æ¡ä»¶äºå‰é¢çš„<code>(N-1)</code>ä¸ªå•è¯, ä»¥<code>The students opened their books</code>ä¸ºä¾‹:</p><ul><li><code>Bi-gram</code>: ç»Ÿè®¡$P(w_{i}=m|w_{i-1})$, <code>P(students | the)</code>, <code>P(opened | students)</code>, â€¦, å±äº<code>é©¬å°”å¯å¤«ä¸€é˜¶æ¨¡å‹</code>, å³å½“å‰<code>t</code>æ—¶é—´æ­¥çš„çŠ¶æ€ä»…è·Ÿ<code>t-1</code>ç›¸å…³.</li><li><code>Tri-gram</code>: <code>P(students | &lt;/s&gt; The)</code>, <code>P(opened | The students)</code>, <code>é©¬å°”å¯å¤«äºŒé˜¶æ¨¡å‹</code></li><li><code>Four-gram</code>: ä¾æ­¤ç±»æ¨</li></ul><p>ç‰¹æ®Šçš„<code>Uni-gram</code>: ç»Ÿè®¡$P(w_i)$, <code>P(the)</code>, <code>P(students)</code>, â€¦, æ­¤æ—¶æ•´ä¸ªæ¨¡å‹é€€åŒ–ä¸ºè¯è¢‹æ¨¡å‹, ä¸å†å±äºé©¬å°”å¯å¤«æ¨¡å‹, è€Œæ˜¯åŸºäºè´å¶æ–¯å‡è®¾, å³å„ä¸ªå•è¯æ˜¯æ¡ä»¶ç‹¬ç«‹çš„. æ‰€ä»¥ä¸€èˆ¬<code>N-gram</code>æ˜¯æŒ‡<code>N&gt;1</code>çš„.</p><p>N-Gramæ¨¡å‹å› ä¸ºä½¿ç”¨MLEä¼°ç®—å‚æ•°ï¼Œç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼š</p><ul><li>æ— æ³•å¾ˆå¥½åœ°è§£å†³NLPä¸­çš„é•¿è·ç¦»ä¾èµ–ç°è±¡, æ¯”å¦‚ä¸€èˆ¬è¡¨ç°æ¯”è¾ƒå¥½çš„Trigramè¯­è¨€æ¨¡å‹ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°ä¸¤æ­¥ä¹‹å¤–çš„è¯</li><li>æ²¡æœ‰è€ƒè™‘è¯çš„ç›¸ä¼¼æ€§ï¼Œæ³›åŒ–èƒ½åŠ›å·®ã€‚æ¯”å¦‚åœ¨è®­ç»ƒé›†å‡ºç°äº†<code>The cat is walking in the bedroom</code>,ç†è®ºä¸Šåº”è¯¥æ³›åŒ–åˆ°ç»™<code>A dog was running in a room</code>, å› ä¸º<code>dog</code>å’Œ<code>cat</code>(resp. â€œtheâ€ and â€œaâ€, â€œroomâ€ and â€œbedroomâ€, etcâ€¦)æœ‰ç±»ä¼¼çš„è¯­ä¹‰å’Œè¯­æ³•å®šä½.</li><li>N-gramåªæ˜¯åœ¨æµ‹è¯•è¯­æ–™åº“ä¸è®­ç»ƒè¯­æ–™åº“æ¯”è¾ƒç›¸ä¼¼æ—¶è¡¨ç°æ‰æ¯”è¾ƒå¥½ã€‚å¦åˆ™åŸºäºè®­ç»ƒè¯­æ–™è®­ç»ƒå‡ºæ¥çš„å‚æ•°è‚¯å®šæ— æ³•å¾ˆå¥½åœ°è¯„ä¼°æµ‹è¯•è¯­æ–™ï¼Œå°±åƒäººæ— æ³•å¯¹å…¶ä¸è®¤è¯†çš„è¯­è¨€åšä»»ä½•è¯­æ³•å¥æ³•ä¸Šçš„è¯„ä»·ã€‚</li><li>ç¨€ç–é—®é¢˜1ï¼šå¤§å¤šæ•°é«˜é˜¶Gramå‡ ä¹ä¸ä¼šå‡ºç°ï¼Œè™½ç„¶<code>u v w</code>åœ¨è®­ç»ƒè¯­æ–™ä¸­ä»æ¥æ²¡æœ‰å‡ºç°è¿‡, ä½†æˆ‘ä»¬ä¸èƒ½ç®€å•åœ°æŠŠ<code>P(w | u, v)</code>å®šä¹‰ä¸º0ï¼Œå› ä¸ºè¯­è¨€æ˜¯åƒå˜ä¸‡åŒ–çš„ï¼Œæœ‰äº›è¯ç»„è™½ç„¶å°‘è§ä½†ä¸ä»£è¡¨ä¸å­˜åœ¨ã€‚å¥å­çš„æ¦‚ç‡æ˜¯ç”±å„ä¸ªgramä¼¼ç„¶æ¦‚ç‡ç›¸ä¹˜è€Œæ¥ï¼Œå¦‚æœä»…ä»…å› ä¸ºä¸€ä¸ªè¯ç»„å‡ºç°æ¬¡æ•°ä¸º0å°±å¯¼è‡´æ•´ä¸ªå¥å­æ¦‚ç‡å˜ä¸º0, é‚£æ˜¾ç„¶æ˜¯ä¸åˆç†çš„.</li><li>ç¨€ç–é—®é¢˜2ï¼šéƒ¨åˆ†ä½é˜¶gramæ²¡æœ‰å‡ºç°è¿‡ï¼Œä½é˜¶gramçš„æ¬¡æ•°ä½œä¸ºMLEå…¬å¼ä¸­åˆ†æ¯å˜ä¸º0ï¼Œé‚£è®¡ç®—å°±æ²¡æ³•è¿›è¡Œä¸‹å»äº†.</li><li>ä¸€èˆ¬è€Œè¨€ï¼ŒNè¶Šé«˜ï¼Œæ¨¡å‹è¡¨ç°è¶Šå¥½ï¼Œä½†æ˜¯æ›´å¤§çš„Nä½¿ç¨€ç–é—®é¢˜å˜å¾—æ›´ç³Ÿã€‚é€šå¸¸äººä»¬ä¸ä¼šå–å¤§äº5çš„Nã€‚</li><li>éœ€è¦å­˜å‚¨æ‰€æœ‰å¯èƒ½çš„N-Gramï¼Œæ‰€ä»¥æ¨¡å‹çš„å¤§å°æ˜¯ <code>O(exp(n))</code>, éœ€è¦å¤§é‡çš„å†…å­˜ï¼Œè€Œå…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯å‡ºç°æ¬¡æ•°ä¸º0.</li></ul><h3 id="å¹³æ»‘"><a href="#å¹³æ»‘" class="headerlink" title="å¹³æ»‘"></a>å¹³æ»‘</h3><p>é’ˆå¯¹æ•°æ®ç¨€ç–é—®é¢˜ï¼ˆ0æ¦‚ç‡çš„é—®é¢˜ï¼‰, å¯ä»¥ä½¿ç”¨å„ç§å¹³æ»‘å¤„ç†ï¼ˆSmoothingï¼‰.</p><p>åŠ ä¸€ï¼ˆLaplaceï¼‰å¹³æ»‘ï¼šæœ€ç®€å•çš„å¹³æ»‘æ³•ï¼Œä¸ºæ‰€æœ‰äº‹ä»¶ï¼ˆä¸ç®¡æœ‰æ²¡å‡ºç°è¿‡ï¼‰çš„é¢‘æ¬¡åŠ ä¸€ï¼Œè¿™æ ·ä¿è¯äº†æ²¡æœ‰0æ¦‚ç‡äº‹ä»¶å‡ºç°ã€‚è¿™ç§å¹³æ»‘æ•ˆæœå¾ˆå·®ï¼Œå› ä¸ºé½å¤«å®šå¾‹<code>Zipf&#39;s law</code>çš„å…³ç³»</p><blockquote><p><code>Zipf&#39;s law</code>ï¼šåœ¨è‡ªç„¶è¯­è¨€çš„è¯­æ–™åº“é‡Œï¼Œä¸€ä¸ªå•è¯å‡ºç°çš„é¢‘ç‡ä¸å®ƒåœ¨é¢‘ç‡è¡¨é‡Œçš„æ’åæˆåæ¯”ã€‚</p></blockquote><p>ä¼šæœ‰å¾ˆå¤šé•¿å°¾å•è¯å¾ˆå°‘ç”šè‡³å‡ ä¹æ²¡æœ‰å‡ºç°è¿‡, æ‰€ä»¥åœ¨æ€»æ•°ä¸º1çš„æ¦‚ç‡æ± å­é‡Œ, ä¸ºäº†ç»™è¿™äº›é•¿å°¾å•è¯åˆ†é…è‡³å°‘é¢‘æ¬¡1çš„æ¦‚ç‡, éœ€è¦ä»çœŸæ­£å‡ºç°çš„å•è¯(æ‰€è°“çœŸå®å‘ç”Ÿçš„äº‹ä»¶)ä¸­åˆ†èµ°å¾ˆå¤šæ¦‚ç‡.</p><p>å› æ­¤å¯ä»¥ç»™Laplaceå¹³æ»‘åŠ å…¥æ§åˆ¶å› å­ï¼Œå˜ä¸º Add alpha smoothingã€‚æ›´å¤šå¹³æ»‘æ–¹æ¡ˆå‚è€ƒ<a href="/UoE-anlp#å¹³æ»‘Smoothing">UoE-anlp</a></p><h2 id="è¯­è¨€æ¨¡å‹è¯„ä¼°æ–¹æ³•"><a href="#è¯­è¨€æ¨¡å‹è¯„ä¼°æ–¹æ³•" class="headerlink" title="è¯­è¨€æ¨¡å‹è¯„ä¼°æ–¹æ³•"></a>è¯­è¨€æ¨¡å‹è¯„ä¼°æ–¹æ³•</h2><p>æ—¢ç„¶LMæ˜¯ç”¨äºè¯„ä¼°å¥å­æ˜¯å¦å‡†ç¡®çš„æ¨¡å‹ï¼Œé‚£ä¹ˆåœ¨è¯„ä»·LMå¥½åæ—¶ï¼Œå°±è¦çœ‹å®ƒåœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°å¦‚ä½•ã€‚ç»™å®šæµ‹è¯•é›†åŒ…å«$m$ä¸ªå¥å­$x^{(1)}, x^{(2)}, â€¦, x^{(m)}$, å„ä¸ªå¥å­çš„é•¿åº¦åˆ†åˆ«ä¸º$n_i$. LMç»™è¿™äº›æµ‹è¯•é›†å¥å­è¯„ä¼°çš„æ¦‚ç‡å¤§å°ä¸º$$\prod_{i=1}^m p(x^{(i)})$$ è¿™ä¸ªæ•°å€¼è¶Šé«˜ï¼Œè¯´æ˜LMè¯„ä¼°æµ‹è¯•é›†å¥å­çš„è´¨é‡è¶Šå¥½ã€‚<strong>æ³¨æ„, æµ‹è¯•é›†å¿…é¡»æ˜¯å®Œå…¨æ²¡æœ‰å‚ä¸æ¨¡å‹è®­ç»ƒ, ä¸”æ˜¯åœ¨äººç±»æ ‡å‡†ä¸­æ˜¯å¥½çš„å¥å­.</strong></p><p>ä½†åœ¨å®é™…ä½¿ç”¨ä¸­, æˆ‘ä»¬å¾€å¾€ä½¿ç”¨ä¸Šé¢è¿™ä¸ªæ¦‚ç‡çš„ä¸€ç§å˜æ¢ - <code>å›°æƒ‘åº¦</code>ï¼ˆ<code>Perplexity</code>ï¼‰æ¥è¯„ä»·LMçš„è´¨é‡. é¦–å…ˆå–æ•´ä¸ªæµ‹è¯•è¯­æ–™åº“çš„å¯¹æ•°æ¦‚ç‡é™¤ä»¥æµ‹è¯•è¯­æ–™åº“ä¸­çš„å•è¯æ€»æ•°$M$: $$l = \frac{1}{M} \log_2 \prod_{i=1}^m p(x^{(i)}) = \frac{1}{M} \sum_{i=1}^m \log_2 p(x^{(i)})$$<br>ç„¶åå¾—åˆ°<br>$$\begin{align}<br>Perplexity &amp;= 2^{-l} \\<br>&amp;= 2^{-\frac{1}{M} \sum_{i=1}^m \log_2 p(x^{(i)})}\\<br>\\<br>&amp;= t^{-1}<br>\end{align}$$<br>å…¶ä¸­ï¼Œ$t = \sqrt[\leftroot{-2}\uproot{2}M]{\prod_{i=1}^m p(x^{(i)})}$, ä½œä¸ºæµ‹è¯•é›†æ¦‚ç‡çš„å‡ ä½•å¹³å‡. ä¾‹å¦‚ï¼Œå¦‚æœå›°æƒ‘ç­‰äº100ï¼Œåˆ™$t = 0.01$ï¼Œè¡¨æ˜å‡ ä½•å¹³å‡å€¼ä¸º0.01. å¯ä»¥çœ‹åˆ°, Perplexityçš„å€¼è¶Šå°ï¼Œè¯­è¨€æ¨¡å‹å»ºæ¨¡æµ‹è¯•é›†çš„èƒ½åŠ›å°±è¶Šå¥½.</p><p>æ¦‚ç‡å–å¯¹æ•°è½¬æ¢å¯ä»¥é¿å…æ•°å€¼ä¸‹æº¢ï¼Œå¯ä»¥æŠŠä¹˜æ³•è½¬æ¢ä¸ºåŠ æ³•, è®¡ç®—ä¹Ÿæ›´å¿«.</p><p>å›°æƒ‘åº¦ä¸ºä½•å°±æ˜¯ä¸€ç§å¥½çš„è¡¡é‡æ ‡å‡†å‘¢ï¼Ÿå¯¹äºä»»ä½•ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰Baselineæ¨¡å‹ä½œä¸ºåŸºå‡†ï¼Œå¦‚æœåç»­æœ‰ä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼Œä½†æ— æ³•è¶…è¿‡æ­¤baselineï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªæ–°çš„æ¨¡å‹æ˜¯æ²¡æœ‰è¿›æ­¥çš„ã€‚å¯¹äºè¯­è¨€å»ºæ¨¡è¿™ä¸€ä¸ªä»»åŠ¡ï¼Œæœ€æ— è„‘æœ€ç®€å•çš„baselineï¼Œå°±æ˜¯å‡è®¾æ¯ä¸€ä¸ªä½ç½®çš„æ¯ä¸ªå•è¯å‡ºç°æ¦‚ç‡ç›¸ç­‰ï¼Œè¿™å°±æ˜¯æœ€å¤§ç†µåˆ†å¸ƒï¼Œå³å‡è®¾æ­¤baselineå¯¹è¿™ä¸ªä»»åŠ¡ä¸€æ— æ‰€çŸ¥ï¼Œæ‰€æœ‰ä½ç½®æ‰€æœ‰å•è¯åœ¨å®ƒçœ¼é‡Œéƒ½æ˜¯æ²¡åŒºåˆ«çš„(å‡åŒ€åˆ†å¸ƒ)ã€‚å¦‚æœè¯æ±‡é›†(åŒ…å«<code>&lt;/s&gt;</code>)å¤§å°ä¸º<code>N</code>, é‚£ä¹ˆ$$P_{i \in T}(w_i | w_{1:i-1}) = \frac{1}{N},$$ æ­¤æ—¶çš„å›°æƒ‘åº¦ç­‰äº<code>N</code>, å³åœ¨å‡åŒ€æ¦‚ç‡åˆ†å¸ƒæ¨¡å‹ä¸‹ï¼Œå›°æƒ‘åº¦ç­‰äºè¯æ±‡é‡çš„å¤§å°ã€‚æ˜¾è€Œæ˜“è§ä»»ä½•ä¸€ä¸ªæœ‰æ•ˆæ¨¡å‹çš„å›°æƒ‘åº¦å¿…é¡»å°äºç±»åˆ«ä¸ªæ•°. æ­¤æ—¶å›°æƒ‘åº¦å¯ä»¥ç†è§£ä¸ºæ¨¡å‹çš„<strong>æœ‰æ•ˆè¯æ±‡é‡</strong>ï¼šä¾‹å¦‚ï¼Œè¯æ±‡é‡å¤§å°ä¸º10,000, è€Œæ¨¡å‹çš„å›°æƒ‘åº¦ä¸º120ï¼Œé‚£ä¹ˆè¿™å¤§è‡´è¯´æ˜æœ‰æ•ˆçš„è¯æ±‡é‡åªæœ‰å¤§æ¦‚120ä¸ªã€‚æœ€ä½³æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯æŠŠæµ‹è¯•é›†çš„æ¦‚ç‡é¢„æµ‹ä¸º 1, æ­¤æ—¶å›°æƒ‘åº¦ä¸º 1ã€‚æœ€åæƒ…å†µä¸‹ï¼Œæ¦‚ç‡é¢„æµ‹ä¸º 0, æ­¤æ—¶å›°æƒ‘åº¦ä¸ºæ­£æ— ç©·ã€‚Baselineæ¨¡å‹æ€»æ˜¯é¢„æµ‹æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡éƒ½ç›¸åŒ, æ­¤æ—¶å›°æƒ‘åº¦ä¸ºè¯æ±‡é‡å¤§å°ï¼ˆç±»åˆ«ä¸ªæ•°ï¼‰ã€‚</p><p>ç›®å‰å¾ˆå¤šç¥ç»ç½‘ç»œæ¡†æ¶è®¡ç®—è¯­è¨€æ¨¡å‹çš„æŸå¤±å‡½æ•°éƒ½æ˜¯ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å¹¶å–å¯¹æ•°,<br>è¦å¾—åˆ°perplexityï¼Œåªéœ€è¦æŠŠè¿™ä¸ªlosså–æŒ‡æ•°è¿ç®—ã€‚</p><p>é‚£ä¹ˆå›°æƒ‘åº¦ä¸€èˆ¬éƒ½æ˜¯å¤šå¤§å‘¢ï¼ŸGoodman (â€œA bit of progress in language modelingâ€, figure 2) è¯„ä¼°äº†åœ¨è‹±è¯­æ•°æ®ä¸Šçš„unigramï¼Œbigramå’Œtrigramè¯­è¨€æ¨¡å‹ï¼Œè¯æ±‡é‡ä¸º50,000ã€‚Goodmançš„æŠ¥å‘Šç»“æœæ˜¾ç¤ºï¼Œtrigramæ¨¡å‹çš„å›°æƒ‘åº¦çº¦ä¸º74ï¼Œbigramæ¨¡å‹ä¸º137ï¼Œunigramæ¨¡å‹ä¸º955ã€‚ç›¸æ¯”äºBaselineæ¨¡å‹å›°æƒ‘åº¦50,000ï¼Œtrigramæ¨¡å‹æ˜¾ç„¶æœ‰äº†å·¨å¤§çš„æ”¹è¿›ï¼Œä¸”æ¯”bigramå’Œunigramæ¨¡å‹ä¹Ÿæœ‰å¾ˆå¤§çš„æ”¹è¿›ã€‚è€Œæ›´å¼ºå¤§çš„SOTAç¥ç»è¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥åœ¨wikitext-2æ•°æ®é›†ä¸Šè·‘å‡º40ä»¥ä¸‹çš„å›°æƒ‘åº¦ã€‚</p><h2 id="ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹"><a href="#ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹" class="headerlink" title="ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹"></a>ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹</h2><p>ç¥ç»ç½‘ç»œæ¨¡å‹è§£å†³äº†ä¼ ç»Ÿè¯­è¨€æ¨¡å‹çš„ä¸€äº›ç¼ºç‚¹ï¼šå®ƒä»¬å…è®¸è¶Šæ¥è¶Šé•¿çš„è·ç¦»ä¾èµ–ï¼Œè€Œå‚æ•°æ•°é‡ä»…çº¿æ€§å¢åŠ ï¼Œå®ƒä»¬å‡å°‘äº†æ‰‹åŠ¨è®¾è®¡backoffé¡ºåºçš„éœ€è¦ï¼Œå¹¶ä¸”å®ƒä»¬æ”¯æŒè·¨ä¸åŒä¸Šä¸‹æ–‡çš„æ³›åŒ–ã€‚</p><p><code>Bengio et al. [2003]</code>æå‡ºçš„ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹(NNLM, ç¡®åˆ‡çš„è¯´æ˜¯å‰é¦ˆç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹), æŠŠæ–‡æœ¬å¤„ç†æˆnä¸ªk-gramè¯çª—å£$w_{i:i+k-1}$,  æ¯ä¸ªè¯è½¬æ¢ä¸ºè¯é•¶åµŒçš„å½¢å¼$\mathcal{v}(w) \in \mathcal{R}^{d_w}$, ä¸€æ•´ä¸ªçª—å£çš„è¯å‘é‡æ‹¼æ¥ä¸ºçŸ©é˜µå‘é‡$x = [\mathcal{v}(w_0); â€¦; \mathcal{v}(w_{k-1})]$, ä½œä¸ºè¾“å…¥æ•°æ®è¾“å…¥åˆ°ä¸€ä¸ª1åˆ°2å±‚çš„æ„ŸçŸ¥æœº.</p><p>è®­ç»ƒæ•°æ®çš„å¤„ç†ä¸€èˆ¬è¿™ä¹ˆæ“ä½œ, æ¯ä¸ªå¥å­çš„å¼€å¤´åŠ ä¸Š<code>&lt;s&gt;</code>, æœ«å°¾åŠ ä¸Š<code>&lt;/s&gt;</code>, ç„¶åæŒ‰ç…§kå¤§å°çš„é•¿åº¦ä¸€æ®µæ®µæˆªæ–­æˆk-gramè¯çª—å£$w_{i:i+k-1}$. æ¯ä¸€æ®µk-gramçš„è¯æ‹¼æ¥ä¸ºä¸€ä¸ªå‘é‡$x = (C(w_{i}), C(w_{i+1}), Â·Â·Â·, C(w_{i+k-1}))$, ä½œä¸ºä¸€ä¸ªè®­ç»ƒæ ·æœ¬, å…¶æœ«å°¾çš„ä¸‹ä¸€ä¸ªè¯$w_{i+k}$ä½œä¸ºæ ·æœ¬å¯¹åº”çš„é¢„æµ‹æ ‡ç­¾$y_i = \mathcal{v}(w_{i+k})$. è®­ç»ƒæ—¶ï¼Œä»¥è¾“å‡ºçš„è¯å‘é‡æ¦‚ç‡åˆ†å¸ƒå‘é‡å’Œå¯¹åº”æ­£ç¡®æ ‡ç­¾çš„ one-hot-vector é—´çš„ cross-entropy loss ä¸ºæŸå¤±å‡½æ•°.</p><p>ç¥ç»ç½‘ç»œçš„å‚æ•°æ•°é‡æ¯”ä¼ ç»Ÿçš„N-gramå°‘ï¼Œå› ä¸ºå…¶æ¯å¢åŠ ä¸€ä¸ªè¯ï¼Œå‚æ•°å°±å¤š$d_w$, ä¹Ÿå°±æ˜¯çº¿æ€§å¢åŠ , è€ŒN-gramæ˜¯å¤šé¡¹å¼å¢åŠ é€Ÿç‡. å¹¶ä¸”NNLMçš„å‚æ•°çŸ©é˜µå¯¹æ‰€æœ‰è¾“å…¥éƒ½æ˜¯å…±äº«çš„, è¿™è¿›ä¸€æ­¥å‡å°‘äº†å‚æ•°é‡. è™½ç„¶å¦‚æ­¤, NNLMçš„è®­ç»ƒæ—¶é—´è¿˜æ˜¯æ¯”N-gram LMé•¿.</p><p>ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æ›´å¥½ï¼Œå› ä¸ºç›¸ä¼¼çš„è¯å…·æœ‰ç›¸ä¼¼çš„ç‰¹å¾å‘é‡ï¼Œå¹¶ä¸”å› ä¸ºæ¦‚ç‡å‡½æ•°ï¼ˆæ¨¡å‹å‚æ•°ï¼‰æ˜¯è¿™äº›ç‰¹å¾å€¼çš„å¹³æ»‘å‡½æ•°ï¼Œæ‰€ä»¥ç‰¹å¾çš„å¾®å°å˜åŒ–ç›¸åº”åœ°å¼•èµ·æ¦‚ç‡çš„å¾®å°å˜åŒ–ã€‚</p><p>çœŸæ­£å½±å“NNLMè®¡ç®—æ•ˆç‡çš„æ˜¯è¾“å‡ºå±‚çš„softmaxè®¡ç®—, å› ä¸ºè®­ç»ƒæ ·æœ¬çš„è¯æ±‡é‡$\mathcal{V}$å¾€å¾€å¾ˆå¤§. è¾“å‡ºå±‚çš„softmaxéœ€è¦ä¸éšå«å±‚å‚æ•°çŸ©é˜µ$W^2 \in \mathcal{R}^{d_{hid} \times \mathcal{V}}$è¿›è¡Œæ˜‚è´µçš„çŸ©é˜µå‘é‡ä¹˜æ³•, ç„¶åè¿›è¡Œ$\mathcal{V}$æ¬¡å¯¹æ•°æ“ä½œ. è¿™éƒ¨åˆ†è®¡ç®—å æ®äº†å¤§éƒ¨åˆ†è¿è¡Œæ—¶é—´ï¼Œä½¿å¾—å¤§è¯æ±‡é‡çš„NNLMå»ºæ¨¡ä»¤äººæœ›è€Œå´æ­¥ã€‚</p><p>åç»­å‘å±•çš„NNLMæ™®éä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNN, LSTMï¼‰æ¥ä»£æ›¿ç®€å•çš„å‰é¦ˆç¥ç»ç½‘ç»œã€‚å¾ªç¯ç¥ç»ç½‘ç»œå¯ä»¥ç†è§£ä¸ºå¤šå±‚å‰é¦ˆç¥ç»ç½‘ç»œå åŠ , ä½†å„ç¥ç»ç½‘ç»œéšå«å±‚çš„å‚æ•°æ˜¯å…±äº«çš„. å¥å­é€è¯è¾“å…¥å¾ªç¯ç¥ç»ç½‘ç»œ, ä¹Ÿå°±æ˜¯å¾ªç¯ç¥ç»ç½‘ç»œä½¿ç”¨åŒæ ·å‚æ•°æ–¹ç¨‹æ¥å¤„ç†æ¯ä¸€ä¸ªè¯, å› æ­¤å¾ªç¯ç¥ç»ç½‘ç»œçš„å‚æ•°é‡æ¯”å‰é¦ˆç¥ç»ç½‘ç»œæ›´å°‘. ä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œä½œä¸ºLMæ¨¡å‹æ—¶, åŒæ ·æœ€åä¸€å±‚è¿˜æ˜¯ä½¿ç”¨softmaxè¾“å‡ºå±‚ã€‚ä¸åŒçš„æ˜¯è¾“å…¥ä¸å†å±€é™äºå®šé•¿çš„kgramè¯çª—å£ï¼ŒLSTMç†è®ºä¸Šå¯ä»¥æ¥å—æ— é™é•¿åºåˆ—, ä½†äº‹å®ä¸ŠLSTMçš„è®°å¿†èƒ½åŠ›ä¹Ÿæ˜¯æœ‰é™çš„, å¤ªé•¿å°±ä¼šé—å¿˜æ‰å‰é¢çš„ä¿¡æ¯.</p><h3 id="å¯¹å¤§è¯æ±‡é‡è¯­è¨€æ¨¡å‹çš„å°è¯•"><a href="#å¯¹å¤§è¯æ±‡é‡è¯­è¨€æ¨¡å‹çš„å°è¯•" class="headerlink" title="å¯¹å¤§è¯æ±‡é‡è¯­è¨€æ¨¡å‹çš„å°è¯•"></a>å¯¹å¤§è¯æ±‡é‡è¯­è¨€æ¨¡å‹çš„å°è¯•</h3><p>Hierarchical softmax [Morin and Bengio, 2005]</p><p>Self-normalizing aproaches, æ¯”å¦‚ noise-contrastive estimation (NCE) <code>[Mnih and Teh, 2012, Vaswani et al., 2013]</code> æˆ–è€…åœ¨è®­ç»ƒç›®æ ‡å‡½æ•°ä¸­åŠ å…¥æ­£åˆ™åŒ–é¡¹ <code>[Devlin et al., 2014]</code>.</p><p>æœ‰å…³å¤„ç†å¤§è¾“å‡ºè¯æ±‡è¡¨çš„è¿™äº›å’Œå…¶ä»–æŠ€æœ¯çš„è‰¯å¥½è¯„è®ºå’Œæ¯”è¾ƒï¼Œè¯·å‚é˜… <code>Chen et al. [2016]</code>.</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>class notes by Michael Collins: <a href="http://www.cs.columbia.edu/~mcollins/lm-spring2013.pdf" target="_blank" rel="noopener">http://www.cs.columbia.edu/~mcollins/lm-spring2013.pdf</a><br>Neural Network Methods in Natural Language Processing, by Yoav Goldberg</p><p>A Neural Probabilistic Language Model, Yoshua Bengio, 2003</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;è¯­è¨€æ¨¡å‹&quot;&gt;&lt;a href=&quot;#è¯­è¨€æ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;è¯­è¨€æ¨¡å‹&quot;&gt;&lt;/a&gt;è¯­è¨€æ¨¡å‹&lt;/h2&gt;&lt;p&gt;è¯­è¨€æ¨¡å‹Language modelingï¼ˆLMï¼‰æœ€åˆæ˜¯é’ˆå¯¹è¯­éŸ³è¯†åˆ«é—®é¢˜è€Œå¼€å‘çš„, ç°åœ¨å¹¿æ³›ç”¨äºå…¶ä»–NLPåº”ç”¨ä¸­, æ¯”å¦‚æœºå™¨ç¿»è¯‘éœ€è¦åˆ©ç”¨LMæ¥ç»™ç¿»è¯‘å‡ºçš„å¥å­æ‰“åˆ†.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>ä¿¡æ¯æŠ½å–</title>
    <link href="http://shukebeta.me/NLP-information-extraction/"/>
    <id>http://shukebeta.me/NLP-information-extraction/</id>
    <published>2018-11-10T16:00:00.000Z</published>
    <updated>2018-12-17T13:07:21.086Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¿¡æ¯æŠ½å–"><a href="#ä¿¡æ¯æŠ½å–" class="headerlink" title="ä¿¡æ¯æŠ½å–"></a>ä¿¡æ¯æŠ½å–</h2><p>1997å¹´MUCä¼šè®®ï¼ˆMUC-7ï¼‰ å¬å¼€æ—¶ï¼Œè¯„æµ‹ä»»åŠ¡å·²ç»å¢åŠ åˆ°5ä¸ªï¼š<br>â‘  åœºæ™¯æ¨¡æ¿ï¼ˆscenario template, STï¼‰å¡«å……ï¼šå®šä¹‰äº†æè¿°åœºæ™¯çš„æ¨¡æ¿åŠæ§½å¡«å……è§„èŒƒï¼›<br>â‘¡ å‘½åå®ä½“ï¼ˆnamed entity, NEï¼‰è¯†åˆ«ï¼šè¯†åˆ«å‡ºæ–‡æœ¬ä¸­å‡ºç°çš„ä¸“æœ‰åç§°å’Œæœ‰æ„ä¹‰çš„æ•°é‡çŸ­è¯­ï¼Œ å¹¶åŠ ä»¥å½’ç±»ï¼›<br>â‘¢ å…±æŒ‡ï¼ˆcoreference, CRï¼‰å…³ç³»ç¡®å®šï¼šè¯†åˆ«å‡ºç»™å®šæ–‡æœ¬ä¸­çš„å‚ç…§è¡¨è¾¾ï¼ˆ referring expressionsï¼‰ï¼Œå¹¶ç¡®å®šè¿™äº›è¡¨è¾¾ä¹‹é—´çš„å…±æŒ‡å…³ç³»ï¼›<br>â‘£ æ¨¡æ¿å…ƒç´ ï¼ˆtemplate element, TEï¼‰å¡«å……ï¼šç±»ä¼¼äºäººåå’Œç»„ç»‡æœºæ„åè¯†åˆ«ï¼Œä½†æ˜¯è¦æ±‚ç³»ç»Ÿå¿…é¡»è¯†åˆ«å‡ºå®ä½“çš„æè¿°å’Œåå­—ï¼Œå¦‚æœä¸€ä¸ªå®ä½“åœ¨æ–‡æœ¬ä¸­è¢«æåˆ°äº†å¤šæ¬¡ï¼Œä½¿ç”¨äº†å‡ ç§å¯èƒ½çš„æè¿°å’Œä¸åŒçš„åå­—å½¢å¼ï¼Œè¦æ±‚ç³»ç»Ÿéƒ½è¦æŠŠå®ƒä»¬è¯†åˆ«å‡ºæ¥ï¼Œä¸€ä¸ªæ–‡æœ¬ä¸­çš„æ¯ä¸ªå®ä½“åªæœ‰ä¸€ä¸ªæ¨¡æ¿å…ƒç´ ï¼»Grishman and Sundheim, 1996ï¼½ï¼›<br>â‘¤ æ¨¡æ¿å…³ç³»ï¼ˆtemplate relation, TRï¼‰ï¼šç¡®å®šå®ä½“ä¹‹é—´ä¸ç‰¹å®šé¢†åŸŸæ— å…³çš„å…³ç³»ã€‚<br><a id="more"></a></p><p>1999å¹´èµ·ç¾å›½NISTç»„ç»‡äº†è‡ªåŠ¨å†…å®¹æŠ½å–ï¼ˆautomatic content extraction, ACEï¼‰è¯„æµ‹ä¼šè®®ï¼Œæ—¨åœ¨ç ”ç©¶å’Œ<br>å¼€å‘è‡ªåŠ¨å†…å®¹æŠ€æœ¯ä»¥æ”¯æŒå¯¹ä¸‰ç§ä¸åŒæ¥æºæ–‡æœ¬ï¼ˆæ™®é€šæ–‡æœ¬ã€ç»è¯­éŸ³è¯†åˆ«åå¾—åˆ°çš„æ–‡æœ¬ã€ ç”±OCRè¯†åˆ«å¾—åˆ°çš„æ–‡æœ¬ï¼‰çš„è‡ªåŠ¨å¤„ç†ï¼Œä»¥å®ç°æ–°é—»è¯­æ–™ä¸­å‡ºç°çš„å®ä½“ã€å…³ç³»ã€äº‹ä»¶ç­‰å†…å®¹çš„è‡ªåŠ¨æŠ½å–ã€‚è¯„æµ‹ä»»åŠ¡è®¾è®¡:<br>å®ä½“æ£€æµ‹ä¸è·Ÿè¸ªï¼ˆentity detection and tracking, EDTï¼‰ã€æ•°å€¼æ£€æµ‹ä¸è¯†åˆ«ï¼ˆvalue detection and recognition, VDRï¼‰ã€æ—¶é—´è¯†åˆ«å’Œè§„èŒƒåŒ–ï¼ˆtime expression recognition and normalization, TERNï¼‰ã€å…³ç³»æ£€æµ‹ä¸æè¿°ï¼ˆrelation detection and characterization, RDCï¼‰ã€äº‹ä»¶æ£€æµ‹ä¸æè¿°ï¼ˆevent detection and characterization, EDCï¼‰å’Œå®ä½“ç¿»è¯‘ï¼ˆentity translation, ETï¼‰ç­‰ã€‚</p><h3 id="TF-IDF-å…³é”®è¯æŠ½å–"><a href="#TF-IDF-å…³é”®è¯æŠ½å–" class="headerlink" title="TF-IDF å…³é”®è¯æŠ½å–"></a>TF-IDF å…³é”®è¯æŠ½å–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba.analyse</span><br><span class="line">jieba.analyse.extract_tags(sentence, topK=<span class="number">20</span>, withWeight=<span class="keyword">False</span>, allowPOS=())</span><br></pre></td></tr></table></figure><p><code>sentence</code> ä¸ºå¾…æå–çš„æ–‡æœ¬<br><code>topK</code> ä¸ºè¿”å›å‡ ä¸ª TF/IDF æƒé‡æœ€å¤§çš„å…³é”®è¯ï¼Œé»˜è®¤å€¼ä¸º <code>20</code><br><code>withWeight</code> ä¸ºæ˜¯å¦ä¸€å¹¶è¿”å›å…³é”®è¯æƒé‡å€¼ï¼Œé»˜è®¤å€¼ä¸º <code>False</code><br><code>allowPOS</code> ä»…åŒ…æ‹¬æŒ‡å®šè¯æ€§çš„è¯ï¼Œé»˜è®¤å€¼ä¸ºç©ºï¼Œå³ä¸ç­›é€‰. å¦‚ç”µå•†è¯„è®ºæŒ‡å®šè¦å½¢å®¹è¯</p><p>å…³é”®è¯æå–æ‰€ä½¿ç”¨é€†å‘æ–‡ä»¶é¢‘ç‡ï¼ˆIDFï¼‰æ–‡æœ¬è¯­æ–™åº“å¯ä»¥åˆ‡æ¢æˆè‡ªå®šä¹‰è¯­æ–™åº“çš„è·¯å¾„, ç”¨æ³•ï¼š <code>jieba.analyse.set_idf_path(file_name) # file_nameä¸ºè‡ªå®šä¹‰è¯­æ–™åº“çš„è·¯å¾„</code><br>è‡ªå®šä¹‰è¯­æ–™åº“ç¤ºä¾‹è§ <a href="https://github.com/fxsjy/jieba/blob/master/extra_dict/idf.txt.big" target="_blank" rel="noopener">https://github.com/fxsjy/jieba/blob/master/extra_dict/idf.txt.big</a><br>ç”¨æ³•ç¤ºä¾‹è§ <a href="https://github.com/fxsjy/jieba/blob/master/test/extract_tags_idfpath.py" target="_blank" rel="noopener">https://github.com/fxsjy/jieba/blob/master/test/extract_tags_idfpath.py</a></p><p>å…³é”®è¯æå–æ‰€ä½¿ç”¨åœæ­¢è¯ï¼ˆStop Wordsï¼‰æ–‡æœ¬è¯­æ–™åº“å¯ä»¥åˆ‡æ¢æˆè‡ªå®šä¹‰è¯­æ–™åº“çš„è·¯å¾„, ç”¨æ³•ï¼š <code>jieba.analyse.set_stop_words(file_name) # file_nameä¸ºè‡ªå®šä¹‰è¯­æ–™åº“çš„è·¯å¾„</code><br>è‡ªå®šä¹‰è¯­æ–™åº“ç¤ºä¾‹è§ <a href="https://github.com/fxsjy/jieba/blob/master/extra_dict/stop_words.txt" target="_blank" rel="noopener">https://github.com/fxsjy/jieba/blob/master/extra_dict/stop_words.txt</a><br>ç”¨æ³•ç¤ºä¾‹è§ <a href="https://github.com/fxsjy/jieba/blob/master/test/extract_tags_stop_words.py" target="_blank" rel="noopener">https://github.com/fxsjy/jieba/blob/master/test/extract_tags_stop_words.py</a></p><p>å…³é”®è¯ä¸€å¹¶è¿”å›å…³é”®è¯æƒé‡å€¼ <a href="https://github.com/fxsjy/jieba/blob/master/test/extract_tags_with_weight.py" target="_blank" rel="noopener">https://github.com/fxsjy/jieba/blob/master/test/extract_tags_with_weight.py</a></p><h3 id="TextRank"><a href="#TextRank" class="headerlink" title="TextRank"></a>TextRank</h3><p>è®ºæ–‡ï¼š<a href="http://web.eecs.umich.edu/~mihalcea/papers/mihalcea.emnlp04.pdf" target="_blank" rel="noopener">TextRank: Bringing Order into Texts</a>.</p><ul><li>å°†å¾…æŠ½å–å…³é”®è¯çš„æ–‡æœ¬è¿›è¡Œåˆ†è¯</li><li>ä»¥å›ºå®šçª—å£å¤§å°(é»˜è®¤ä¸º5ï¼Œé€šè¿‡spanå±æ€§è°ƒæ•´)ï¼Œè¯ä¹‹é—´çš„å…±ç°å…³ç³»ï¼Œæ„å»ºå›¾</li><li>è®¡ç®—å›¾ä¸­èŠ‚ç‚¹çš„PageRankï¼Œæ˜¯æ— å‘å¸¦æƒå›¾</li><li>æ•°æ®é‡è¶Šå¤§ï¼Œæ„å»ºçš„å›¾è¶Šç²¾å‡†</li></ul><p><code>jieba.analyse.textrank(sentence, topK=20, withWeight=False, allowPOS=(&#39;ns&#39;, &#39;n&#39;, &#39;vn&#39;, &#39;v&#39;))</code> é»˜è®¤è¿‡æ»¤è¯æ€§ã€‚<code>jieba.analyse.TextRank()</code> æ–°å»ºè‡ªå®šä¹‰å®ä¾‹</p><h2 id="å¼€æ”¾å¼ä¿¡æ¯æŠ½å–"><a href="#å¼€æ”¾å¼ä¿¡æ¯æŠ½å–" class="headerlink" title="å¼€æ”¾å¼ä¿¡æ¯æŠ½å–"></a>å¼€æ”¾å¼ä¿¡æ¯æŠ½å–</h2><p>å¤„ç†çš„æ–‡æœ¬é¢†åŸŸä¸å†é™å®šäºè§„èŒƒçš„æ–°é—»æ–‡æœ¬æˆ–è€…æŸä¸€é¢†åŸŸæ–‡æœ¬ï¼Œè€Œæ˜¯ä¸é™å®šé¢†åŸŸçš„ç½‘ç»œæ–‡æœ¬, ä¸ä»…éœ€è¦è€ƒè™‘æ–‡æœ¬<br>ç‰¹å¾ï¼ŒåŒæ—¶éœ€è¦ç»¼åˆè€ƒè™‘ç½‘é¡µç»“æ„ç‰¹å¾å’Œç”¨æˆ·è¡Œä¸ºç‰¹å¾ç­‰ã€‚</p><h3 id="å¼€æ”¾å¼å®ä½“æŠ½å–"><a href="#å¼€æ”¾å¼å®ä½“æŠ½å–" class="headerlink" title="å¼€æ”¾å¼å®ä½“æŠ½å–"></a>å¼€æ”¾å¼å®ä½“æŠ½å–</h3><p>å¼€æ”¾å¼å®ä½“æŠ½å–å…³æ³¨çš„æ˜¯ä»æµ·é‡ã€å†—ä½™ã€ä¸è§„èŒƒçš„ç½‘ç»œæ•°æ®æºä¸ŠæŠ½å–å‡ºç¬¦åˆæŸä¸ªè¯­ä¹‰ç±»çš„å®ä½“åˆ—è¡¨ï¼Œä¾§é‡äºæŠ½å–ã€‚</p><p>åŸºäºè¿™æ ·çš„å‡è®¾ï¼šåŒç±»å®ä½“åœ¨ç½‘ç»œä¸Šå…·æœ‰ç›¸ä¼¼çš„ç½‘é¡µç»“æ„æˆ–è€…ç›¸ä¼¼çš„ä¸Šä¸‹æ–‡ç‰¹å¾ã€‚å› æ­¤å¯ä»¥æ ¹æ®ç»™å‡ºçš„ç‰¹å®šè¯­ä¹‰ç±»çš„è‹¥å¹²å®ä½“ï¼ˆâ€œç§å­â€ï¼‰ï¼Œæ‰¾å‡ºè¯¥è¯­ä¹‰ç±»åŒ…å«çš„å…¶ä»–å®ä½“ï¼Œå…¶ä¸­ç‰¹å®šè¯­ä¹‰ç±»çš„æ ‡ç­¾å¯èƒ½æ˜¯æ˜¾å¼ï¼Œä¹Ÿå¯èƒ½æ˜¯éšå¼ç»™å‡ºçš„ã€‚å¦‚ç»™å‡ºâ€œä¸­å›½ã€ç¾å›½ã€ä¿„ç½—æ–¯â€è¿™ä¸‰ä¸ªå®ä½“ï¼Œè¦æ±‚æ‰¾å‡ºâ€œå›½å®¶â€è¿™ä¸ªè¯­ä¹‰ç±»çš„å…¶ä»–å®ä½“è¯¸å¦‚â€œå¾·å›½ã€æ³•å›½ã€æ—¥æœ¬â€ç­‰ã€‚</p><p>è®­ç»ƒæ­¥éª¤åŒ…å«ä¸¤éƒ¨åˆ†ï¼šå€™é€‰å®ä½“è·å–å’Œå€™é€‰å®ä½“ç½®ä¿¡åº¦è®¡ç®—å’Œæ’åºã€‚</p><p>å…·ä½“è®­ç»ƒè¿‡ç¨‹ï¼šé€šå¸¸ä»ç§å­å®ä½“å‡ºå‘ï¼Œé€šè¿‡åˆ†æç§å­å®ä½“åœ¨è¯­æ–™ä¸­çš„ä¸Šä¸‹æ–‡ç‰¹å¾å¾—åˆ°æ¨¡æ¿ï¼Œæ ¹æ®æ¨¡æ¿å¾—åˆ°æ›´å¤šå€™é€‰å®ä½“ï¼Œé€‰å–ç½®ä¿¡åº¦é«˜çš„å€™é€‰å®ä½“ä½œä¸ºæ–°ç§å­è¿›è¡Œè¿­ä»£ï¼Œæ»¡è¶³ä¸€å®šæ¡ä»¶ååœæ­¢è¿­ä»£ï¼Œ è¿”å›<br>å†æ¬¡ç½®ä¿¡åº¦é«˜çš„å€™é€‰å®ä½“ä½œä¸ºç»“æœè¾“å‡ºã€‚</p><p>æŠ½å–æ¯”è¯†åˆ«åœ¨ä»»åŠ¡ä¸Šæ›´åŠ åº•å±‚ï¼Œå®ä½“æŠ½å–çš„ç»“æœå¯ä»¥ä½œä¸ºåˆ—è¡¨æ”¯æ’‘å®ä½“çš„è¯†åˆ«ã€‚</p><p>å¯¹äºä¸­æ–‡è€Œè¨€ï¼Œå½“ä¸å­˜åœ¨ç½‘é¡µç»“æ„ç‰¹å¾æ—¶ï¼Œå®ä½“æŠ½å–ä»»åŠ¡å˜å¾—æ›´åŠ å›°éš¾ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› æ¥è‡ªæ±‰è¯­åˆ†è¯ï¼ŒæœªçŸ¥å®ä½“å¾€å¾€åœ¨åˆ†è¯è¿‡ç¨‹ä¸­è¢«åˆ†å¼€ã€‚</p><h3 id="å®ä½“æ¶ˆæ­§"><a href="#å®ä½“æ¶ˆæ­§" class="headerlink" title="å®ä½“æ¶ˆæ­§"></a>å®ä½“æ¶ˆæ­§</h3><p>Entity disambiguationçš„éš¾ç‚¹åœ¨äºæŒ‡ç§°é¡¹å¤šæ ·æ€§ï¼ˆname variationï¼‰å’ŒæŒ‡ç§°é¡¹æ­§ä¹‰ï¼ˆname ambiguityï¼‰ã€‚<br>æŒ‡ç§°é¡¹å¤šæ ·æ€§æŒ‡ä¸€ä¸ªå®ä½“æ¦‚å¿µå¯ä»¥ç”¨å¤šç§å‘½åæ€§æŒ‡ç§°é¡¹æŒ‡ç§°ï¼Œå¦‚å…¨ç§°ã€åˆ«ç§°ã€ç®€ç§°ã€æ‹¼å†™é”™è¯¯ã€å¤šè¯­è¨€åç§°ç­‰ã€‚</p><p>å•è¯­è¨€çš„å®ä½“æ¶ˆæ­§é—®é¢˜çš„ä¸»è¦æ–¹æ³•ï¼š</p><ol><li>å®ä½“èšç±»æ¶ˆæ­§æ³•ï¼šå¯¹æ¯ä¸€ä¸ªå®ä½“æŒ‡ç§°é¡¹æŠ½å–å…¶ä¸Šä¸‹æ–‡ç‰¹å¾ï¼ˆåŒ…æ‹¬è¯ã€å®ä½“ç­‰ï¼‰ï¼Œå¹¶å°†å…¶è¡¨ç¤ºæˆç‰¹å¾å‘é‡ï¼›ç„¶åè®¡ç®—å®ä½“æŒ‡ç§°é¡¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼›è®¡ç®—åŸºäºæŒ‡ç§°é¡¹ä¹‹é—´çš„ç›¸ä¼¼åº¦æ—¶ï¼Œå¯é‡‡ç”¨ä¸€å®šèšç±»ç®—æ³•å°†å…¶èšç±»ï¼Œå°†æ¯ä¸ªç±»çœ‹ä½œä¸€ä¸ªå®ä½“æ¦‚å¿µã€‚è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒä»»åŠ¡æ˜¯è®¡ç®—å®ä½“æŒ‡ç§°é¡¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œ<ul><li>ä¼ ç»Ÿçš„æ–¹æ³•æ˜¯åˆ©ç”¨ä¸Šä¸‹æ–‡çš„è¯ä¿¡æ¯å»ºç«‹è¯è¢‹æ¨¡å‹ï¼ˆbag-of-words, BOWï¼‰ã€‚</li><li>é’ˆå¯¹äººåæ¶ˆæ­§ï¼Œé‡‡ç”¨åŸºäºå›¾çš„ç®—æ³•ï¼Œåˆ©ç”¨ç¤¾ä¼šåŒ–å…³ç³»çš„ä¼ é€’æ€§è€ƒè™‘éšè—çš„å®ä½“å…³ç³»çŸ¥è¯†ã€‚</li><li>åˆ©ç”¨çŸ¥è¯†èµ„æºï¼Œå¦‚Wikipediaã€Webä¸Šçš„é“¾æ¥ä¿¡æ¯ã€å‘½åå®ä½“çš„åŒç°ä¿¡æ¯ã€é¢†åŸŸç‰¹å®šè¯­æ–™åº“ç­‰ï¼Œæ¥æå‡å®ä½“æ¶ˆæ­§çš„æ•ˆæœã€‚</li></ul></li><li>å®ä½“é“¾æ¥æ¶ˆæ­§æ³•ï¼šå®ä½“é“¾æ¥ï¼ˆentity linkingï¼‰ä¹Ÿç§°å®ä½“åˆ†è¾¨æˆ–å®ä½“è§£æï¼ˆentity resolutionï¼‰ï¼Œæˆ–è®°å½•é“¾æ¥ï¼ˆrecord linkageï¼‰ã€‚åŸºäºå®ä½“é“¾æ¥æ¶ˆæ­§æ³•çš„ç›®çš„æ˜¯è§£å†³åŸºäºèšç±»çš„å®ä½“æ¶ˆæ­§æ³•ä¸èƒ½æ˜¾å¼åœ°ç»™å‡ºå®ä½“è¯­ä¹‰ä¿¡æ¯çš„é—®é¢˜ï¼Œå…¶åŸºæœ¬ä»»åŠ¡æ˜¯ï¼šç»™å®šä¸€ä¸ªå®ä½“æŒ‡ç§°é¡¹ï¼Œå°†å…¶é“¾æ¥åˆ°çŸ¥è¯†åº“ä¸­çš„å®ä½“æ¦‚å¿µä¸Šã€‚å®ä½“é“¾æ¥çš„æ ¸å¿ƒä»»åŠ¡ä»æ˜¯è®¡ç®—å®ä½“æŒ‡ç§°é¡¹å’Œå€™é€‰å®ä½“ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œé€‰æ‹©ç›¸ä¼¼åº¦æœ€å¤§çš„å€™é€‰å®ä½“ä½œä¸ºé“¾æ¥çš„ç›®æ ‡å®ä½“ã€‚</li></ol><p>å®ä½“æ¶ˆæ­§ä»é¢ä¸´å¾ˆå¤šéš¾é¢˜ï¼ŒåŒ…æ‹¬ç©ºç›®æ ‡å®ä½“é—®é¢˜ï¼ˆNIL entity problemï¼‰ï¼ˆå³å®ä½“çŸ¥è¯†åº“ä¸­ä¸åŒ…å«æŸæŒ‡ç§°é¡¹çš„ç›®æ ‡å®ä½“ï¼‰ã€çŸ¥è¯†åº“è¦†ç›–åº¦æœ‰é™ã€æ¥è‡ªäº’è”ç½‘çš„çŸ¥è¯†æºå¯é æ€§å·®å’ŒçŸ¥è¯†åº“ä½¿ç”¨æ–¹æ³•å•ä¸€ï¼ˆé›†ä¸­äºä½¿ç”¨å•æ–‡æ¡£ç‰¹å¾ï¼‰ç­‰ã€‚</p><h3 id="å¼€æ”¾å¼å®ä½“å…³ç³»æŠ½å–"><a href="#å¼€æ”¾å¼å®ä½“å…³ç³»æŠ½å–" class="headerlink" title="å¼€æ”¾å¼å®ä½“å…³ç³»æŠ½å–"></a>å¼€æ”¾å¼å®ä½“å…³ç³»æŠ½å–</h3><p>å®ä½“å…³ç³»é€šå¸¸é‡‡ç”¨é‡‡ç”¨ä¸‰å…ƒç»„è¡¨ç¤ºï¼š<code>(Arg1, Pred, Arg2)</code>ï¼Œ å…¶ä¸­ï¼Œ<code>Arg1</code>è¡¨ç¤ºå®ä½“ï¼Œ<code>Arg2</code>è¡¨ç¤ºå®ä½“å…³ç³»å€¼ï¼Œé€šå¸¸ä¹Ÿæ˜¯å®ä½“ï¼Œ<code>Pred</code>è¡¨ç¤ºå…³ç³»åç§°ï¼Œé€šå¸¸ä¸ºåŠ¨è¯ã€åè¯æˆ–è€…åè¯çŸ­è¯­ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¿¡æ¯æŠ½å–&quot;&gt;&lt;a href=&quot;#ä¿¡æ¯æŠ½å–&quot; class=&quot;headerlink&quot; title=&quot;ä¿¡æ¯æŠ½å–&quot;&gt;&lt;/a&gt;ä¿¡æ¯æŠ½å–&lt;/h2&gt;&lt;p&gt;1997å¹´MUCä¼šè®®ï¼ˆMUC-7ï¼‰ å¬å¼€æ—¶ï¼Œè¯„æµ‹ä»»åŠ¡å·²ç»å¢åŠ åˆ°5ä¸ªï¼š&lt;br&gt;â‘  åœºæ™¯æ¨¡æ¿ï¼ˆscenario template, STï¼‰å¡«å……ï¼šå®šä¹‰äº†æè¿°åœºæ™¯çš„æ¨¡æ¿åŠæ§½å¡«å……è§„èŒƒï¼›&lt;br&gt;â‘¡ å‘½åå®ä½“ï¼ˆnamed entity, NEï¼‰è¯†åˆ«ï¼šè¯†åˆ«å‡ºæ–‡æœ¬ä¸­å‡ºç°çš„ä¸“æœ‰åç§°å’Œæœ‰æ„ä¹‰çš„æ•°é‡çŸ­è¯­ï¼Œ å¹¶åŠ ä»¥å½’ç±»ï¼›&lt;br&gt;â‘¢ å…±æŒ‡ï¼ˆcoreference, CRï¼‰å…³ç³»ç¡®å®šï¼šè¯†åˆ«å‡ºç»™å®šæ–‡æœ¬ä¸­çš„å‚ç…§è¡¨è¾¾ï¼ˆ referring expressionsï¼‰ï¼Œå¹¶ç¡®å®šè¿™äº›è¡¨è¾¾ä¹‹é—´çš„å…±æŒ‡å…³ç³»ï¼›&lt;br&gt;â‘£ æ¨¡æ¿å…ƒç´ ï¼ˆtemplate element, TEï¼‰å¡«å……ï¼šç±»ä¼¼äºäººåå’Œç»„ç»‡æœºæ„åè¯†åˆ«ï¼Œä½†æ˜¯è¦æ±‚ç³»ç»Ÿå¿…é¡»è¯†åˆ«å‡ºå®ä½“çš„æè¿°å’Œåå­—ï¼Œå¦‚æœä¸€ä¸ªå®ä½“åœ¨æ–‡æœ¬ä¸­è¢«æåˆ°äº†å¤šæ¬¡ï¼Œä½¿ç”¨äº†å‡ ç§å¯èƒ½çš„æè¿°å’Œä¸åŒçš„åå­—å½¢å¼ï¼Œè¦æ±‚ç³»ç»Ÿéƒ½è¦æŠŠå®ƒä»¬è¯†åˆ«å‡ºæ¥ï¼Œä¸€ä¸ªæ–‡æœ¬ä¸­çš„æ¯ä¸ªå®ä½“åªæœ‰ä¸€ä¸ªæ¨¡æ¿å…ƒç´ ï¼»Grishman and Sundheim, 1996ï¼½ï¼›&lt;br&gt;â‘¤ æ¨¡æ¿å…³ç³»ï¼ˆtemplate relation, TRï¼‰ï¼šç¡®å®šå®ä½“ä¹‹é—´ä¸ç‰¹å®šé¢†åŸŸæ— å…³çš„å…³ç³»ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Information Retrieval" scheme="http://shukebeta.me/tags/Information-Retrieval/"/>
    
  </entry>
  
  <entry>
    <title>Java BitMap å’Œ Bloom Filter</title>
    <link href="http://shukebeta.me/java-BitMap/"/>
    <id>http://shukebeta.me/java-BitMap/</id>
    <published>2018-10-18T16:00:00.000Z</published>
    <updated>2018-12-05T09:31:24.829Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Bit-Map"><a href="#Bit-Map" class="headerlink" title="Bit Map"></a>Bit Map</h2><p>Bit-mapç”¨ä¸€ä¸ªbitä½æ¥æ ‡è®°æŸä¸ªå…ƒç´ å¯¹åº”çš„Valueï¼Œ è€ŒKeyå³æ˜¯è¯¥å…ƒç´ ã€‚ç”±äºé‡‡ç”¨äº†Bitä¸ºå•ä½æ¥å­˜å‚¨æ•°æ®ï¼Œå› æ­¤åœ¨å­˜å‚¨ç©ºé—´æ–¹é¢ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœã€‚<br><a id="more"></a><br>å‡è®¾æˆ‘ä»¬è¦å¯¹0-7å†…çš„5ä¸ªå…ƒç´ <code>4,7,2,5,3</code>æ’åºï¼ˆå‡è®¾è¿™äº›å…ƒç´ æ²¡æœ‰é‡å¤ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨Bit-mapçš„æ–¹æ³•æ¥è¾¾åˆ°æ’åºçš„ç›®çš„ã€‚è¦è¡¨ç¤º8ä¸ªæ•°ï¼Œæˆ‘ä»¬å°±åªéœ€è¦8ä¸ªBitï¼ˆ1Bytesï¼‰ï¼Œ</p><ol><li>é¦–å…ˆæˆ‘ä»¬å¼€è¾Ÿ1Byteçš„ç©ºé—´ï¼Œå°†è¿™äº›ç©ºé—´çš„æ‰€æœ‰Bitä½éƒ½ç½®ä¸º0ï¼Œ<code>0 0 0 0 0 0 0 0</code>.</li><li>ç„¶åéå†è¿™5ä¸ªå…ƒç´ ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯4ï¼Œé‚£ä¹ˆå°±æŠŠ4å¯¹åº”çš„ä½ç½®è®¾ä¸º1, <code>p+(i/8)|(0x01&lt;&lt;(i%8))</code>, è¿™é‡Œé»˜è®¤ä¸ºBig-ending, <code>0 0 0 0 1 0 0 0</code>.</li><li>ç„¶åå†å¤„ç†ç¬¬äºŒä¸ªå…ƒç´ 7ï¼Œå°†ç¬¬å…«ä½ç½®ä¸º1,ï¼Œæ¥ç€å†å¤„ç†ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œä¸€ç›´åˆ°æœ€åå¤„ç†å®Œæ‰€æœ‰çš„å…ƒç´ ï¼Œå°†ç›¸åº”çš„ä½ç½®ä¸º1ï¼Œè¿™æ—¶å€™çš„å†…å­˜çš„Bitä½çš„çŠ¶æ€<code>0 0 1 1 1 1 0 1</code></li><li>éå†ä¸€éBitåŒºåŸŸï¼ŒæŠŠ<code>1</code>çš„ç´¢å¼•ä¾æ¬¡è¾“å‡ºï¼ˆ<code>2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ7</code>ï¼‰ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†æ’åºçš„ç›®çš„ã€‚</li></ol><p>ç®—æ³•çš„å…³é”®æ˜¯å¦‚ä½•ç¡®å®šåè¿›åˆ¶çš„æ•°æ˜ å°„åˆ°äºŒè¿›åˆ¶bitä½çš„mapå›¾ã€‚ç®—æ³•å ç”¨å¾ˆå°‘å†…å­˜ï¼Œæ¯”å¦‚N=10000000ï¼›åªéœ€å ç”¨å†…å­˜ä¸ºN/8=1250000Byte=1.25Mã€‚ç¼ºç‚¹æ˜¯ä¸èƒ½æœ‰é‡å¤æ•°æ®ã€‚</p><h3 id="Mapæ˜ å°„è¡¨"><a href="#Mapæ˜ å°„è¡¨" class="headerlink" title="Mapæ˜ å°„è¡¨"></a>Mapæ˜ å°„è¡¨</h3><p>å‡è®¾éœ€è¦æ’åºæˆ–è€…æŸ¥æ‰¾çš„æ€»æ•°<code>N=10000000</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç”³è¯·å†…å­˜ç©ºé—´çš„å¤§å°ä¸º<code>int a[1 + N/32]</code>ï¼Œå…¶ä¸­ï¼š<code>a[0]</code>åœ¨å†…å­˜ä¸­å 32ä½, å¯ä»¥å¯¹åº”åè¿›åˆ¶æ•°0-31ï¼Œä¾æ¬¡ç±»æ¨ï¼š<br>bitmapè¡¨ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a[0]---------&gt;0-31</span><br><span class="line">a[1]---------&gt;32-63</span><br><span class="line">a[2]---------&gt;64-95</span><br><span class="line">a[3]---------&gt;96-127</span><br><span class="line">..........</span><br></pre></td></tr></table></figure></p><p>åè¿›åˆ¶æ•°éœ€è¦è½¬æ¢ä¸ºå¯¹åº”çš„bitä½</p><h3 id="ä½ç§»è½¬æ¢"><a href="#ä½ç§»è½¬æ¢" class="headerlink" title="ä½ç§»è½¬æ¢"></a>ä½ç§»è½¬æ¢</h3><p>å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºå¯¹åº”çš„bitä½, ç”³è¯·ä¸€ä¸ª<code>int</code>ä¸€ç»´æ•°ç»„ï¼Œä½œä¸º32åˆ—çš„äºŒç»´æ•°ç»„ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int a[0]    |0000000000000000000000000000000000000|</span><br><span class="line"></span><br><span class="line">int a[1]    |0000000000000000000000000000000000000|</span><br><span class="line"></span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line"></span><br><span class="line">int a[N]    |0000000000000000000000000000000000000|</span><br></pre></td></tr></table></figure></p><p>ä¾‹å¦‚åè¿›åˆ¶0ï¼Œå¯¹åº”åœ¨<code>a[0]</code>ç¬¬ä¸€ä½ï¼š <code>00000000000000000000000000000001</code></p><ol><li>æ±‚åè¿›åˆ¶<code>0-N</code>å¯¹åº”åœ¨æ•°ç»„<code>a</code>çš„ç´¢å¼•ï¼šåè¿›åˆ¶<code>0-31</code>ï¼Œå¯¹åº”<code>a[0]</code>ï¼Œå…ˆç”±åè¿›åˆ¶æ•°nè½¬æ¢ä¸ºä¸32çš„ä½™å¯è½¬åŒ–ä¸ºå¯¹åº”åœ¨æ•°ç»„<code>a</code>ä¸­çš„ç´¢å¼•<code>0</code>ã€‚æ¯”å¦‚n=24,é‚£ä¹ˆ n/32=0ï¼Œåˆ™24å¯¹åº”<code>a[0]</code>ã€‚åˆæ¯”å¦‚n=60, é‚£ä¹ˆn/32=1ï¼Œåˆ™60å¯¹åº”<code>a[1]</code>ã€‚</li><li>æ±‚<code>0-N</code>å¯¹åº”<code>0-31</code>ä¸­çš„æ•°ï¼šåè¿›åˆ¶0-31å°±å¯¹åº”0-31ï¼Œè€Œ32-63åˆ™å¯¹åº”ä¹Ÿæ˜¯0-31ï¼Œå³ç»™å®šä¸€ä¸ªæ•°nå¯ä»¥é€šè¿‡æ¨¡32æ±‚å¾—å¯¹åº”0-31ä¸­çš„æ•°ã€‚</li><li>åˆ©ç”¨ç§»ä½0-31ä½¿å¾—å¯¹åº”32bitä½ä¸º1. æ‰¾åˆ°å¯¹åº”0-31çš„æ•°ä¸ºM, å·¦ç§»Mä½ï¼šå³<code>2 ^ M</code>, ç½®1.</li></ol><h3 id="Bloom-Filter"><a href="#Bloom-Filter" class="headerlink" title="Bloom Filter"></a>Bloom Filter</h3><p>ä¸ºäº†é™ä½é”®å€¼å†²çªçš„æ¦‚ç‡ï¼ŒBloom Filterä½¿ç”¨äº†å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼šåˆ›å»ºä¸€ä¸ªmä½BitSetï¼Œå…ˆå°†æ‰€æœ‰ä½åˆå§‹åŒ–ä¸º0ï¼Œç„¶åé€‰æ‹©kä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°ã€‚ç¬¬iä¸ªå“ˆå¸Œå‡½æ•°å¯¹å­—ç¬¦ä¸²strå“ˆå¸Œçš„ç»“æœè®°ä¸º<code>h(i, str)</code>ï¼Œä¸”<code>h(i, str)</code>çš„èŒƒå›´æ˜¯0åˆ°m-1 ã€‚</p><p>å¯¹äºå­—ç¬¦ä¸²<code>str</code>ï¼Œåˆ†åˆ«è®¡ç®—<code>h(1, str), h(2, str), ... h(k, str)</code>, ä»¥è¿™äº›å“ˆå¸Œå€¼ä½œä¸ºç´¢å¼•, å°†BitSetçš„å¯¹åº”ä½ç½®çš„ä½è®¾ä¸º1, è¿™æ ·å°±æŠŠ<code>str</code>æ˜ å°„åˆ°BitSetçš„kä¸ªäºŒè¿›åˆ¶ä½äº†.<img src="/images/bloom_filter.png" alt=""></p><p>å¦‚æœè¦æ£€æŸ¥æŸ<code>string</code>æ˜¯å¦å·²ç»è¢«è®°å½•åœ¨BitSetä¸­, åªéœ€è¦è®¡ç®—å…¶å“ˆå¸Œå€¼æ•°ç»„, å¹¶æ£€æŸ¥BitSetä¸Šå¯¹åº”ä½ç½®çš„å€¼æ˜¯å¦ä¸º<code>1</code>, è‹¥å¯¹åº”ä½ç½®ä¸­æœ‰ä»»ä½•ä¸€ä¸ªä¸æ˜¯<code>1</code>, é‚£ä¹ˆè¯¥å­—ç¬¦ä¸²<strong>ä¸€å®š</strong>æ²¡æœ‰è¢«è®°å½•è¿‡, è‹¥å…¨éƒ¨å¯¹åº”ä½ç½®éƒ½ä¸º<code>1</code>, é‚£ä¹ˆæŒ‰ç…§<strong>false positive</strong>è®¤ä¸ºè¯¥å­—ç¬¦ä¸²å·²ç»è¢«è®°å½•è¿‡äº†(ä½†ä¸æ˜¯100%è‚¯å®š).</p><p>åˆ é™¤æ“ä½œä¼šå½±å“åˆ°å…¶ä»–å­—ç¬¦ä¸²ã€‚å¦‚æœéœ€è¦åˆ é™¤å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œä½¿ç”¨Counting bloomfilter(CBF)ï¼Œè¿™æ˜¯ä¸€ç§Bloom Filterçš„å˜ä½“ï¼ŒCBFå°†Bloom Filteræ¯ä¸€ä¸ªBitæ”¹ä¸ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åˆ é™¤å­—ç¬¦ä¸²çš„åŠŸèƒ½äº†ã€‚</p><p>Bloom Filterè·Ÿå•å“ˆå¸Œå‡½æ•°Bit-Mapä¸åŒä¹‹å¤„åœ¨äºï¼šBloom Filterä½¿ç”¨äº†kä¸ªå“ˆå¸Œå‡½æ•°ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²è·Ÿkä¸ªbitå¯¹åº”ã€‚ä»è€Œé™ä½äº†å†²çªçš„æ¦‚ç‡ã€‚</p><p>æ‰€ä»¥Bloom Filteré€‚ç”¨ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>åªè¦è¿”å›æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™è‚¯å®šä¸å­˜åœ¨ã€‚</li><li>è¿”å›æ•°æ®å­˜åœ¨ï¼Œä½†åªèƒ½æ˜¯å¤§æ¦‚ç‡å­˜åœ¨ã€‚</li><li>ä¸èƒ½æ¸…é™¤å…¶ä¸­çš„æ•°æ®ã€‚</li></ol><p>BloomFilterçš„åº”ç”¨å¾ˆå¤šï¼Œæ¯”å¦‚æ•°æ®åº“ã€çˆ¬è™«ï¼ˆç”¨çˆ¬è™«æŠ“å–ç½‘é¡µæ—¶å¯¹ç½‘é¡µurlå»é‡ï¼‰ã€é˜²ç¼“å­˜å‡»ç©¿ç­‰ã€‚ç‰¹åˆ«æ˜¯éœ€è¦ç²¾ç¡®çŸ¥é“æŸä¸ªæ•°æ®ä¸å­˜åœ¨æ—¶åšç‚¹ä»€ä¹ˆäº‹æƒ…å°±éå¸¸é€‚åˆå¸ƒéš†è¿‡æ»¤ã€‚ Goolgeåœ¨BigTableä¸­å°±ä½¿ç”¨äº†BloomFilterï¼Œä»¥é¿å…åœ¨ç¡¬ç›˜ä¸­å¯»æ‰¾ä¸å­˜åœ¨çš„æ¡ç›®ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>Javaå®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">ä½œè€…ï¼šcrossoverJie</span><br><span class="line">é“¾æ¥ï¼šhttps:<span class="comment">//zhuanlan.zhihu.com/p/50926087</span></span><br><span class="line">æ¥æºï¼šçŸ¥ä¹</span><br><span class="line">è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilters</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> arraySize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BloomFilters</span><span class="params">(<span class="keyword">int</span> arraySize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.arraySize = arraySize;</span><br><span class="line">        array = <span class="keyword">new</span> <span class="keyword">int</span>[arraySize];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> first = hashcode_1(key);</span><br><span class="line">        <span class="keyword">int</span> second = hashcode_2(key);</span><br><span class="line">        <span class="keyword">int</span> third = hashcode_3(key);</span><br><span class="line"></span><br><span class="line">        array[first % arraySize] = <span class="number">1</span>;</span><br><span class="line">        array[second % arraySize] = <span class="number">1</span>;</span><br><span class="line">        array[third % arraySize] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">check</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> first = hashcode_1(key);</span><br><span class="line">        <span class="keyword">int</span> second = hashcode_2(key);</span><br><span class="line">        <span class="keyword">int</span> third = hashcode_3(key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> firstIndex = array[first % arraySize];</span><br><span class="line">        <span class="keyword">if</span> (firstIndex == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> secondIndex = array[second % arraySize];</span><br><span class="line">        <span class="keyword">if</span> (secondIndex == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> thirdIndex = array[third % arraySize];</span><br><span class="line">        <span class="keyword">if</span> (thirdIndex == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash ç®—æ³•1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hashcode_1</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hash = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; key.length(); ++i) &#123;</span><br><span class="line">            hash = <span class="number">33</span> * hash + key.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash ç®—æ³•2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hashcode_2</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> p = <span class="number">16777619</span>;</span><br><span class="line">        <span class="keyword">int</span> hash = (<span class="keyword">int</span>) <span class="number">2166136261L</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.length(); i++) &#123;</span><br><span class="line">            hash = (hash ^ data.charAt(i)) * p;</span><br><span class="line">        &#125;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">13</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">7</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        hash ^= hash &gt;&gt; <span class="number">17</span>;</span><br><span class="line">        hash += hash &lt;&lt; <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  hash ç®—æ³•3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hashcode_3</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hash, i;</span><br><span class="line">        <span class="keyword">for</span> (hash = <span class="number">0</span>, i = <span class="number">0</span>; i &lt; key.length(); ++i) &#123;</span><br><span class="line">            hash += key.charAt(i);</span><br><span class="line">            hash += (hash &lt;&lt; <span class="number">10</span>);</span><br><span class="line">            hash ^= (hash &gt;&gt; <span class="number">6</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        hash += (hash &lt;&lt; <span class="number">3</span>);</span><br><span class="line">        hash ^= (hash &gt;&gt; <span class="number">11</span>);</span><br><span class="line">        hash += (hash &lt;&lt; <span class="number">15</span>);</span><br><span class="line">        <span class="keyword">return</span> Math.abs(hash);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Guava å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">guavaTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> star = System.currentTimeMillis();</span><br><span class="line">    BloomFilter&lt;Integer&gt; filter = BloomFilter.create(</span><br><span class="line">            Funnels.integerFunnel(),</span><br><span class="line">            <span class="number">10000000</span>,</span><br><span class="line">            <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">        filter.put(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Assert.assertTrue(filter.mightContain(<span class="number">1</span>));</span><br><span class="line">    Assert.assertTrue(filter.mightContain(<span class="number">2</span>));</span><br><span class="line">    Assert.assertTrue(filter.mightContain(<span class="number">3</span>));</span><br><span class="line">    Assert.assertFalse(filter.mightContain(<span class="number">10000000</span>));</span><br><span class="line">    <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"æ‰§è¡Œæ—¶é—´ï¼š"</span> + (end - star));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯é¢„è®¡å­˜æ”¾å¤šå°‘æ•°æ®ï¼Œä¸€ä¸ªæ˜¯å¯ä»¥æ¥å—çš„è¯¯æŠ¥ç‡ã€‚Guava ä¼šé€šè¿‡ä½ é¢„è®¡çš„æ•°é‡ä»¥åŠè¯¯æŠ¥ç‡å¸®ä½ è®¡ç®—å‡ºä½ åº”å½“ä¼šä½¿ç”¨çš„æ•°ç»„å¤§å° numBits ä»¥åŠéœ€è¦è®¡ç®—å‡ æ¬¡ Hash å‡½æ•° <code>numHashFunctions</code> ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">BloomFilter&lt;T&gt; <span class="title">create</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Funnel&lt;? <span class="keyword">super</span> T&gt; funnel, <span class="keyword">long</span> expectedInsertions, <span class="keyword">double</span> fpp, Strategy strategy)</span> </span>&#123;</span><br><span class="line">  checkNotNull(funnel);</span><br><span class="line">  checkArgument(</span><br><span class="line">      expectedInsertions &gt;= <span class="number">0</span>, <span class="string">"Expected insertions (%s) must be &gt;= 0"</span>, expectedInsertions);</span><br><span class="line">  checkArgument(fpp &gt; <span class="number">0.0</span>, <span class="string">"False positive probability (%s) must be &gt; 0.0"</span>, fpp);</span><br><span class="line">  checkArgument(fpp &lt; <span class="number">1.0</span>, <span class="string">"False positive probability (%s) must be &lt; 1.0"</span>, fpp);</span><br><span class="line">  checkNotNull(strategy);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (expectedInsertions == <span class="number">0</span>) &#123;</span><br><span class="line">    expectedInsertions = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size</span></span><br><span class="line"><span class="comment">   * is proportional to -log(p), but there is not much of a point after all, e.g.</span></span><br><span class="line"><span class="comment">   * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">long</span> numBits = optimalNumOfBits(expectedInsertions, fpp);</span><br><span class="line">  <span class="keyword">int</span> numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BloomFilter&lt;T&gt;(<span class="keyword">new</span> LockFreeBitArray(numBits), numHashFunctions, funnel, strategy);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Could not create BloomFilter of "</span> + numBits + <span class="string">" bits"</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>put</code>æœ‰ä¸åŒçš„ç­–ç•¥ï¼Œå¦‚<code>MURMUR128_MITZ_64()</code>ç­–ç•¥æ ¹æ® <code>murmur3_128</code> æ–¹æ³•çš„åˆ°ä¸€ä¸ª <code>128</code> ä½é•¿åº¦çš„ <code>byte[]</code>ã€‚åˆ†åˆ«å–é«˜ä½ 8 ä½çš„åˆ°ä¸¤ä¸ª hash å€¼(<code>lowerEight, upperEight</code>)ã€‚å†æ ¹æ®åˆå§‹åŒ–æ—¶çš„åˆ°çš„æ‰§è¡Œ hash çš„æ¬¡æ•°è¿›è¡Œ hash è¿ç®—ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This strategy uses all 128 bits of &#123;<span class="doctag">@link</span> Hashing#murmur3_128&#125; when hashing. It looks different</span></span><br><span class="line"><span class="comment"> * than the implementation in MURMUR128_MITZ_32 because we're avoiding the multiplication in the</span></span><br><span class="line"><span class="comment"> * loop and doing a (much simpler) += hash2. We're also changing the index to a positive number by</span></span><br><span class="line"><span class="comment"> * AND'ing with Long.MAX_VALUE instead of flipping the bits.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">MURMUR128_MITZ_64() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">put</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      T object, Funnel&lt;? <span class="keyword">super</span> T&gt; funnel, <span class="keyword">int</span> numHashFunctions, LockFreeBitArray bits)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> bitSize = bits.bitSize();</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();</span><br><span class="line">    <span class="keyword">long</span> hash1 = lowerEight(bytes);</span><br><span class="line">    <span class="keyword">long</span> hash2 = upperEight(bytes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> bitsChanged = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">long</span> combinedHash = hash1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numHashFunctions; i++) &#123;</span><br><span class="line">      <span class="comment">// Make the combined hash positive and indexable</span></span><br><span class="line">      bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);</span><br><span class="line">      combinedHash += hash2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bitsChanged;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>LockFreeBitArray</code>å°±æ˜¯çœŸæ­£å­˜æ”¾æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„ã€‚åˆ©ç”¨äº†ä¸€ä¸ª <code>AtomicLongArray data</code> æ¥å­˜æ”¾æ•°æ®ã€‚æ‰€ä»¥ <code>set()</code> æ—¶å€™ä¹Ÿæ˜¯å¯¹è¿™ä¸ª <code>data</code> åšå¤„ç†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Models a lock-free array of bits.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;We use this instead of java.util.BitSet because we need access to the array of longs and we</span></span><br><span class="line"><span class="comment"> * need compare-and-swap.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LockFreeBitArray</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LONG_ADDRESSABLE_BITS = <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">final</span> AtomicLongArray data;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> LongAddable bitCount;</span><br><span class="line"></span><br><span class="line">  LockFreeBitArray(<span class="keyword">long</span> bits) &#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">new</span> <span class="keyword">long</span>[Ints.checkedCast(LongMath.divide(bits, <span class="number">64</span>, RoundingMode.CEILING))]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Used by serialization</span></span><br><span class="line">  LockFreeBitArray(<span class="keyword">long</span>[] data) &#123;</span><br><span class="line">    checkArgument(data.length &gt; <span class="number">0</span>, <span class="string">"data length is zero!"</span>);</span><br><span class="line">    <span class="keyword">this</span>.data = <span class="keyword">new</span> AtomicLongArray(data);</span><br><span class="line">    <span class="keyword">this</span>.bitCount = LongAddables.create();</span><br><span class="line">    <span class="keyword">long</span> bitCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">long</span> value : data) &#123;</span><br><span class="line">      bitCount += Long.bitCount(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.bitCount.add(bitCount);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Returns true if the bit changed value. */</span></span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">set</span><span class="params">(<span class="keyword">long</span> bitIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (get(bitIndex)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> longIndex = (<span class="keyword">int</span>) (bitIndex &gt;&gt;&gt; LONG_ADDRESSABLE_BITS);</span><br><span class="line">    <span class="keyword">long</span> mask = <span class="number">1L</span> &lt;&lt; bitIndex; <span class="comment">// only cares about low 6 bits of bitIndex</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> oldValue;</span><br><span class="line">    <span class="keyword">long</span> newValue;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      oldValue = data.get(longIndex);</span><br><span class="line">      newValue = oldValue | mask;</span><br><span class="line">      <span class="keyword">if</span> (oldValue == newValue) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (!data.compareAndSet(longIndex, oldValue, newValue));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We turned the bit on, so increment bitCount.</span></span><br><span class="line">    bitCount.increment();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨ <code>set()</code> ä¹‹å‰å…ˆé€šè¿‡ <code>get()</code> åˆ¤æ–­è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥è¿”å›å‘ŠçŸ¥å®¢æˆ·ç«¯å†™å…¥å¤±è´¥ã€‚æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡ä½è¿ç®—è¿›è¡Œä½æˆ–èµ‹å€¼ã€‚<code>get()</code> æ–¹æ³•çš„è®¡ç®—é€»è¾‘å’Œ <code>set()</code> ç±»ä¼¼ï¼Œåªè¦åˆ¤æ–­ä¸º 0 å°±ç›´æ¥è¿”å›å­˜åœ¨è¯¥å€¼ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Bit-Map&quot;&gt;&lt;a href=&quot;#Bit-Map&quot; class=&quot;headerlink&quot; title=&quot;Bit Map&quot;&gt;&lt;/a&gt;Bit Map&lt;/h2&gt;&lt;p&gt;Bit-mapç”¨ä¸€ä¸ªbitä½æ¥æ ‡è®°æŸä¸ªå…ƒç´ å¯¹åº”çš„Valueï¼Œ è€ŒKeyå³æ˜¯è¯¥å…ƒç´ ã€‚ç”±äºé‡‡ç”¨äº†Bitä¸ºå•ä½æ¥å­˜å‚¨æ•°æ®ï¼Œå› æ­¤åœ¨å­˜å‚¨ç©ºé—´æ–¹é¢ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœã€‚&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Java" scheme="http://shukebeta.me/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 08 - æ•°æ®å‹ç¼© - å“ˆå¤«æ›¼ç¼–ç </title>
    <link href="http://shukebeta.me/NLP-08-data-compression-huffman-compression/"/>
    <id>http://shukebeta.me/NLP-08-data-compression-huffman-compression/</id>
    <published>2018-10-11T16:00:00.000Z</published>
    <updated>2018-12-17T13:06:05.733Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¿å…æ­§ä¹‰çš„ç¼–ç "><a href="#é¿å…æ­§ä¹‰çš„ç¼–ç " class="headerlink" title="é¿å…æ­§ä¹‰çš„ç¼–ç "></a>é¿å…æ­§ä¹‰çš„ç¼–ç </h2><p>åœ¨æ„å»ºå‹ç¼©ç¼–ç çš„å¯¹åº”å…³ç³»æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„æ•°é‡çš„ä½æ¥ç¼–ç ä¸åŒçš„å­—ç¬¦.<br><a id="more"></a><br>æ¯”å¦‚æ‘©æ–¯å¯†ç <img src="/images/Morse_Code.png" alt="" title="Chart of the Morse code letters and numerals.">. å¦‚æœå•çº¯ä½¿ç”¨è¿™ç§å¯¹åº”å…³ç³»ï¼Œä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œ å¦‚<code>â€¢â€¢â€¢âˆ’âˆ’âˆ’â€¢â€¢â€¢</code>ä¼šäº§ç”Ÿæ­§ä¹‰: <code>SOS</code>? <code>V7</code>? <code>IAMIE</code>? <code>EEWNI</code>? æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ä¸­, å¯†ç ä½¿ç”¨ä¸€äº›é—´éš”æ¥åˆ†éš”ä»£ç å­—ã€‚</p><p>é‚£ä¹ˆå¯¹äºä¸åŒçš„å‹ç¼©ç¼–ç , æœ‰ä»€ä¹ˆå¸¸ç”¨æ–¹æ³•æ¥é¿å…æ­§ä¹‰ï¼Ÿ<br>æ–¹æ³•æ˜¯ç¡®ä¿æ²¡æœ‰ä¸€ä¸ªç¼–ç æ˜¯å¦ä¸€ä¸ªç¼–ç çš„å‰ç¼€ã€‚æ¯”å¦‚</p><ul><li>ä½¿ç”¨å›ºå®šé•¿åº¦ç¼–ç ã€‚</li><li>ä¸ºæ¯ä¸ªç¼–ç æ·»åŠ ç‰¹æ®Šçš„stop charã€‚</li><li><strong>ä½¿ç”¨ä¸€ç§å…·å¤‡å¹¿æ³›ä½¿ç”¨æ€§çš„prefix-freeç¼–ç </strong>ã€‚</li></ul><p>ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥è®¾è®¡prefix-freeç¼–ç ?</p><h3 id="ç”¨Trieæ„é€ ç¼–ç "><a href="#ç”¨Trieæ„é€ ç¼–ç " class="headerlink" title="ç”¨Trieæ„é€ ç¼–ç "></a>ç”¨Trieæ„é€ ç¼–ç </h3><p>ä¸€ä¸ªäºŒå‰(<code>0, 1</code>)Trie: å¶èŠ‚ç‚¹æ˜¯å­—ç¬¦, æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„å°±æ˜¯ç¼–ç .<img src="/images/huffman_trie.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"></p><p>å‹ç¼©:<br>æ–¹æ³•1ï¼šä»å¶å¼€å§‹; æŒ‰ç…§è·¯å¾„åˆ°è¾¾æ ¹; åå‘æ‰“å°bitsã€‚<br>æ–¹æ³•2ï¼šåˆ›å»º<code>é”®-å€¼</code>å¯¹çš„ç¬¦å·è¡¨ã€‚</p><p>è§£å‹:</p><ol><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹, æ ¹æ®ä½å€¼æ˜¯0è¿˜æ˜¯1åœ¨Trieå›¾ä¸Šæ¸¸èµ°, ç›´åˆ°èµ°åˆ°å¶èŠ‚ç‚¹ï¼Œåˆ™è§£å‹å‡ºä¸€ä¸ªå­—ç¬¦</li><li>è¿”å›æ ¹èŠ‚ç‚¹, ç»§ç»­ç¬¬ä¸€æ­¥, ç›´åˆ°è·‘å®Œæ‰€æœ‰ç¼–ç .</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Node</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> ch;   <span class="comment">// used only for leaf nodes</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> freq;  <span class="comment">// used only for compress</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node left, right;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">char</span> ch, <span class="keyword">int</span> freq, Node left, Node right)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.ch    = ch;</span><br><span class="line">      <span class="keyword">this</span>.freq  = freq;</span><br><span class="line">      <span class="keyword">this</span>.left  = left;</span><br><span class="line">      <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="keyword">return</span> left == <span class="keyword">null</span> &amp;&amp; right == <span class="keyword">null</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// compare Nodes by frequency</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Node that)</span></span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="keyword">return</span> <span class="keyword">this</span>.freq - that.freq;  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Runtime - Linear in input size N</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expand</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       Node root = readTrie(); <span class="comment">// read in encoding trie</span></span><br><span class="line">       <span class="keyword">int</span> N = BinaryStdIn.readInt(); <span class="comment">// read in number of chars</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">       &#123;</span><br><span class="line">          Node x = root;</span><br><span class="line">          <span class="keyword">while</span> (!x.isLeaf())</span><br><span class="line">          &#123;</span><br><span class="line">             <span class="keyword">if</span> (!BinaryStdIn.readBoolean())</span><br><span class="line">                x = x.left;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                x = x.right;</span><br><span class="line">          &#125;</span><br><span class="line">          BinaryStdOut.write(x.ch, <span class="number">8</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       BinaryStdOut.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•è¯»å–ä¸€ä¸ªTrieï¼šæ ¹æ®Trieçš„å‰åºéå†åºåˆ—é‡æ„.<img src="/images/preorder_traversal_trie.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title">readTrie</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (BinaryStdIn.readBoolean())</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">char</span> c = BinaryStdIn.readChar(<span class="number">8</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Node(c, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   Node x = readTrie();</span><br><span class="line">   Node y = readTrie();</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Node(<span class="string">'\0'</span>, <span class="number">0</span>, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚ä½•æŠŠTrieå†™ä¸ºåºåˆ—ï¼šä»¥å‰åºéå†çš„æ–¹å¼å†™Trieï¼›é¢å¤–ç”¨ä¸€ä¸ªä½æ ‡è®°æ˜¯å¦å¶èŠ‚ç‚¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeTrie</span><span class="params">(Node x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (x.isLeaf())</span><br><span class="line">   &#123;</span><br><span class="line">      BinaryStdOut.write(<span class="keyword">true</span>);</span><br><span class="line">      BinaryStdOut.write(x.ch, <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   BinaryStdOut.write(<span class="keyword">false</span>);</span><br><span class="line">   writeTrie(x.left);</span><br><span class="line">   writeTrie(x.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ç”¨å“ˆå¤«æ›¼ç®—æ³•æ„å»ºæœ€ä¼˜ç¼–ç "><a href="#ç”¨å“ˆå¤«æ›¼ç®—æ³•æ„å»ºæœ€ä¼˜ç¼–ç " class="headerlink" title="ç”¨å“ˆå¤«æ›¼ç®—æ³•æ„å»ºæœ€ä¼˜ç¼–ç "></a>ç”¨å“ˆå¤«æ›¼ç®—æ³•æ„å»ºæœ€ä¼˜ç¼–ç </h3><p>å°±æ˜¯ç”¨Huffmanç®—æ³•. Huffmanç®—æ³•æ˜¯æŠŠæœ€çŸ­çš„ç¼–ç èµ‹ç»™å‡ºç°é¢‘ç‡æœ€é«˜çš„å­—ç¬¦, æŠŠæœ€é•¿çš„ç¼–ç ç•™ç»™å‡ºç°é¢‘ç‡è¾ƒä½çš„å­—ç¬¦. åœ¨Trieä¸Šçš„æ•ˆæœå°±å˜æˆé¢‘ç‡æœ€é«˜çš„å­—ç¬¦è·¯å¾„æœ€çŸ­, é•¿è·¯å¾„éƒ½ç•™ç»™é¢‘ç‡ä½çš„å­—ç¬¦. è¿™æ ·æ€»çš„æ•ˆæœå°±æ˜¯ä½¿ç”¨äº†æ›´å°‘çš„æ•°æ®ä½æ¥è¡¨è¾¾åŒæ ·çš„ä¿¡æ¯.</p><ol><li>ç»Ÿè®¡è¾“å…¥çš„å„ä¸ªå­—ç¬¦çš„é¢‘ç‡<code>freq[i]</code>ã€‚</li><li>ä¸ºæ¯ä¸ª<code>char i</code>æ„å»ºä¸€ä¸ªå…·æœ‰æƒé‡<code>freq[i]</code>çš„Trie(å­èŠ‚ç‚¹ä¸ºnull), ä»æ­¤èŠ‚ç‚¹å¼€å§‹</li><li>é‡å¤ä»¥ä¸‹è¿‡ç¨‹ç›´åˆ°èåˆä¸ºä¸€ä¸ªtrie(æ ¹èŠ‚ç‚¹)ï¼š<ul><li>é€‰æ‹©å½“å‰æƒé‡æœ€å°çš„ä¸¤Tries, <code>freq[i]</code>å’Œ<code>freq[j]</code>, å…¶ä¸­<code>i &lt;= j, freq[i] &lt;= freq[j]</code></li><li>ç»™å®ƒä»¬åˆ›å»ºçˆ¶èŠ‚ç‚¹, æƒé‡ä¸º<code>freq[i] + freq[j]</code>, ä¸¤ä¸ªå­Trieå’Œå…¶çˆ¶èŠ‚ç‚¹åˆå¹¶ä¸ºä¸€ä¸ªTrie, è€Œä¸”è·¯å¾„0(å·¦è¾¹)æ€»æ˜¯æŒ‡å‘è¾ƒå°çš„å­Trie, è·¯å¾„1(å³è¾¹)æŒ‡å‘è¾ƒå¤§çš„.</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title">buildTrie</span><span class="params">(<span class="keyword">int</span>[] freq)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MinPQ&lt;Node&gt; pq = <span class="keyword">new</span> MinPQ&lt;Node&gt;();</span><br><span class="line">    <span class="comment">// initialize PQ with singleton tries</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> i = <span class="number">0</span>; i &lt; R; i++)</span><br><span class="line">       <span class="keyword">if</span> (freq[i] &gt; <span class="number">0</span>)</span><br><span class="line">          pq.insert(<span class="keyword">new</span> Node(i, freq[i], <span class="keyword">null</span>, <span class="keyword">null</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pq.size() &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;  <span class="comment">// merge two smallest tries</span></span><br><span class="line">       Node x = pq.delMin();</span><br><span class="line">       Node y = pq.delMin();</span><br><span class="line">       Node parent = <span class="keyword">new</span> Node(<span class="string">'\0'</span>, x.freq + y.freq, x, y);</span><br><span class="line">       pq.insert(parent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pq.delMin();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªç®—æ³•, å¯ä»¥ä¿è¯é¢‘ç‡æœ€é«˜(æƒé‡æœ€å¤§)çš„å­—ç¬¦çš„å¶èŠ‚ç‚¹å°±æ˜¯æœ€å·¦å¶èŠ‚ç‚¹, ä¸€èˆ¬ç¼–ç ä¸º<code>0</code>, å…¶ä»–ä¾æ¬¡ç±»æ¨. å¯ä»¥è¯æ˜Huffmanç®—æ³•ç”Ÿæˆçš„æœ€ä¼˜prefix-freeç¼–ç .</p><p><a href="https://algs4.cs.princeton.edu/55compression/Huffman.java.html" target="_blank" rel="noopener">å®Œæ•´ä»£ç è§</a></p><p>Implementation.<br>ãƒ»Pass 1:  tabulate char frequencies and build trie.<br>ãƒ»Pass 2:  encode file by traversing trie or lookup table</p><p>Running time. Using a binary heap â‡’ <code>N + R log R</code>. N input size, R alphabet size.</p><p>å¯¹äºå…·æœ‰nä¸ªå¶å­èŠ‚ç‚¹çš„å“ˆå¤«æ›¼æ ‘ï¼Œä¸€å…±éœ€è¦<code>2*n-1</code>ä¸ªèŠ‚ç‚¹: äºŒå‰æ ‘æœ‰ä¸‰ç§ç±»å‹èŠ‚ç‚¹ï¼Œå³å­èŠ‚ç‚¹æ•°ä¸º2çš„èŠ‚ç‚¹ï¼Œä¸º1çš„èŠ‚ç‚¹å’Œä¸º0çš„å¶èŠ‚ç‚¹ã€‚è€Œå“ˆå¤«æ›¼æ ‘çš„éå¶å­èŠ‚ç‚¹æ˜¯ç”±ä¸¤ä¸ªèŠ‚ç‚¹ç”Ÿæˆçš„ï¼Œå› æ­¤ä¸èƒ½å‡ºç°åªæœ‰å•å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå¦‚æœå¶å­èŠ‚ç‚¹ä¸ªæ•°ä¸ºn, é‚£ä¹ˆéå¶å­èŠ‚ç‚¹çš„ä¸ªæ•°ä¸º<code>n-1</code>.</p><p>å“ˆå¤«æ›¼ç¼–ç å¹¿æ³›åº”ç”¨äºjpeg, pdf, MP3, MP4ç­‰æ–‡ä»¶ç¼–ç ä¸­.</p><p>åœ¨ç¥ç»ç½‘ç»œä¸­, å“ˆå¤«æ›¼æ ‘ä¹Ÿè¢«ç”¨äºæ„å»ºå±‚çº§Softmax.</p><p>ä¸€ä¸ªä½¿ç”¨Huffman Encodingçš„å®ä¾‹ï¼š<br><a href="https://github.com/congchan/cs106b-programming-abstraction/tree/master/HW6_Huffman%20Encoding/Huffman/src" target="_blank" rel="noopener">https://github.com/congchan/cs106b-programming-abstraction/tree/master/HW6_Huffman%20Encoding/Huffman/src</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é¿å…æ­§ä¹‰çš„ç¼–ç &quot;&gt;&lt;a href=&quot;#é¿å…æ­§ä¹‰çš„ç¼–ç &quot; class=&quot;headerlink&quot; title=&quot;é¿å…æ­§ä¹‰çš„ç¼–ç &quot;&gt;&lt;/a&gt;é¿å…æ­§ä¹‰çš„ç¼–ç &lt;/h2&gt;&lt;p&gt;åœ¨æ„å»ºå‹ç¼©ç¼–ç çš„å¯¹åº”å…³ç³»æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„æ•°é‡çš„ä½æ¥ç¼–ç ä¸åŒçš„å­—ç¬¦.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Information Retrieval" scheme="http://shukebeta.me/tags/Information-Retrieval/"/>
    
      <category term="Data Compression" scheme="http://shukebeta.me/tags/Data-Compression/"/>
    
      <category term="Huffman Compression" scheme="http://shukebeta.me/tags/Huffman-Compression/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 07 - æ•°æ®å‹ç¼©</title>
    <link href="http://shukebeta.me/NLP-07-data-compression-introduction/"/>
    <id>http://shukebeta.me/NLP-07-data-compression-introduction/</id>
    <published>2018-10-09T16:00:00.000Z</published>
    <updated>2018-12-17T13:06:31.923Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®å‹ç¼©"><a href="#æ•°æ®å‹ç¼©" class="headerlink" title="æ•°æ®å‹ç¼©"></a>æ•°æ®å‹ç¼©</h2><p>å‹ç¼©æ•°æ®ä»¥èŠ‚çœå‚¨å­˜ç©ºé—´ï¼ŒèŠ‚çœä¼ è¾“æ—¶é—´ã€‚åŒæ—¶å¾ˆå¤šæ–‡ä»¶éƒ½æœ‰å¾ˆå¤šå†—ä½™ä¿¡æ¯ï¼Œè¿™ä¸ºå‹ç¼©æä¾›äº†å¾ˆå¤šå¯èƒ½æ€§ã€‚<br><a id="more"></a><br>é€šç”¨æ–‡ä»¶å‹ç¼©<br>Â·æ–‡ä»¶ï¼šGZIPï¼ŒBZIPï¼Œ7z<br>Â·Archiversï¼šPKZIP<br>Â·æ–‡ä»¶ç³»ç»Ÿï¼šNTFSï¼ŒHFS +ï¼ŒZFS</p><p>å¤šåª’ä½“<br>Â·å›¾åƒï¼šGIFï¼ŒJPEG<br>Â·å£°éŸ³ï¼šMP3<br>Â·è§†é¢‘ï¼šMPEGï¼ŒDivXâ„¢ï¼ŒHDTV</p><p>é€šè®¯<br>Â·ITU-T T4 Group 3 Fax<br>Â·V.42bisè°ƒåˆ¶è§£è°ƒå™¨<br>Â·Skype</p><p>æ•°æ®åº“</p><h3 id="å‹ç¼©ç‡"><a href="#å‹ç¼©ç‡" class="headerlink" title="å‹ç¼©ç‡"></a>å‹ç¼©ç‡</h3><p><code>Compression ratio = Bits in Compressed B / bits in B</code>.</p><blockquote><p>è‡ªç„¶è¯­è¨€çš„å‹ç¼©ç‡ä¸º50-75ï¼…æˆ–æ›´é«˜.</p></blockquote><h3 id="è¯»å†™äºŒè¿›åˆ¶"><a href="#è¯»å†™äºŒè¿›åˆ¶" class="headerlink" title="è¯»å†™äºŒè¿›åˆ¶"></a>è¯»å†™äºŒè¿›åˆ¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class BinaryStdIn &#123;</span><br><span class="line">    boolean readBoolean() // read 1 bit of data and return as a boolean value</span><br><span class="line">    char readChar() // read 8 bits of data and return as a char value</span><br><span class="line">    char readChar(int r) // read r bits of data and return as a char value</span><br><span class="line">    // similar methods for byte (8 bits); short (16 bits); int (32 bits); long and double (64 bits)</span><br><span class="line">    boolean isEmpty() // is the bitstream empty?</span><br><span class="line">    void close() // close the bitstream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BinaryStdOut &#123;</span><br><span class="line">    void write(boolean b) // write the specified bit</span><br><span class="line">    void write(char c) // write the specified 8-bit char</span><br><span class="line">    void write(char c, int r) // write the r least significant bits of the specified char</span><br><span class="line">    // similar methods for byte (8 bits); short (16 bits); int (32 bits); long and double (64 bits)</span><br><span class="line">    void close() // close the bitstream</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä½¿ç”¨ä¸‰ç§æ–¹æ³•è¡¨è¾¾<code>12/31/1999</code><br>1, A character stream (StdOut),<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StdOut.print(month + <span class="string">"/"</span> + day + <span class="string">"/"</span> + year);</span><br></pre></td></tr></table></figure></p><p><code>00110001</code> 1<br><code>00110010</code> 2<br><code>00101111</code> /<br><code>00110111</code> 3<br><code>00110001</code> 1<br><code>00101111</code> /<br><code>00110001</code> 1<br><code>00111001</code> 9<br><code>00111001</code> 9<br><code>00111001</code> 1<br>å…± 80bits<br>2, Three ints (BinaryStdOut)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BinaryStdOut.write(month);</span><br><span class="line">BinaryStdOut.write(day);</span><br><span class="line">BinaryStdOut.write(year);</span><br></pre></td></tr></table></figure></p><p><code>00000000 00000000 00000000 00001100</code> 12<br><code>00000000 00000000 00000000 00011111</code> 31<br><code>00000000 00000000 00000111 11001111</code> 1999<br>å…±96bits<br>3ï¼ŒA 4-bit field, a 5-bit field, and a 12-bit field (BinaryStdOut)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BinaryStdOut.write(month, <span class="number">4</span>);</span><br><span class="line">BinaryStdOut.write(day, <span class="number">5</span>);</span><br><span class="line">BinaryStdOut.write(year, <span class="number">12</span>);</span><br></pre></td></tr></table></figure></p><p><code>1100</code> 12<br><code>11111</code> 13<br><code>0111110 01111</code> 1999<br>å…±21bits</p><h3 id="é€šç”¨æ•°æ®å‹ç¼©ç®—æ³•ï¼Ÿ"><a href="#é€šç”¨æ•°æ®å‹ç¼©ç®—æ³•ï¼Ÿ" class="headerlink" title="é€šç”¨æ•°æ®å‹ç¼©ç®—æ³•ï¼Ÿ"></a>é€šç”¨æ•°æ®å‹ç¼©ç®—æ³•ï¼Ÿ</h3><p>ä¸å­˜åœ¨çš„ï¼Œå› ä¸ºå‡å¦‚çœŸçš„å­˜åœ¨ä¸€ç§å¯ä»¥å‹ç¼©æ‰€æœ‰æ¯”ç‰¹ä¸²çš„ç®—æ³•ï¼Œé‚£ä¹ˆè¯¥ç®—æ³•å°±å¯ä»¥ç»§ç»­å‹ç¼©å·²ç»è¢«å®ƒå‹ç¼©è¿‡çš„æ•°æ®ï¼Œé‚£æ„å‘³ç€æ‰€æœ‰æ¯”ç‰¹ä¸²å¯ä»¥è¢«å‹ç¼©ä¸º0æ¯”ç‰¹.</p><h2 id="Run-length-encoding"><a href="#Run-length-encoding" class="headerlink" title="Run-length encoding"></a>Run-length encoding</h2><p>Simple type of redundancy in a bitstream. Long runs of repeated bitsï¼š<br><code>0000000000000001111111000000011111111111</code><br>Compression, 4-bit counts to represent alternating runs of 0s and 1s: 15 0s, then 7 1s, then 7 0s, then 11 1s.<br><code>1111 0111 0111 1011</code><br><!-- more --><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunLength</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// maximum run-length count</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> R    = <span class="number">256</span>;</span><br><span class="line">   <span class="comment">// number of bits per count</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> LG_R = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reads a sequence of bits from standard input; compresses</span></span><br><span class="line"><span class="comment">     * them using run-length coding with 8-bit run lengths; and writes the</span></span><br><span class="line"><span class="comment">     * results to standard output.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compress</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> run = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">boolean</span> old = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (!BinaryStdIn.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> b = BinaryStdIn.readBoolean();</span><br><span class="line">            <span class="keyword">if</span> (b != old) &#123;</span><br><span class="line">                BinaryStdOut.write(run, LG_R);</span><br><span class="line">                run = <span class="number">1</span>;</span><br><span class="line">                old = !old;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// å¦‚æœé•¿åº¦è¶…è¿‡æœ€å¤§å€¼, å†™å…¥0</span></span><br><span class="line">                <span class="keyword">if</span> (run == R-<span class="number">1</span>) &#123;</span><br><span class="line">                    BinaryStdOut.write(run, LG_R);</span><br><span class="line">                    run = <span class="number">0</span>;</span><br><span class="line">                    BinaryStdOut.write(run, LG_R);</span><br><span class="line">                &#125;</span><br><span class="line">                run++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        BinaryStdOut.write(run, LG_R);</span><br><span class="line">        BinaryStdOut.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reads a sequence of bits from standard input (that are encoded</span></span><br><span class="line"><span class="comment">     * using run-length encoding with 8-bit run lengths); decodes them;</span></span><br><span class="line"><span class="comment">     * and writes the results to standard output.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">expand</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">boolean</span> bit = <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">while</span> (!BinaryStdIn.isEmpty())</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="keyword">int</span> run = BinaryStdIn.readInt(lgR);</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; run; i++)</span><br><span class="line">            BinaryStdOut.write(bit);</span><br><span class="line">         bit = !bit;</span><br><span class="line">      &#125;</span><br><span class="line">      BinaryStdOut.close();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ•°æ®å‹ç¼©&quot;&gt;&lt;a href=&quot;#æ•°æ®å‹ç¼©&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®å‹ç¼©&quot;&gt;&lt;/a&gt;æ•°æ®å‹ç¼©&lt;/h2&gt;&lt;p&gt;å‹ç¼©æ•°æ®ä»¥èŠ‚çœå‚¨å­˜ç©ºé—´ï¼ŒèŠ‚çœä¼ è¾“æ—¶é—´ã€‚åŒæ—¶å¾ˆå¤šæ–‡ä»¶éƒ½æœ‰å¾ˆå¤šå†—ä½™ä¿¡æ¯ï¼Œè¿™ä¸ºå‹ç¼©æä¾›äº†å¾ˆå¤šå¯èƒ½æ€§ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Information Retrieval" scheme="http://shukebeta.me/tags/Information-Retrieval/"/>
    
      <category term="Data Compression" scheme="http://shukebeta.me/tags/Data-Compression/"/>
    
  </entry>
  
  <entry>
    <title>ä¼—æ•°é—®é¢˜ - Boyerâ€“Moore majority vote algorithm</title>
    <link href="http://shukebeta.me/algorithms-majority-element/"/>
    <id>http://shukebeta.me/algorithms-majority-element/</id>
    <published>2018-10-02T16:00:00.000Z</published>
    <updated>2018-10-17T09:15:10.517Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°ç»„ä¸­æœ‰ä¸€ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°è¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œä¾‹å¦‚è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º9çš„æ•°ç»„<code>1,2,3,2,2,2,5,4,2</code>ã€‚ç”±äºæ•°å­—2åœ¨æ•°ç»„ä¸­å‡ºç°äº†5æ¬¡ï¼Œè¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œå› æ­¤è¾“å‡º2ã€‚å¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º0ã€‚å› ä¸ºè¿™ä¸ªæ•°å‡ºç°æ¬¡æ•°è¶…è¿‡äº†æ•°ç»„é•¿åº¦ä¸€åŠä»¥ä¸Š, é‚£ä¹ˆå®ƒå°±æ˜¯æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°, æ•…è°“ä¹‹<strong>ä¼—æ•°</strong>.<br><a id="more"></a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">MoreThanHalfNum_Solution</span><span class="params">(self, numbers)</span>:</span></span><br><span class="line">        <span class="comment"># write code here</span></span><br><span class="line">        most = numbers[<span class="number">0</span>]</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> numbers:</span><br><span class="line">            <span class="keyword">if</span> item == most:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> count &lt; <span class="number">0</span>:</span><br><span class="line">                    most = item</span><br><span class="line">                    count = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> numbers.count(most) &lt;= len(numbers) / <span class="number">2</span> <span class="keyword">else</span> most</span><br></pre></td></tr></table></figure></p><h2 id="ä¼—æ•°é—®é¢˜"><a href="#ä¼—æ•°é—®é¢˜" class="headerlink" title="ä¼—æ•°é—®é¢˜"></a>ä¼—æ•°é—®é¢˜</h2><p>ä¼—æ•°é—®é¢˜å¯ä»¥æ¨å¹¿æ³›åŒ–ï¼šç»™å®šå¤§å°ä¸º<code>n</code>çš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°æ‰€æœ‰å‡ºç°è¶…è¿‡<code>n / m</code>æ¬¡çš„å…ƒç´ ã€‚è¿™ç§é—®é¢˜å¯ä»¥ä½¿ç”¨ Boyer-Moore ç®—æ³•è§£å†³.</p><blockquote><p>The Boyerâ€“Moore majority vote algorithm is an algorithm for finding the majority of a sequence of elements using linear time and constant space. It is named after Robert S. Boyer and J Strother Moore, who published it in 1981, and is a prototypical example of a streaming algorithm.</p></blockquote><p>å¦‚æœå­˜åœ¨ä¼—æ•°å…ƒç´ ï¼Œè¯¥ç®—æ³•ä¼šæ‰¾åˆ°ä¼—æ•°å…ƒç´ ï¼šå¯¹äºå‡ºç°æ¬¡æ•°ä¸€åŠä»¥ä¸Šçš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä¼—æ•°ï¼Œç®—æ³•å°†ä¸ä¼šæ£€æµ‹åˆ°è¯¥äº‹å®ï¼Œå¹¶ä¸”ä»å°†è¾“å‡ºå…¶ä¸­ä¸€ä¸ªå…ƒç´ ã€‚</p><p>è¿™ä¸ªæ—¶å€™éœ€è¦ç¬¬äºŒæ¬¡éå†æ•°æ®, éªŒè¯åœ¨ç¬¬ä¸€æ¬¡é€šè¿‡ä¸­æ‰¾åˆ°çš„å…ƒç´ æ˜¯å¦çœŸæ­£å ä¼—æ•°ã€‚</p><p>æ¯”å¦‚æ‰¾åˆ°æ‰€æœ‰å‡ºç°è¶…è¿‡<code>n / 3</code>æ¬¡çš„å…ƒç´ , æœ€å¤šåªå¯èƒ½æœ‰2ä¸ª, å¯ä»¥ç”¨é•¿åº¦ä¸º2çš„æ•°æ®ç»“æ„(è¿™é‡Œé€‰æ‹©map)æ¥è®°å½•ä¼—æ•°.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">majorityElement</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        m = <span class="number">2</span></span><br><span class="line">        cand = [<span class="number">0</span>] * m</span><br><span class="line">        freq = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> nums:</span><br><span class="line">            <span class="keyword">if</span> len(freq) &lt; m:</span><br><span class="line">                freq[item] = <span class="number">1</span> + freq.get(item, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">elif</span> item <span class="keyword">in</span> freq:</span><br><span class="line">                freq[item] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> list(freq):</span><br><span class="line">                    freq[k] -= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> freq[k] &lt;= <span class="number">0</span>:</span><br><span class="line">                        freq.pop(k)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [k <span class="keyword">for</span> k <span class="keyword">in</span> freq <span class="keyword">if</span> nums.count(k) &gt; len(nums) // (m + <span class="number">1</span>)]</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ•°ç»„ä¸­æœ‰ä¸€ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°è¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œä¾‹å¦‚è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º9çš„æ•°ç»„&lt;code&gt;1,2,3,2,2,2,5,4,2&lt;/code&gt;ã€‚ç”±äºæ•°å­—2åœ¨æ•°ç»„ä¸­å‡ºç°äº†5æ¬¡ï¼Œè¶…è¿‡æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œå› æ­¤è¾“å‡º2ã€‚å¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º0ã€‚å› ä¸ºè¿™ä¸ªæ•°å‡ºç°æ¬¡æ•°è¶…è¿‡äº†æ•°ç»„é•¿åº¦ä¸€åŠä»¥ä¸Š, é‚£ä¹ˆå®ƒå°±æ˜¯æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°, æ•…è°“ä¹‹&lt;strong&gt;ä¼—æ•°&lt;/strong&gt;.&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Java" scheme="http://shukebeta.me/tags/Java/"/>
    
      <category term="Algorithms" scheme="http://shukebeta.me/tags/Algorithms/"/>
    
      <category term="Dynamic Programming" scheme="http://shukebeta.me/tags/Dynamic-Programming/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 06 - ä¸åŒæ ‘ç»“æ„çš„å­—ç¬¦ä¸²ç¬¦å·è¡¨</title>
    <link href="http://shukebeta.me/NLP-06-string-symbol-table-other-Trie/"/>
    <id>http://shukebeta.me/NLP-06-string-symbol-table-other-Trie/</id>
    <published>2018-09-30T16:00:00.000Z</published>
    <updated>2018-10-09T15:20:32.671Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å„ç§æ ‘çš„å˜ç§"><a href="#å„ç§æ ‘çš„å˜ç§" class="headerlink" title="å„ç§æ ‘çš„å˜ç§"></a>å„ç§æ ‘çš„å˜ç§</h2><p>ä¸ºäº†é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯, äººä»¬ä½¿ç”¨ä¸åŒçš„æ ‘ç»“æ„æ¥å®ç°ç¬¦å·è¡¨.</p><h3 id="ä¹å®«æ ¼è¾“å…¥æ³•"><a href="#ä¹å®«æ ¼è¾“å…¥æ³•" class="headerlink" title="ä¹å®«æ ¼è¾“å…¥æ³•"></a>ä¹å®«æ ¼è¾“å…¥æ³•</h3><p>å¯¹äºæ‰‹æœºçš„ä¹å®«æ ¼è¾“å…¥æ³•, ç®€å•çš„å®ç°æ–¹å¼æ˜¯å¤šæ¬¡æ•²å‡»: é€šè¿‡åå¤æŒ‰é”®è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œç›´åˆ°å‡ºç°æ‰€éœ€çš„å­—æ¯ã€‚<br><a id="more"></a><br>ä½† <a href="http://www.t9.com/" target="_blank" rel="noopener">http://www.t9.com/</a> çš„ T9 texting æ”¯æŒæ›´é«˜æ•ˆçš„è¾“å…¥æ–¹æ³•:<br>ãƒ»Find all words that correspond to given sequence of numbers.<br>ãƒ»Press 0 to see all completion options.<br><img src="/images/t9.png" alt=""><br>Ex. hello<br>ãƒ»å¤šæ¬¡æ•²å‡»: 4 4 3 3 5 5 5 5 5 5 6 6 6<br>ãƒ»T9: 4 3 5 5 6</p><p>å¯ä»¥ä½¿ç”¨ 8-way trie æ¥å®ç°.</p><h3 id="ä¸‰å…ƒæœç´¢Trie"><a href="#ä¸‰å…ƒæœç´¢Trie" class="headerlink" title="ä¸‰å…ƒæœç´¢Trie"></a>ä¸‰å…ƒæœç´¢Trie</h3><p><code>R</code>è¾ƒå¤§çš„R-way trieçš„ç©ºé—´æ•ˆç‡ä¸é«˜ï¼Œè¯»å–æ¯”è¾ƒå¤§çš„æ–‡ä»¶å¾€å¾€å¯¼è‡´å†…å­˜ä¸è¶³ã€‚ä½†å¼Šç«¯æ˜¯å¼€è¾Ÿå‡ºçš„æ•°ç»„å†…å­˜åˆ©ç”¨ç‡å…¶å®ä¸é«˜ã€‚ç°åœ¨å¾ˆå¤šç³»ç»Ÿéƒ½ä½¿ç”¨Unicodeï¼Œåˆ†æ”¯å¯é«˜è¾¾<code>65,536</code>. æ‰€ä»¥éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³•ã€‚</p><p>Ternary search tries:<br>ãƒ»Store characters and values in nodes (not keys).<br>ãƒ»Each node has 3 children: smaller (left), equal (middle), larger (right).<br><img src="/images/tst.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br>Search in a TST: Follow links corresponding to each character in the key.<br>ãƒ»If less, take left link; if greater, take right link.<br>ãƒ»If equal, take the middle link and move to the next key character.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TST</span>&lt;<span class="title">Value</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Value val;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">private</span> Node left, mid, right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Value val)</span></span></span><br><span class="line"><span class="function">    </span>&#123; root = put(root, key, val, <span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">put</span><span class="params">(Node x, String key, Value val, <span class="keyword">int</span> d)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = key.charAt(d);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123; x = <span class="keyword">new</span> Node(); x.c = c; &#125;</span><br><span class="line">        <span class="keyword">if</span> (c &lt; x.c) x.left = put(x.left, key, val, d);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (c &gt; x.c) x.right = put(x.right, key, val, d);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (d &lt; key.length() - <span class="number">1</span>) x.mid = put(x.mid, key, val, d+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> x.val = val;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String key)</span></span></span><br><span class="line"><span class="function">    </span>&#123; <span class="keyword">return</span> get(key) != <span class="keyword">null</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(String key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Node x = get(root, key, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> x.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">get</span><span class="params">(Node x, String key, <span class="keyword">int</span> d)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">         <span class="keyword">char</span> c = key.charAt(d);</span><br><span class="line">         <span class="keyword">if</span> (c &lt; x.c) <span class="keyword">return</span> get(x.left, key, d);</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (c &gt; x.c) <span class="keyword">return</span> get(x.right, key, d);</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (d &lt; key.length() - <span class="number">1</span>) <span class="keyword">return</span> get(x.mid, key, d+<span class="number">1</span>);</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>TSTsæ¯”hashingæ›´å¿«ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºæœç´¢ç¼ºå¤±é”®çš„æƒ…å†µï¼‰ã€‚</p><h3 id="åŸºæ•°æ ‘"><a href="#åŸºæ•°æ ‘" class="headerlink" title="åŸºæ•°æ ‘"></a>åŸºæ•°æ ‘</h3><p>Radix Tree, ä¹Ÿå« Patricia trie (Practical Algorithm to Retrieve Information Coded in Alphanumeric), crit-bit tree, å‹ç¼©å‰ç¼€æ ‘:<br>ãƒ»Remove one-way branching.<br>ãƒ»Each node represents a sequence of characters.<br>ãƒ»Implementation: one step beyond this course.<br><img src="/images/radix_trie.png" alt="" title="put(&quot;shells&quot;, 1); put(&quot;shellfish&quot;, 2); image from: https://algs4.cs.princeton.edu/"><br>å¯¹äºåŸºæ•°æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æ˜¯å”¯ä¸€çš„å­æ ‘çš„è¯ï¼Œå°±å’Œçˆ¶èŠ‚ç‚¹åˆå¹¶ã€‚</p><p>Applications.<br>ãƒ»Database search.<br>ãƒ»P2P network search.<br>ãƒ»IP routing tables: find longest prefix match.<br>ãƒ»Compressed quad-tree for N-body simulation.<br>ãƒ»Efficiently storing and querying XML documents.</p><h3 id="åç¼€æ ‘"><a href="#åç¼€æ ‘" class="headerlink" title="åç¼€æ ‘"></a>åç¼€æ ‘</h3><p>åç¼€æ ‘ï¼ˆSuffix treeï¼‰æŒ‡å­—ç¬¦ä¸²åç¼€çš„åŸºæ•°æ ‘: ä¸€ä¸ª<code>String S</code>çš„åç¼€æ ‘æ˜¯ä¸€ä¸ªè¾¹ï¼ˆedgeï¼‰è¢«æ ‡è®°ä¸ºå­—ç¬¦ä¸²çš„æ ‘ã€‚å› æ­¤æ¯ä¸€ä¸ª<code>S</code>çš„åç¼€éƒ½å”¯ä¸€å¯¹åº”ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ª<code>S</code>çš„åç¼€çš„åŸºæ•°æ ‘ã€‚<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Suffix_tree_BANANA.svg/250px-Suffix_tree_BANANA.svg.png" alt="" title="image from: https://en.wikipedia.org/"></p><p>Applications.<br>ãƒ»Linear-time: longest repeated substring, longest common substring, longest palindromic substring, substring search, tandem repeats, â€¦.<br>ãƒ»Computational biology databases (BLAST, FASTA).</p><h2 id="å­—ç¬¦ç¬¦å·è¡¨æ€»ç»“"><a href="#å­—ç¬¦ç¬¦å·è¡¨æ€»ç»“" class="headerlink" title="å­—ç¬¦ç¬¦å·è¡¨æ€»ç»“"></a>å­—ç¬¦ç¬¦å·è¡¨æ€»ç»“</h2><p>Red-black BST.<br>ãƒ»Performance guarantee: log N key compares.<br>ãƒ»Supports ordered symbol table API.</p><p>Hash tables.<br>ãƒ»Performance guarantee: constant number of probes.<br>ãƒ»Requires good hash function for key type.</p><p>Tries. R-way, TST.<br>ãƒ»Performance guarantee: log N characters accessed.<br>ãƒ»Supports character-based operations.<br><img src="/images/string_symbol_table_cost_sum.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"></p><blockquote><p>You can get at anything by examining 50-100 bits</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å„ç§æ ‘çš„å˜ç§&quot;&gt;&lt;a href=&quot;#å„ç§æ ‘çš„å˜ç§&quot; class=&quot;headerlink&quot; title=&quot;å„ç§æ ‘çš„å˜ç§&quot;&gt;&lt;/a&gt;å„ç§æ ‘çš„å˜ç§&lt;/h2&gt;&lt;p&gt;ä¸ºäº†é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯, äººä»¬ä½¿ç”¨ä¸åŒçš„æ ‘ç»“æ„æ¥å®ç°ç¬¦å·è¡¨.&lt;/p&gt;
&lt;h3 id=&quot;ä¹å®«æ ¼è¾“å…¥æ³•&quot;&gt;&lt;a href=&quot;#ä¹å®«æ ¼è¾“å…¥æ³•&quot; class=&quot;headerlink&quot; title=&quot;ä¹å®«æ ¼è¾“å…¥æ³•&quot;&gt;&lt;/a&gt;ä¹å®«æ ¼è¾“å…¥æ³•&lt;/h3&gt;&lt;p&gt;å¯¹äºæ‰‹æœºçš„ä¹å®«æ ¼è¾“å…¥æ³•, ç®€å•çš„å®ç°æ–¹å¼æ˜¯å¤šæ¬¡æ•²å‡»: é€šè¿‡åå¤æŒ‰é”®è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œç›´åˆ°å‡ºç°æ‰€éœ€çš„å­—æ¯ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Trie" scheme="http://shukebeta.me/tags/Trie/"/>
    
      <category term="Information Retrieval" scheme="http://shukebeta.me/tags/Information-Retrieval/"/>
    
      <category term="Symbol table" scheme="http://shukebeta.me/tags/Symbol-table/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 05 - å­—ç¬¦ä¸²ç¬¦å·è¡¨å’Œä¸‰å…ƒæœç´¢Trie</title>
    <link href="http://shukebeta.me/NLP-05-string-symbol-table-Trie/"/>
    <id>http://shukebeta.me/NLP-05-string-symbol-table-Trie/</id>
    <published>2018-09-29T16:00:00.000Z</published>
    <updated>2018-09-30T09:02:12.262Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¬¦å·è¡¨"><a href="#ç¬¦å·è¡¨" class="headerlink" title="ç¬¦å·è¡¨"></a>ç¬¦å·è¡¨</h2><blockquote><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œç¬¦å·è¡¨æ˜¯ä¸€ç§ç”¨äºè¯­è¨€ç¿»è¯‘å™¨ï¼ˆä¾‹å¦‚ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼‰ä¸­çš„æ•°æ®ç»“æ„ã€‚åœ¨ç¬¦å·è¡¨ä¸­ï¼Œç¨‹åºæºä»£ç ä¸­çš„æ¯ä¸ªæ ‡è¯†ç¬¦éƒ½å’Œå®ƒçš„å£°æ˜æˆ–ä½¿ç”¨ä¿¡æ¯ç»‘å®šåœ¨ä¸€èµ·ï¼Œæ¯”å¦‚å…¶æ•°æ®ç±»å‹ã€ä½œç”¨åŸŸä»¥åŠå†…å­˜åœ°å€ã€‚<br>å¸¸ç”¨å“ˆå¸Œè¡¨æ¥å®ç°.</p></blockquote><p>ç¬¦å·è¡¨çš„åº”ç”¨éå¸¸å¹¿æ³›, å¯ç”¨äºå®ç°Set, Dictionary, æ–‡ä»¶ç´¢å¼•, ç¨€ç–å‘é‡/çŸ©é˜µç­‰æ•°æ®ç»“æ„å’Œç›¸å…³çš„è¿ç®—æ“ä½œ, è¿˜æœ‰å…¶ä»–å¦‚è¿‡æ»¤æŸ¥è¯¢(Exception filter), ä¸€è‡´æ€§æŸ¥è¯¢(concordance queries)ç­‰æ“ä½œ.</p><p>å­—ç¬¦ç¬¦å·è¡¨å°±æ˜¯ä¸“é—¨é’ˆå¯¹å­—ç¬¦æ“ä½œçš„ç¬¦å·è¡¨, API:<br>Prefix match - Keys with prefix <code>sh</code>: <code>she</code>, <code>shells</code>, and <code>shore</code>.<br>Wildcard match - Keys that match <code>.he</code>: <code>she</code> and <code>the</code>.<br>Longest prefix - Key that is the longest prefix of <code>shellsort</code>: <code>shells</code>.<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StringST</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    StringST(); create a symbol table with string keys</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Value val)</span></span>; put key-value pair into the symbol table</span><br><span class="line">    <span class="function">Value <span class="title">get</span><span class="params">(String key)</span></span>; value paired with key</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(String key)</span></span>; delete key and corresponding value</span><br><span class="line">    <span class="function">Iterable&lt;String&gt; <span class="title">keys</span><span class="params">()</span></span>; all keys</span><br><span class="line">    <span class="function">Iterable&lt;String&gt; <span class="title">keysWithPrefix</span><span class="params">(String s)</span></span>; keys having s as a prefix</span><br><span class="line">    <span class="function">Iterable&lt;String&gt; <span class="title">keysThatMatch</span><span class="params">(String s)</span></span>; <span class="function">keys that match <span class="title">s</span> <span class="params">(where . is a wildcard)</span></span></span><br><span class="line"><span class="function">    String <span class="title">longestPrefixOf</span><span class="params">(String s)</span></span>; longest key that is a prefix of s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä»¥Trieä¸ºåŸºç¡€çš„å­—ç¬¦ç¬¦å·è¡¨"><a href="#ä»¥Trieä¸ºåŸºç¡€çš„å­—ç¬¦ç¬¦å·è¡¨" class="headerlink" title="ä»¥Trieä¸ºåŸºç¡€çš„å­—ç¬¦ç¬¦å·è¡¨"></a>ä»¥Trieä¸ºåŸºç¡€çš„å­—ç¬¦ç¬¦å·è¡¨</h3><p>algs4ä¸­æä¾›äº†ç”¨ R-way trie æ¥å®ç°ç¬¦å·è¡¨(symbol table)ä¾‹å­:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieST</span>&lt;<span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> R = <span class="number">256</span>; <span class="comment">// extended ASCII</span></span><br><span class="line">    <span class="keyword">private</span> Node root = <span class="keyword">new</span> Node();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Object value;</span><br><span class="line">        <span class="keyword">private</span> Node[] next = <span class="keyword">new</span> Node[R];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Value val)</span> </span>&#123;</span><br><span class="line">        root = put(root, key, val, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">put</span><span class="params">(Node x, String key, Value val, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) x = <span class="keyword">new</span> Node();</span><br><span class="line">        <span class="keyword">if</span> (d == key.length()) &#123; x.value = val; <span class="keyword">return</span> x; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> c = key.charAt(d);</span><br><span class="line">        x.next[c] = put(x.next[c], key, val, d+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String key)</span> </span>&#123; <span class="keyword">return</span> get(key) != <span class="keyword">null</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Node x = get(root, key, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> (Value) x.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">get</span><span class="params">(Node x, String key, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (d == key.length()) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">char</span> c = key.charAt(d);</span><br><span class="line">        <span class="keyword">return</span> get(x.next[c], key, d+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æŒ‰é¡ºåºè¿­ä»£æ‰€æœ‰é”®ï¼š<br>Â·ä¸­åºéå†trieï¼Œæ‰¾åˆ°çš„é”®æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­<br>Â·ç»´æŠ¤ä»æ ¹åˆ°å½“å‰èŠ‚ç‚¹è·¯å¾„çš„å­—ç¬¦åºåˆ—<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">keys</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Queue&lt;String&gt; queue = <span class="keyword">new</span> Queue&lt;String&gt;();</span><br><span class="line">    collect(root, <span class="string">""</span>, queue);</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">collect</span><span class="params">(Node x, String prefix, Queue&lt;String&gt; q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x.val != <span class="keyword">null</span>) q.enqueue(prefix);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">char</span> c = <span class="number">0</span>; c &lt; R; c++)</span><br><span class="line">        collect(x.next[c], prefix + c, q);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å‰ç¼€åŒ¹é…"><a href="#å‰ç¼€åŒ¹é…" class="headerlink" title="å‰ç¼€åŒ¹é…"></a>å‰ç¼€åŒ¹é…</h3><p>Find all keys in a symbol table starting with a given prefix.<br>Ex. Autocomplete in a cell phone, search bar, text editor, or shell.<br>ãƒ»User types characters one at a time.<br>ãƒ»System reports all matching strings.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">keysWithPrefix</span><span class="params">(String prefix)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Queue&lt;String&gt; queue = <span class="keyword">new</span> Queue&lt;String&gt;();</span><br><span class="line">    Node x = get(root, prefix, <span class="number">0</span>);</span><br><span class="line">    collect(x, prefix, queue);</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æœ€é•¿å‰ç¼€"><a href="#æœ€é•¿å‰ç¼€" class="headerlink" title="æœ€é•¿å‰ç¼€"></a>æœ€é•¿å‰ç¼€</h3><p>Find longest key in symbol table that is a prefix of query string.<br>Ex. To send packet toward destination IP address, router chooses IP address in routing table that is longest prefix match.</p><p>ãƒ»Search for query string.<br>ãƒ»Keep track of longest key encountered.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">longestPrefixOf</span><span class="params">(String query)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> length = search(root, query, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> query.substring(<span class="number">0</span>, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(Node x, String query, <span class="keyword">int</span> d, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="keyword">null</span>) <span class="keyword">return</span> length;</span><br><span class="line">    <span class="keyword">if</span> (x.val != <span class="keyword">null</span>) length = d;</span><br><span class="line">    <span class="keyword">if</span> (d == query.length()) <span class="keyword">return</span> length;</span><br><span class="line">    <span class="keyword">char</span> c = query.charAt(d);</span><br><span class="line">    <span class="keyword">return</span> search(x.next[c], query, d+<span class="number">1</span>, length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç¬¦å·è¡¨&quot;&gt;&lt;a href=&quot;#ç¬¦å·è¡¨&quot; class=&quot;headerlink&quot; title=&quot;ç¬¦å·è¡¨&quot;&gt;&lt;/a&gt;ç¬¦å·è¡¨&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œç¬¦å·è¡¨æ˜¯ä¸€ç§ç”¨äºè¯­è¨€ç¿»è¯‘å™¨ï¼ˆä¾‹å¦‚ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼‰ä¸­çš„æ•°æ®ç»“æ„ã€‚åœ¨ç¬¦å·è¡¨ä¸­ï¼Œç¨‹åºæºä»£ç ä¸­çš„æ¯ä¸ªæ ‡è¯†ç¬¦éƒ½å’Œå®ƒçš„å£°æ˜æˆ–ä½¿ç”¨ä¿¡æ¯ç»‘å®šåœ¨ä¸€èµ·ï¼Œæ¯”å¦‚å…¶æ•°æ®ç±»å‹ã€ä½œç”¨åŸŸä»¥åŠå†…å­˜åœ°å€ã€‚&lt;br&gt;å¸¸ç”¨å“ˆå¸Œè¡¨æ¥å®ç°.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¬¦å·è¡¨çš„åº”ç”¨éå¸¸å¹¿æ³›, å¯ç”¨äºå®ç°Set, Dictionary, æ–‡ä»¶ç´¢å¼•, ç¨€ç–å‘é‡/çŸ©é˜µç­‰æ•°æ®ç»“æ„å’Œç›¸å…³çš„è¿ç®—æ“ä½œ, è¿˜æœ‰å…¶ä»–å¦‚è¿‡æ»¤æŸ¥è¯¢(Exception filter), ä¸€è‡´æ€§æŸ¥è¯¢(concordance queries)ç­‰æ“ä½œ.&lt;/p&gt;
&lt;p&gt;å­—ç¬¦ç¬¦å·è¡¨å°±æ˜¯ä¸“é—¨é’ˆå¯¹å­—ç¬¦æ“ä½œçš„ç¬¦å·è¡¨, API:&lt;br&gt;Prefix match - Keys with prefix &lt;code&gt;sh&lt;/code&gt;: &lt;code&gt;she&lt;/code&gt;, &lt;code&gt;shells&lt;/code&gt;, and &lt;code&gt;shore&lt;/code&gt;.&lt;br&gt;Wildcard match - Keys that match &lt;code&gt;.he&lt;/code&gt;: &lt;code&gt;she&lt;/code&gt; and &lt;code&gt;the&lt;/code&gt;.&lt;br&gt;Longest prefix - Key that is the longest prefix of &lt;code&gt;shellsort&lt;/code&gt;: &lt;code&gt;shells&lt;/code&gt;.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Trie" scheme="http://shukebeta.me/tags/Trie/"/>
    
      <category term="Information Retrieval" scheme="http://shukebeta.me/tags/Information-Retrieval/"/>
    
      <category term="Symbol table" scheme="http://shukebeta.me/tags/Symbol-table/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 04 - â€œå’Œè°â€ - å¤šæ¨¡å¼åŒ¹é…ç®—æ³• - ACè‡ªåŠ¨æœº</title>
    <link href="http://shukebeta.me/NLP-04-string-match-algorithm-ac-automaton/"/>
    <id>http://shukebeta.me/NLP-04-string-match-algorithm-ac-automaton/</id>
    <published>2018-09-28T16:00:00.000Z</published>
    <updated>2018-09-30T09:02:18.827Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶KMPå¯ä»¥ç”¨äº<a href="/NLP-01-string-searching-algorithm-01-kmp">å•æ¨¡å¼åŒ¹é…é—®é¢˜</a>ï¼Œä½†å¦‚æœæ˜¯å¤šæ¨¡å¼é—®é¢˜, KMPçš„æ€§èƒ½å°±å¾—ä¸åˆ°ä¿è¯ã€‚æ¯”å¦‚æ ¹æ®å¢™å†…æ³•å¾‹è¦æ±‚, å¢™å†…çš„æœç´¢å¼•æ“éœ€è¦è¿‡æ»¤æ•æ„Ÿè¯åæ‰èƒ½åˆæ³•è¿è¥ã€‚æ•æ„Ÿè¯çš„æ•°é‡ä¸å°‘, å¦‚æœè¦æ±‚åŒ…å«æ•æ„Ÿè¯çš„ç½‘é¡µä¸èƒ½è¢«æœç´¢åˆ°, é‚£ä¹ˆæœç´¢å¼•æ“åœ¨çˆ¬å–ç½‘é¡µä¿¡æ¯æ—¶, å°±è¦æ ‡è®°ç½‘é¡µçš„æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«ä»»æ„ä¸ªæ•æ„Ÿè¯.<br><a id="more"></a></p><p>è¿™å°±æ˜¯å…¸å‹çš„å¤šæ¨¡åŒ¹é…é—®é¢˜. è¿™ç§æƒ…å†µä¸‹å¦‚æœä½¿ç”¨Trieï¼Œé‚£ä¹ˆéœ€è¦éå†ç½‘é¡µçš„æ¯ä¸€ä¸ªå­—ç¬¦ä½ç½®ï¼Œå¯¹æ¯ä¸€ä¸ªä½ç½®è¿›è¡ŒTrieå‰ç¼€åŒ¹é…ã€‚å¦‚æœè¯å…¸çš„è¯è¯­æ•°é‡ä¸ºNï¼Œæ¯ä¸ªè¯è¯­é•¿åº¦ä¸ºLï¼Œæ–‡ç« çš„é•¿åº¦ä¸ºMï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œçš„è®¡ç®—æ¬¡æ•°æ˜¯åœ¨<code>N*M*L</code>è¿™ä¸ªçº§åˆ«çš„. å³ä½¿æŠŠè¯è¯­çš„é•¿åº¦Lç®€åŒ–ä¸ºå¸¸æ•°çº§åˆ«çš„, æ•´ä¸ªç®—æ³•çš„å¤æ‚åº¦ä¹Ÿè‡³å°‘æ˜¯$O(n^2)$.</p><h2 id="ACè‡ªåŠ¨æœº"><a href="#ACè‡ªåŠ¨æœº" class="headerlink" title="ACè‡ªåŠ¨æœº"></a>ACè‡ªåŠ¨æœº</h2><p>å¯ä»¥çœ‹åˆ°ï¼ŒKMPç®—æ³•å¯ä»¥é¿å…back upï¼ˆåœ¨æ£€æŸ¥å­—ç¬¦çš„è¿‡ç¨‹ä¸­ä¸éœ€è¦å›å¤´ï¼‰ï¼Œè€ŒTrieå¯ä»¥å­˜å‚¨å¤šä¸ªæ¨¡å¼çš„ä¿¡æ¯ã€‚å¦‚æœæŠŠäºŒè€…ç»“åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿè®¸èƒ½ä»æ€§èƒ½ä¸Šè§£å†³å¤šæ¨¡å¼ï¼ˆä»»æ„ä½ç½®ï¼‰åŒ¹é…é—®é¢˜ã€‚è¿™å°±æ˜¯Ahoâ€“Corasickç®—æ³•ï¼ˆACè‡ªåŠ¨æœºï¼‰ã€‚</p><blockquote><p>Ahoâ€“Corasickç®—æ³•æ˜¯ç”±Alfred V. Ahoå’ŒMargaret J.Corasick å‘æ˜çš„å­—ç¬¦ä¸²æœç´¢ç®—æ³•ï¼Œç”¨äºåœ¨è¾“å…¥çš„ä¸€ä¸²å­—ç¬¦ä¸²ä¸­åŒ¹é…æœ‰é™ç»„å­—å…¸ä¸­çš„å­ä¸²ã€‚å®ƒä¸æ™®é€šå­—ç¬¦ä¸²åŒ¹é…çš„ä¸åŒç‚¹åœ¨äºåŒæ—¶ä¸æ‰€æœ‰å­—å…¸ä¸²è¿›è¡ŒåŒ¹é…ã€‚ç®—æ³•å‡æ‘Šæƒ…å†µä¸‹å…·æœ‰è¿‘ä¼¼äºçº¿æ€§çš„æ—¶é—´å¤æ‚åº¦ï¼Œçº¦ä¸ºå­—ç¬¦ä¸²çš„é•¿åº¦åŠ æ‰€æœ‰åŒ¹é…çš„æ•°é‡ã€‚</p></blockquote><p>æ‰€ä»¥ç®—æ³•çš„å…³é”®å°±æ˜¯é€šè¿‡TrieæŠŠå¤šä¸ªæ¨¡å¼æ„å»ºä¸ºä¸€ä¸ªDFAï¼ˆDeterministic finite state automatonï¼‰ï¼Œç„¶åè®©æ¨¡å¼ä¸²æœ«å°¾å¯¹åº”çš„çŠ¶æ€ä½œä¸ºä¸€ä¸ªDFAçš„ç»ˆæ­¢èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œå¯¹äºä¸€ä¸ªè¦æ£€æŸ¥çš„é•¿å­—ç¬¦ä¸²ï¼ˆå¦‚ä¸€æ®µç½‘é¡µå†…å®¹ï¼‰ï¼Œè®©è¿™ä¸ªå­—ç¬¦ä¸²åœ¨DFAä¸Šè·‘ä¸€è¶Ÿï¼Œæ¯ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºä¸€ç§è·³è½¬æ–¹å¼ï¼Œå¦‚æœè¿™æ®µå­—ç¬¦èƒ½å¤Ÿè·³åˆ°ä»»ä½•ä¸€ä¸ªç»ˆç»“èŠ‚ç‚¹, é‚£ä¹ˆå°±è¡¨æ˜è¿™æ®µå­—ç¬¦ä¸²åŒ¹é…äº†è‡³å°‘ä¸€ä¸ªæ¨¡å¼, å¦‚æœæ•´æ®µå­—ç¬¦è·‘å®Œéƒ½æ²¡åˆ°è¾¾ç»ˆç»“èŠ‚ç‚¹, é‚£ä¹ˆè¿™ä¸ªç½‘é¡µå°±æ˜¯â€å’Œè°çš„â€.</p><p>åœ¨å•æ¨¡å¼åŒ¹é…ä¸­, ç”¨KMPæ„å»ºçš„DFAæ˜¯æ¯”è¾ƒç®€å•çš„, ä»å·¦åˆ°å³, å¼€å¤´çš„çŠ¶æ€å°±æ˜¯å¼€å§‹çŠ¶æ€, ç»“å°¾çš„çŠ¶æ€å°±æ˜¯ç»“æŸçŠ¶æ€:<br><img src="/images/build_dfa.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br>è€Œå¤šæ¨¡å¼åŒ¹é…ä¸­, åœ¨Trieçš„ç»“æ„åŸºç¡€ä¸Šæ„å»ºå‡ºæ¥çš„DFAæ›´åƒä¸€ä¸ªDFAçš„æ ·å­:<br><img src="/images/ushers_dfa.png" alt="" title="ç»å…¸çš„ushersè‡ªåŠ¨æœºï¼Œæ¨¡å¼ä¸²æ˜¯he/ she/ his /hers, å¿½ç•¥äº†éƒ¨åˆ†åˆ°æ ¹èŠ‚ç‚¹çš„è½¬ç§»è¾¹. image from: https://baike.baidu.com/pic"><br>Trieä¸­çš„èŠ‚ç‚¹, å°±ç±»ä¼¼äºDFAä¸­çš„çŠ¶æ€. å¦‚æœè®©å­—ç¬¦ä¸²<code>shis</code>åœ¨ä¸Šé¢è·‘, å‡å¦‚ä»…ä»…æ˜¯é Trie(ä¹Ÿå³æ˜¯æ²¡æœ‰è™šçº¿æ ‡è¯†çš„è½¬ç§»), é‚£ä¹ˆç¬¬ä¸€æ¬¡ä»å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦<code>s</code>å¼€å§‹è½¬ç§», ç»è¿‡è½¬ç§»è·¯å¾„<code>0 - 85 - 90</code>ä¹‹åå°±è½¬ä¸åŠ¨äº†, å› ä¸ºTrieè®°å½•çš„æ¨¡å¼ä¸­æ²¡æœ‰<code>shi</code>, è¿™ä¸ªæ—¶å€™å¾—back up, ä»ç¬¬äºŒä¸ªä½ç½®<code>h</code>å¼€å§‹å†åŒ¹é…ä¸€é. è¿™ä¸ªè¿‡ç¨‹ä¸­å°±äº§ç”Ÿé‡å¤åŒ¹é…, è€Œå‚è€ƒKMPçš„æ€è·¯, åœ¨åŒ¹é…<code>shi</code>çš„è¿‡ç¨‹ä¸­, å…¶å®å·²ç»æŒ–æ˜å‡ºäº†<code>hi</code>è¿™ä¸ªå­ä¸²äº†, è€Œè¿™ä¸ªå­ä¸²æ˜¯è·Ÿæ¨¡å¼<code>his</code>å¯¹åº”çš„, å¦‚æœæœ‰åŠæ³•ä¸å›å¤´ç»§ç»­åŒ¹é…ä¸‹å»å°±èƒ½æé«˜æ€§èƒ½äº†.</p><p>è€ŒDFAä¸­è™šçº¿çš„å¤±è´¥è½¬ç§»å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„: å½“èµ°åˆ°çŠ¶æ€<code>90</code>æ—¶, å‰é¢æœ‰äº†å°éƒ¨åˆ†å­ä¸²<code>h</code>åˆšå¥½å¯¹åº”çŠ¶æ€<code>74</code>, è¿™ä¸ªæ—¶å€™ç”¨è™šçº¿ä½œä¸ºå¤±è´¥è½¬ç§», è½¬ç§»åˆ°<code>74</code>, åœ¨çŠ¶æ€<code>74</code>ä¸­å¯»æ‰¾ä¸‹ä¸€ä¸ªè½¬ç§»<code>i</code>, è¿™æ ·å°±å®ç°äº†ä¸å›å¤´ç»§ç»­åŒ¹é…äº†.</p><p>å› ä¸ºACè‡ªåŠ¨æœºæ˜¯åœ¨Trieçš„åŸºç¡€ä¸Šæ·»åŠ è¾¹, ç”¨äºæŒ‡ç¤ºå„ä¸ªèŠ‚ç‚¹ç»è¿‡ä¸åŒå­—ç¬¦åè·³è½¬åˆ°å“ªä¸ªèŠ‚ç‚¹, ç»“æœå°±å˜æˆäº†å›¾, æ‰€ä»¥ä¹Ÿå«åš<strong>Trieå›¾</strong>.</p><p>è¦æ„å»ºACè‡ªåŠ¨æœº:</p><ol><li>é¦–å…ˆè¦æŠŠæ‰€æœ‰æ¨¡å¼éƒ½åƒè¿›ä¸€ä¸ªTrieä¸­(æœ€è¿‘çœ‹å¤šè¿›å‡»çš„å·¨äººäº†), æ„å»ºå‡ºä¸€ä¸ªç”±ä¸åŒå®çº¿ä¸²è”èµ·æ¥çš„çŠ¶æ€æœº, å…¶ä¸­ä»£è¡¨æ›´å¥½å»åˆä¸€ä¸ªæ¨¡å¼çš„çŠ¶æ€æ ‡è®°ä¸ºç»ˆç»“èŠ‚ç‚¹(å¦‚ä¸Šå›¾ç»¿è‰²èŠ‚ç‚¹)</li><li>ç„¶åè¡¥å…¨å…¶ä»–å­—ç¬¦çš„è½¬ç§»(å¤±è´¥è½¬ç§»), ç”¨è™šçº¿è¡¨ç¤º. è¡¥å…¨äº†æ‰€æœ‰å­—ç¬¦çš„è½¬ç§»æ–¹å¼, æ‰èƒ½è®©å­—ç¬¦ä¸²æ°¸ä¸å›å¤´åœ°åŒ¹é…ä¸‹å», é¿å…äº†back up, ä¿è¯æ€§èƒ½.</li></ol><p>é—®é¢˜çš„å…³é”®åœ¨å¦‚ä½•è¡¥å…¨æ‰€æœ‰çš„çŠ¶æ€è½¬ç§».</p><h3 id="è¡¥å…¨çŠ¶æ€è½¬ç§»"><a href="#è¡¥å…¨çŠ¶æ€è½¬ç§»" class="headerlink" title="è¡¥å…¨çŠ¶æ€è½¬ç§»"></a>è¡¥å…¨çŠ¶æ€è½¬ç§»</h3><p><img src="/images/ushers_dfa.png" alt="" title="ç»å…¸çš„ushersè‡ªåŠ¨æœºï¼Œæ¨¡å¼ä¸²æ˜¯he/ she/ his /hers, å¿½ç•¥äº†éƒ¨åˆ†åˆ°æ ¹èŠ‚ç‚¹çš„è½¬ç§»è¾¹. image from: https://baike.baidu.com/pic"><br>è¿™é‡Œè¦åœ¨Trieç»“æ„ä¸­å®šä¹‰ä¸€ä¸ª<a href="https://hihocoder.com/problemset/problem/1036" target="_blank" rel="noopener">åç¼€èŠ‚ç‚¹</a>çš„æ¦‚å¿µ: Trieä¸­å¯¹åº”è·¯å¾„(å·²æœ‰æ¨¡å¼)å»æ‰éƒ¨åˆ†å‰ç¼€å­—ç¬¦åå‰©ä½™çš„åç¼€å­—ç¬¦åœ¨Trieä¸­å¯¹åº”çš„ç»“ç‚¹. æ¯”å¦‚ä¸Šå›¾ä¸­, <code>h</code>ä½œä¸º<code>sh</code>çš„ä¸€ä¸ªåç¼€, <code>h</code>å¯¹åº”çš„TrieèŠ‚ç‚¹<code>74</code>å°±æ˜¯<code>sh</code>å¯¹åº”èŠ‚ç‚¹<code>90</code>çš„åç¼€èŠ‚ç‚¹. ç­‰äºè¯´, <strong>èŠ‚ç‚¹å’Œå…¶åç¼€èŠ‚ç‚¹å¯¹åº”çš„æ¨¡å¼æœ‰ä¸€éƒ¨åˆ†åç¼€æ˜¯ç›¸åŒ</strong>.</p><p>å¦‚æœçŸ¥é“äº†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„åç¼€èŠ‚ç‚¹, é‚£ä¹ˆåœ¨åŒ¹é…çš„è¿‡ç¨‹ä¸­, åœ¨ä»»ä¸€ä½ç½®åŒ¹é…å¤±è´¥, éƒ½å¯ä»¥é€šè¿‡å¤±è´¥è½¬ç§»çš„æ–¹å¼è½¬ç§»åˆ°åç¼€èŠ‚ç‚¹, ç»§ç»­è¿›è¡Œåç»­åŒ¹é…, è€Œä¸ä¼šé—æ¼, å› ä¸ºåç¼€èŠ‚ç‚¹å¯¹åº”è¿™ä¸ªç›®å‰ä¸ºæ­¢å·²åŒ¹é…å­—ç¬¦çš„æŸä¸€éƒ¨åˆ†åç¼€. ç­‰äºè¯´, åç¼€èŠ‚ç‚¹å‘Šè¯‰æˆ‘ä»¬, åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°ä¸æ¨¡å¼ä¸åŒçš„å­—ç¬¦ä¸²æ—¶(åŒ¹é…å¤±è´¥), å¦‚ä½•è½¬ç§»åˆ°å…¶ä»–çŠ¶æ€.</p><p>æ‰€ä»¥é—®é¢˜çš„å…³é”®åˆå˜æˆäº†å¦‚ä½•æ±‚åç¼€èŠ‚ç‚¹.</p><h3 id="æ±‚åç¼€èŠ‚ç‚¹"><a href="#æ±‚åç¼€èŠ‚ç‚¹" class="headerlink" title="æ±‚åç¼€èŠ‚ç‚¹"></a>æ±‚åç¼€èŠ‚ç‚¹</h3><p>è§‚å¯ŸTrieç»“æ„å¯ä»¥å‘ç°ä¸¤ä¸ªè¦ç‚¹</p><ol><li>å­—ç¬¦ä¸²ä»»ä½•ä¸€ä¸ªä½ç½®å¯¹åº”çš„çŠ¶æ€èŠ‚ç‚¹ï¼Œä¸€å®šæ¯”å®ƒçš„åç¼€èŠ‚ç‚¹æ›´æ·±ï¼Œæ¯”å¦‚å‰é¢ä¾‹å­ä¸­çŠ¶æ€èŠ‚ç‚¹<code>90</code>åœ¨ç¬¬äºŒå±‚, è€Œå…¶åç¼€èŠ‚ç‚¹<code>74</code>åœ¨ç¬¬ä¸€å±‚. è¿™ç‚¹ä¹Ÿæ˜¯ç†æ‰€å½“ç„¶çš„, æ¯•ç«Ÿåç¼€æ¯”è¾ƒçŸ­. ä»åŠ¨æ€è§„åˆ’çš„è§’åº¦è€ƒè™‘, å­—ç¬¦ä¸²ä»»ä¸€ä½ç½®<code>i</code>å¯¹åº”çš„çŠ¶æ€èŠ‚ç‚¹çš„åç¼€èŠ‚ç‚¹ä¸€å®šæ˜¯<code>k&lt;i</code>çš„èŠ‚ç‚¹ä¸­çš„æŸä¸€ä¸ª.</li><li>å› ä¸ºæ¯ä¸€ä¸ªçŠ¶æ€<code>i</code>éƒ½æ˜¯ç”±å…¶çˆ¶èŠ‚ç‚¹<code>j</code>é€šè¿‡æŸä¸€ä¸ªå­—ç¬¦<code>c</code>è½¬ç§»è€Œæ¥, é‚£ä¹ˆ<code>i</code>çš„åç¼€èŠ‚ç‚¹ä¸€å®šæ˜¯<code>j</code>çš„åç¼€èŠ‚ç‚¹é€šè¿‡åŒæ ·çš„å­—ç¬¦<code>c</code>è½¬ç§»è€Œæ¥. æˆ–è€…è¯´, å¦‚æœ<code>j</code>çš„åç¼€èŠ‚ç‚¹æ˜¯<code>jj</code>, é‚£ä¹ˆ<code>j</code>å’Œ<code>jj</code>æœ‰ç€ç›¸åŒçš„åç¼€, å®ƒä»¬é€šè¿‡åŒæ ·çš„è½¬ç§»å­—ç¬¦<code>c</code>è½¬ç§»å, äºŒè€…åˆ°è¾¾çš„èŠ‚ç‚¹ä¹Ÿä¸€å®šæœ‰ç€ç›¸åŒçš„åç¼€.</li></ol><p>æ¯”å¦‚ä¸Šé¢Ushersè‡ªåŠ¨æœºä¾‹å­ä¸­, å¦‚æœç”¨å­—ç¬¦ä¸²<code>sshis</code>æ¥è·‘, é‚£ä¹ˆ<code>ssh</code>å¯¹åº”çš„çŠ¶æ€<code>90</code>, æ˜¯ç”±å‰ç¼€<code>ss</code>é€šè¿‡å­—ç¬¦<code>h</code>è½¬ç§»è€Œæ¥. å› ä¸º<code>ssh</code>çš„åç¼€èŠ‚ç‚¹, åŒæ ·æ˜¯æŸä¸€ä¸ªæœ‰å…±åŒåç¼€çš„å­—ç¬¦(<code>h</code>æˆ–è€…<code>sh</code>)å¯¹åº”çš„çŠ¶æ€(åœ¨è¿™é‡Œæ˜¯<code>h</code>å¯¹åº”çš„<code>74</code>). å¯ä»¥å‘ç°<code>74</code>æ˜¯ç”±æ ¹èŠ‚ç‚¹<code>0</code>é€šè¿‡åŒæ ·çš„å­—ç¬¦<code>h</code>è½¬ç§»è€Œæ¥çš„. åè¿‡æ¥è¯´, èŠ‚ç‚¹<code>0</code>å°±æ˜¯èŠ‚ç‚¹<code>90</code>çš„çˆ¶èŠ‚ç‚¹<code>85</code>çš„åç¼€èŠ‚ç‚¹.</p><p>åœ¨å¤šä¸ªæ¨¡å¼ä¸­, å¦‚æœæœ‰æŸæ¨¡å¼çš„å‰ç¼€åˆšå¥½æ˜¯å¦ä¸€æ¨¡å¼çš„å­ä¸²(åç¼€). æ¯”å¦‚ä¸Šé¢Ushersè‡ªåŠ¨æœºä¾‹å­ä¸­, æ¨¡å¼<code>her</code>(æˆ–è€…<code>he</code>)çš„å‰ç¼€<code>he</code>å°±æ˜¯æ¨¡å¼<code>she</code>çš„å­ä¸², åˆ™ä¼šäºŒè€…å­˜åœ¨å¤±è´¥è½¬ç§»çš„å…³è”. å¦‚æœæ²¡æœ‰, é‚£ä¹ˆå°±è·³å›åˆå§‹çŠ¶æ€èŠ‚ç‚¹.</p><p>æ‰€ä»¥è¡¥å…¨æ‰€æœ‰çŠ¶æ€è½¬ç§»çš„å…·ä½“å®ç°æ–¹æ³•å°±æ˜¯è¿ç”¨åŠ¨æ€è§„åˆ’çš„åŸç†:</p><ul><li>ä»Trieæ ¹èŠ‚ç‚¹å¼€å§‹, é€å±‚å¾€ä¸‹è¡¥å…¨æ¯ä¸€å±‚çš„çŠ¶æ€è½¬ç§», ä¹Ÿå°±æ˜¯å®½åº¦ä¼˜å…ˆéå†(BFS), è¿™æ ·ä¸‹å±‚çš„çŠ¶æ€è½¬ç§»å°±å¯ä»¥åˆ©ç”¨ä¸Šå±‚çš„ç»“æœ. åŠ¨æ€è§„åˆ’çš„è½¬ç§»æ–¹ç¨‹å¯ä»¥æè¿°ä¸º: <strong>æ¯ä¸€ä¸ªé€šè¿‡å­—ç¬¦<code>c</code>è½¬ç§»è€Œæ¥çš„çŠ¶æ€èŠ‚ç‚¹<code>i</code>çš„åç¼€èŠ‚ç‚¹ = <code>i</code>çš„çˆ¶èŠ‚ç‚¹çš„åç¼€èŠ‚ç‚¹é€šè¿‡<code>c</code>è½¬ç§»åˆ°çš„çŠ¶æ€èŠ‚ç‚¹</strong></li><li>åˆå§‹çŠ¶æ€åŒ…å«ä¸¤éƒ¨åˆ†:<ul><li>ä¸€ä¸ªæ˜¯æ ¹èŠ‚ç‚¹(åˆå§‹çŠ¶æ€<code>0</code>), å®ƒçš„åç¼€èŠ‚ç‚¹å°±æ˜¯å®ƒè‡ªå·±,</li><li>å¦ä¸€ä¸ªæ˜¯ç¬¬ä¸€å±‚çš„çŠ¶æ€èŠ‚ç‚¹, å¦‚<code>85, 74</code>, å› ä¸ºå®ƒä»¬å¯¹åº”çš„æ˜¯é•¿åº¦ä¸º<code>1</code>çš„å­—ç¬¦, æ²¡æœ‰åç¼€, æ‰€ä»¥å®ƒä»¬çš„åç¼€èŠ‚ç‚¹ä¹Ÿæ˜¯æ ¹èŠ‚ç‚¹<code>0</code>.</li></ul></li></ul><p>åœ¨å®ç°ä¸­è¿˜è¦æ³¨æ„, <strong>åç¼€ç»“ç‚¹ä¸ºæ ‡è®°ç»“ç‚¹çš„ç»“ç‚¹ä¹Ÿéœ€è¦è¢«æ ‡è®°</strong>. å› ä¸ºåœ¨çŠ¶æ€è½¬ç§»è¿‡ç¨‹ä¸­, å¦‚æœæŸä¸ªè™šçº¿è½¬ç§»åˆšå¥½è½¬ç§»åˆ°ç»ˆç»“èŠ‚ç‚¹, ä½†åœ¨å­—ç¬¦ä¸²éå†çš„è¿‡ç¨‹ä¸­, å¹¶æ²¡æœ‰é€‰æ‹©èµ°è¿™ä¸€æ¡çº¿, å°±ä¼šå¿½ç•¥äº†è¿™ä¸ªç»ˆç»“èŠ‚ç‚¹, å¯¼è‡´åŒ¹é…å¤±è´¥, æˆ–è€…å¤šèµ°äº†æ›´å¤šçš„è·¯. æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å¦‚æœæŠŠæ¨¡å¼<code>she</code>æ”¹ä¸º<code>shee</code>, <code>91</code>ä¸å†æ˜¯ç»ˆç»“èŠ‚ç‚¹, è€Œæ˜¯å»¶ä¼¸åˆ°<code>92</code>ä¸ºç»ˆç»“èŠ‚ç‚¹, <code>91</code>çš„åç¼€èŠ‚ç‚¹æ˜¯<code>76</code>. å¦‚æœç”¨å­—ç¬¦ä¸²<code>sshe</code>æ¥è·‘è¿™ä¸ªDFA, å°±ä¼šå‡ºç°èµ°åˆ°æœ€åå­—ç¬¦<code>e</code>æ—¶, åœ¨èŠ‚ç‚¹<code>91</code>ç»“æŸ, åŒ¹é…å¤±è´¥. æ‰€ä»¥éœ€è¦æŠŠ<code>91</code>ä¹Ÿæ ‡è®°ä¸ºç»ˆç»“èŠ‚ç‚¹.</p><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŠŠå­—å…¸é€šè¿‡insertæŠŠæ‰€æœ‰å•è¯æ’å…¥Trieæ ‘ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç„¶åé€šè¿‡setSuffix()æ„å»ºå‡ºå¯¹åº”çš„Trieå›¾ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç„¶åä»Trieå›¾çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€æ–‡ç« strçš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œèµ°å‡ºå¯¹åº”çš„è¾¹ï¼Œ</span></span><br><span class="line"><span class="comment"> * ç›´åˆ°é‡åˆ°ä¸€ä¸ªæ ‡è®°ç»“ç‚¹æˆ–è€…æ•´ä¸ªstréƒ½éå†å®Œæˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TrieNode trie;</span><br><span class="line">    Queue&lt;TrieNode&gt; queue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        trie = <span class="keyword">new</span> TrieNode(<span class="keyword">null</span>, <span class="string">' '</span>);</span><br><span class="line">        queue = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        TrieNode curNode = trie;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> x : word.toCharArray()) &#123;</span><br><span class="line">            curNode = insert(curNode, x);</span><br><span class="line">        &#125;</span><br><span class="line">        curNode.setLast(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** insert char x, means create a new node in the x edge.</span></span><br><span class="line"><span class="comment">     * return created node  */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TrieNode <span class="title">insert</span><span class="params">(TrieNode node, <span class="keyword">char</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.get(x) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.set(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.get(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** BFS on the trie */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        queue.add(trie);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">/** poll() removes the present head.</span></span><br><span class="line"><span class="comment">             http://www.tutorialspoint.com/java/util/linkedlist_poll.htm */</span></span><br><span class="line">            TrieNode node = queue.poll();</span><br><span class="line">            setSuffix(node);</span><br><span class="line">            complementDFA(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Set node's suffix, complement lacking edge</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TrieNode <span class="title">setSuffix</span><span class="params">(TrieNode node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.root == <span class="keyword">null</span>) &#123; <span class="comment">// Trie root</span></span><br><span class="line">            node.suffix = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.root.root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            node.suffix = node.root.suffix;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.suffix = node.root.suffix.get(node.fromIndex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (node.suffix.isLast) &#123;</span><br><span class="line">            node.isLast = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node.suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Complement DFA according to suffix */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">complementDFA</span><span class="params">(TrieNode node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.isLast) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; node.edges.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.edges[i] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node.root == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    node.edges[i] = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.edges[i] = node.suffix.edges[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                queue.add(node.edges[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> contains = <span class="keyword">false</span>;</span><br><span class="line">        TrieNode curNode = trie;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> x = s.charAt(i);</span><br><span class="line">            curNode = curNode.get(x);</span><br><span class="line">            <span class="keyword">if</span> (curNode.isLast) &#123;</span><br><span class="line">                contains = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> contains;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> R = <span class="number">26</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ATO0 = <span class="number">97</span>;</span><br><span class="line">        <span class="keyword">boolean</span> isLast;</span><br><span class="line">        TrieNode[] edges;</span><br><span class="line">        TrieNode root;</span><br><span class="line">        <span class="keyword">char</span> fromIndex;</span><br><span class="line">        TrieNode suffix;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">(TrieNode root, <span class="keyword">char</span> from)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.root = root;</span><br><span class="line">            fromIndex = from;</span><br><span class="line">            edges = <span class="keyword">new</span> TrieNode[R];</span><br><span class="line">            isLast = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">get</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> edges[ch - ATO0];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** instantiate the ch child in edges */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">            edges[ch - ATO0] = <span class="keyword">new</span> TrieNode(<span class="keyword">this</span>, ch);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLast</span><span class="params">(<span class="keyword">boolean</span> isLast)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.isLast = isLast;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        Trie t = <span class="keyword">new</span> Trie();</span><br><span class="line">        String[] X = &#123;<span class="string">"sb"</span>, <span class="string">"dsb"</span>, <span class="string">"cjdsb"</span>, <span class="string">"qnmlgb"</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (String x : X) &#123;</span><br><span class="line">            t.insert(x);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        t.setSuffix();</span><br><span class="line">        String s = <span class="string">"aadbaaadaaac"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (t.search(s)) &#123;</span><br><span class="line">            System.out.println(<span class="string">"YES"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"NO"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è™½ç„¶KMPå¯ä»¥ç”¨äº&lt;a href=&quot;/NLP-01-string-searching-algorithm-01-kmp&quot;&gt;å•æ¨¡å¼åŒ¹é…é—®é¢˜&lt;/a&gt;ï¼Œä½†å¦‚æœæ˜¯å¤šæ¨¡å¼é—®é¢˜, KMPçš„æ€§èƒ½å°±å¾—ä¸åˆ°ä¿è¯ã€‚æ¯”å¦‚æ ¹æ®å¢™å†…æ³•å¾‹è¦æ±‚, å¢™å†…çš„æœç´¢å¼•æ“éœ€è¦è¿‡æ»¤æ•æ„Ÿè¯åæ‰èƒ½åˆæ³•è¿è¥ã€‚æ•æ„Ÿè¯çš„æ•°é‡ä¸å°‘, å¦‚æœè¦æ±‚åŒ…å«æ•æ„Ÿè¯çš„ç½‘é¡µä¸èƒ½è¢«æœç´¢åˆ°, é‚£ä¹ˆæœç´¢å¼•æ“åœ¨çˆ¬å–ç½‘é¡µä¿¡æ¯æ—¶, å°±è¦æ ‡è®°ç½‘é¡µçš„æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«ä»»æ„ä¸ªæ•æ„Ÿè¯.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Trieå›¾" scheme="http://shukebeta.me/tags/Trie%E5%9B%BE/"/>
    
      <category term="ACè‡ªåŠ¨æœº" scheme="http://shukebeta.me/tags/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 03 - å•æ¨¡å¼åŒ¹é…ä¸æ‹¼å†™æ£€æŸ¥ - Trie</title>
    <link href="http://shukebeta.me/NLP-03-string-match-algorithm-Trie/"/>
    <id>http://shukebeta.me/NLP-03-string-match-algorithm-Trie/</id>
    <published>2018-09-27T16:00:00.000Z</published>
    <updated>2018-09-30T09:02:24.563Z</updated>
    
    <content type="html"><![CDATA[<p>Trie ä¹Ÿç§°å­—å…¸æ ‘ï¼Œåç§°æ¥æºäºRe<font color="red">trie</font>valï¼Œæ”¯æŒ$O(n)$æ’å…¥å’ŒæŸ¥è¯¢æ“ä½œï¼Œä»¥ç©ºé—´æ¢å–æ—¶é—´çš„æ•°æ®ç»“æ„. ç”¨äºè¯é¢‘ç»Ÿè®¡å’Œè¾“å…¥ç»Ÿè®¡é¢†åŸŸ, å¯ä»¥é«˜æ•ˆåœ°å­˜å‚¨å¤§è§„æ¨¡çš„å­—å…¸æ•°æ®, ä¹Ÿå¯ä»¥ç”¨äºæ¨¡ç³ŠåŒ¹é…, æœç´¢æœ€é•¿å‰ç¼€è¯ç­‰.</p><blockquote><p>A <strong>trie</strong>, also called <strong>digital tre</strong>e, <strong>radix tree</strong> or <strong>prefix tree</strong> is a kind of search tree - an ordered tree data structure used to store a dynamic set or associative array where the keys are usually strings. Unlike a binary search tree, no node in the tree stores the key associated with that node; instead, its position in the tree defines the key with which it is associated. All the descendants of a node have a common prefix of the string associated with that node, and the root is associated with the empty string. Keys tend to be associated with leaves, though some inner nodes may correspond to keys of interest. Hence, keys are not necessarily associated with every node.</p></blockquote><a id="more"></a><p><img src="/images/Trie_example.png" alt="" title="A trie for keys &quot;A&quot;,&quot;to&quot;, &quot;tea&quot;, &quot;ted&quot;, &quot;ten&quot;, &quot;i&quot;, &quot;in&quot;, and &quot;inn&quot;. Image from https://en.wikipedia.org/wiki/Trie"></p><h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><p>Trieæ²¡æœ‰è§„å®šæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†æ”¯æ•°é‡, ç”¨<strong>R-way Trie</strong>æ¥è¡¨ç¤ºåˆ†æ”¯æ•°é‡ä¸º<code>R</code>çš„Trie. å¯¹äºä¸åŒçš„åº”ç”¨, å¯ä»¥è®¾ç½®ä¸åŒçš„<code>R</code>.</p><h3 id="å­—ç¬¦ï¼ˆæ¨¡ç³Šï¼‰åŒ¹é…ä¸æ‹¼å†™æ£€æŸ¥"><a href="#å­—ç¬¦ï¼ˆæ¨¡ç³Šï¼‰åŒ¹é…ä¸æ‹¼å†™æ£€æŸ¥" class="headerlink" title="å­—ç¬¦ï¼ˆæ¨¡ç³Šï¼‰åŒ¹é…ä¸æ‹¼å†™æ£€æŸ¥"></a>å­—ç¬¦ï¼ˆæ¨¡ç³Šï¼‰åŒ¹é…ä¸æ‹¼å†™æ£€æŸ¥</h3><p>åº”ç”¨ä¾‹å­æ˜¯åœ¨ä¸€æœ¬å­—å…¸ä¸­æŸ¥æ‰¾ç‰¹å®šå‰ç¼€çš„æ‰€æœ‰å•è¯. ç®€åŒ–çš„ä¾‹å­æ˜¯åœ¨è‹±æ–‡å­—å…¸ä¸­, æ ¹æ®æŸ¥è¯¢å‰ç¼€, è¿”å›ç›¸åŒå‰ç¼€çš„æ‰€æœ‰å•è¯æ•°. åŒæ ·çš„ç»“æ„å¯ä»¥ç”¨æ¥æ£€æŸ¥æ‹¼å†™é”™è¯¯.</p><p>é‚£ä¹ˆåªéœ€è¦åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨è¯¥èŠ‚ç‚¹ä»¥ä¸‹æ‰€æœ‰å•è¯æ•°å°±è¡Œäº†. æ¯ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé•¿åº¦26çš„æ•°ç»„ï¼Œä»¥æ–¹ä¾¿å¿«é€Ÿå®šä½å¯¹åº”çš„26ä¸ªå­—æ¯, ç±»ä¼¼B-tree:<img src="/images/b_tree.png" alt="" title="image from https://www.coursera.org/learn/algorithms-part1"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­—æ¯æœ¬èº«å¯ä»¥ç”¨æ¥ä½œä¸ºç´¢å¼•ï¼ša - 97, z - 122</span></span><br><span class="line"><span class="comment"> * Color æ˜¯å¤‡ç”¨å±æ€§ï¼Œ ç”¨äºæ ‡è®°è¯¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå•è¯ç»“å°¾ï¼Œè¿™é‡Œæš‚æ—¶ç”¨ä¸åˆ°ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ALPHABET = <span class="number">26</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ATO0 = <span class="number">97</span>;</span><br><span class="line">    <span class="keyword">int</span> color;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Trie[] node;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">        node = <span class="keyword">new</span> Trie[ALPHABET];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String words)</span> </span>&#123;</span><br><span class="line">        Trie[] curNode = node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> x : words.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">int</span> index = x - ATO0;</span><br><span class="line">            insert(curNode, index);</span><br><span class="line">            curNode = curNode[index].node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Trie[] curNode, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (curNode[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">            curNode[index] = <span class="keyword">new</span> Trie(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curNode[index].n++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        Trie[] curNode = node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> x : prefix.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">int</span> index = x - ATO0;</span><br><span class="line">            <span class="keyword">if</span> (curNode[index] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            count = curNode[index].n;</span><br><span class="line">            curNode = curNode[index].node;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¦é—®é¢˜æ‰©å±•ä¸ºè¿”å›æ‰€æœ‰ç›¸åŒå‰ç¼€çš„å•è¯ï¼Œé‚£ä¹ˆå°±è¦åœ¨æ’å…¥å­—å…¸æ—¶ï¼Œåœ¨å¯¹åº”å•è¯ç»“å°¾çš„èŠ‚ç‚¹æ ‡è®°é¢œè‰²ã€‚</p><h3 id="æé«˜æ‰©å±•æ€§"><a href="#æé«˜æ‰©å±•æ€§" class="headerlink" title="æé«˜æ‰©å±•æ€§"></a>æé«˜æ‰©å±•æ€§</h3><p>ç”¨å›ºå®šé•¿åº¦ä¸º26çš„æ•°ç»„æ¥å¤„ç†è‹±æ–‡ï¼Œå¥½å¤„æ˜¯æ•°ç»„å†…å­˜å ç”¨å°ï¼Œç´¢å¼•æ—¶ä¹Ÿä¸éœ€è¦æœç´¢ï¼Œç›´æ¥ç”¨å­—ç¬¦ç ä½œä¸ºç´¢å¼•ã€‚ä¹Ÿå¯ä»¥æ ¹æ®ASCIIç è¿›ä¸€æ­¥æ‰©å¤§æ•°ç»„é•¿åº¦ä»¥æ”¯æŒæ›´å¤šå­—ç¬¦ã€‚</p><p>ä¸ºäº†æé«˜å¯æ‰©å±•æ€§ï¼Œå¯ä»¥è€ƒè™‘ç”¨å…¶ä»–æ›´çµæ´»çš„æ•°æ®ç»“æ„æ¥æ›¿ä»£æ•°ç»„ï¼Œæ¯”å¦‚HashMapï¼ŒåŒæ—¶æŠŠHashMapæ”¾è¿›ä¸€ä¸ªTrieNodeç±»ã€‚è¿™æ ·ä»¥åè¦ä¿®æ”¹æ ¸å¿ƒçš„å­˜å‚¨ç»“æ„ï¼Œåªéœ€è¦æ”¹åŠ¨TrieNodeå³å¯ï¼Œå…¶ä½™çš„æ¥å£ä¸ç”¨æ”¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TrieNode node;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.node = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        TrieNode curNode = node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> x : word.toCharArray()) &#123;</span><br><span class="line">            curNode = curNode.set(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        TrieNode curNode = node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> x : prefix.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (curNode.get(x) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            curNode = curNode.get(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curNode.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line">        HashMap&lt;Character, TrieNode&gt; map;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">char</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">(Character val)</span> </span>&#123;</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">this</span>.value = val;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">get</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> map.get(ch);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">set</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">            TrieNode t = map.get(ch);</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">                t = <span class="keyword">new</span> TrieNode(ch);</span><br><span class="line">                <span class="keyword">this</span>.map.put(ch, t);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                t.count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.count;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>HashMapçš„å¯»å€è™½ç„¶ä¼šé å­—ç¬¦ç ä½œä¸ºåœ°å€çš„æ•°ç»„æ…¢ä¸€ç‚¹ç‚¹ï¼Œä½†ä¹Ÿæ˜¯éå¸¸å¿«çš„:$O(\log N)$ã€‚ä½†HashMapæœ¬èº«æ˜¯æ¯”è¾ƒè€—å†…å­˜çš„æ•°æ®ç»“æ„, æ‰€ä»¥å¦‚æœçŸ¥é“è¦å¤„ç†çš„æ•°æ®æ˜¯åœ¨ç‰¹å®šèŒƒå›´å†…çš„, æ¯”å¦‚èŠ‚ç‚¹å°±æ˜¯åœ¨256ä¸ªå­—ç¬¦ä¸­, é‚£ä¹ˆè¿˜æ˜¯ä¸è¦ä¸ç”¨HashMap.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Trie ä¹Ÿç§°å­—å…¸æ ‘ï¼Œåç§°æ¥æºäºRe&lt;font color=&quot;red&quot;&gt;trie&lt;/font&gt;valï¼Œæ”¯æŒ$O(n)$æ’å…¥å’ŒæŸ¥è¯¢æ“ä½œï¼Œä»¥ç©ºé—´æ¢å–æ—¶é—´çš„æ•°æ®ç»“æ„. ç”¨äºè¯é¢‘ç»Ÿè®¡å’Œè¾“å…¥ç»Ÿè®¡é¢†åŸŸ, å¯ä»¥é«˜æ•ˆåœ°å­˜å‚¨å¤§è§„æ¨¡çš„å­—å…¸æ•°æ®, ä¹Ÿå¯ä»¥ç”¨äºæ¨¡ç³ŠåŒ¹é…, æœç´¢æœ€é•¿å‰ç¼€è¯ç­‰.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A &lt;strong&gt;trie&lt;/strong&gt;, also called &lt;strong&gt;digital tre&lt;/strong&gt;e, &lt;strong&gt;radix tree&lt;/strong&gt; or &lt;strong&gt;prefix tree&lt;/strong&gt; is a kind of search tree - an ordered tree data structure used to store a dynamic set or associative array where the keys are usually strings. Unlike a binary search tree, no node in the tree stores the key associated with that node; instead, its position in the tree defines the key with which it is associated. All the descendants of a node have a common prefix of the string associated with that node, and the root is associated with the empty string. Keys tend to be associated with leaves, though some inner nodes may correspond to keys of interest. Hence, keys are not necessarily associated with every node.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Trie" scheme="http://shukebeta.me/tags/Trie/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 02 - å­—ç¬¦æœç´¢åŒ¹é…ç®—æ³• 02 - Boyer-Moore(BM) å’Œ Rabin-Karp(RK)</title>
    <link href="http://shukebeta.me/NLP-02-string-searching-algorithm-02-bm-rk/"/>
    <id>http://shukebeta.me/NLP-02-string-searching-algorithm-02-bm-rk/</id>
    <published>2018-09-26T16:00:00.000Z</published>
    <updated>2018-10-07T07:44:44.008Z</updated>
    
    <content type="html"><![CDATA[<p>å­—ç¬¦ä¸²æœç´¢/åŒ¹é…ç®—æ³•ä¸­, Boyer-Moore(BM)æ¯”å‰é¢çš„<a href="/NLP-01-string-searching-algorithm-kmp">Knuthâ€“Morrisâ€“Pratt(KMP)</a>æ›´é«˜æ•ˆ. BMç®—æ³•ä»å³åˆ°å·¦æ‰«ææ¨¡å¼ä¸­çš„å­—ç¬¦ã€‚å½“åŒ¹é…çš„å­—ç¬¦åœ¨æ¨¡å¼ä¸­ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥è·³è¿‡æœ€å¤šè¾¾Mä¸ªå­—ç¬¦.<img src="/images/bm.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br><a id="more"></a></p><h2 id="BM"><a href="#BM" class="headerlink" title="BM"></a>BM</h2><p>åœ¨å†³å®šè¦è·³è¿‡å¤šå°‘å­—ç¬¦æ—¶, åˆ†å‡ ç§æƒ…å†µè€ƒè™‘:<br>1, mismatch character <code>T</code> not in pattern: increment <code>i</code> one character beyond <code>T</code><br>2.1, Mismatch character in pattern: mismatch character <code>N</code> in pattern, align text <code>N</code> with rightmost pattern <code>N</code><br>2.2, Mismatch character in pattern (but heuristic no help): mismatch character <code>E</code> in pattern, align text <code>E</code> with rightmost pattern <code>E</code>? è¿˜æ˜¯ increment i by 1? æ— æ³•ç¡®å®š, éœ€è¦è¾…åŠ©ä¿¡æ¯.</p><p>éœ€è¦é¢„å…ˆè®¡ç®—æ¨¡å¼å„ä¸ªå­—ç¬¦åœ¨æ¨¡å¼æœ€å³è¾¹å‡ºç°çš„ç´¢å¼•(è‹¥æ— åˆ™<code>-1</code>):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">right = <span class="keyword">new</span> <span class="keyword">int</span>[R];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; R; c++)</span><br><span class="line">right[c] = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</span><br><span class="line">right[pat.charAt(j)] = j;</span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String txt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> N = txt.length();</span><br><span class="line"><span class="keyword">int</span> M = pat.length();</span><br><span class="line"><span class="keyword">int</span> skip;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N-M; i += skip)</span><br><span class="line">&#123;</span><br><span class="line">skip = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = M-<span class="number">1</span>; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pat.charAt(j) != txt.charAt(i+j))</span><br><span class="line">&#123;</span><br><span class="line">skip = Math.max(<span class="number">1</span>, j - right[txt.charAt(i+j)]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (skip == <span class="number">0</span>) <span class="keyword">return</span> i; <span class="comment">// match</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> N;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Substring search with the Boyer-Moore mismatched character heuristic takes about <code>~ N / M</code> character compares to search for a pattern of length <code>M</code> in a text of length <code>N</code>.<br>Worst-case. Can be as bad as <code>~ M N</code>.</p></blockquote><p>Boyer-Mooreå˜ç§: é€šè¿‡æ·»åŠ ç±»ä¼¼KMPçš„è§„åˆ™æ¥é˜²æ­¢é‡å¤æ¨¡å¼ï¼Œå¯ä»¥å°†æœ€åæƒ…å†µæ”¹å–„ä¸º<code>~3 N</code>å­—ç¬¦æ¯”è¾ƒã€‚</p><h2 id="RK"><a href="#RK" class="headerlink" title="RK"></a>RK</h2><p>Rabin-Karp åŸºäº modular hashingï¼š<br>ãƒ»Compute a hash of pattern characters <code>0</code> to <code>M - 1</code>.<br>ãƒ»For each <code>i</code>, compute a hash of text characters <code>i</code> to <code>M + i - 1</code>.<br>ãƒ»If pattern hash = text substring hash, check for a match.</p><p>æ‰€ä»¥ç®—æ³•çš„å…³é”®åœ¨äºå¦‚ä½•é«˜æ•ˆåœ°è®¡ç®—å“ˆå¸Œå€¼ï¼šHornerâ€™s method - ç”¨äºè¯„ä¼°Mé˜¶å¤šé¡¹å¼çš„çº¿æ€§æ—¶é—´æ–¹æ³•<br><img src="/images/horner_method.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Compute hash for M-digit key</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">hash</span><span class="params">(String key, <span class="keyword">int</span> M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">long</span> h = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</span><br><span class="line">h = (R * h + key.charAt(j)) % Q;</span><br><span class="line"><span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç»™å®š$x_i$ï¼Œå¦‚ä½•è®¡ç®—$x_{i+1}$ï¼š<br>$$x_i = t_i R^{M-1} + T_{i+1}R^{M-2} + â€¦ + t_{i+M-1}R^0$$<br>$$x_{i+1} = t_{i+1}R^{M-1} + T_{i+2}R^{M-2} + â€¦ + t_{i+M}R^0$$<br>$$x_{i+1} = (x_i - t_i R^{M-1}) R + t_{i+M}$$<br>M-digit, base-R integer, modulo Qï¼Œ$R^{M-1}$æ˜¯å¯ä»¥é¢„å…ˆè®¡ç®—çš„.<br><img src="/images/rk.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabinKarp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> patHash; <span class="comment">// pattern hash value</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> M; <span class="comment">// pattern length</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> Q; <span class="comment">// modulus</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> R; <span class="comment">// radix</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> RM; <span class="comment">// R^(M-1) % Q</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RabinKarp</span><span class="params">(String pat)</span> </span>&#123;</span><br><span class="line">M = pat.length();</span><br><span class="line">R = <span class="number">256</span>;</span><br><span class="line">Q = longRandomPrime(); <span class="comment">// a large prime (but avoid overflow)</span></span><br><span class="line"></span><br><span class="line">RM = <span class="number">1</span>; <span class="comment">// precompute R^&#123;M â€“ 1&#125; (mod Q)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= M-<span class="number">1</span>; i++)</span><br><span class="line">RM = (R * RM) % Q;</span><br><span class="line">patHash = hash(pat, M);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">hash</span><span class="params">(String key, <span class="keyword">int</span> M)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="comment">/* as before */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** check for hash collision using rolling hash function */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String txt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> N = txt.length();</span><br><span class="line"><span class="keyword">int</span> txtHash = hash(txt, M);</span><br><span class="line"><span class="keyword">if</span> (patHash == txtHash) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = M; i &lt; N; i++)</span><br><span class="line">&#123;</span><br><span class="line">txtHash = (txtHash + Q - RM*txt.charAt(i-M) % Q) % Q;</span><br><span class="line">txtHash = (txtHash*R + txt.charAt(i)) % Q;</span><br><span class="line"><span class="keyword">if</span> (patHash == txtHash) <span class="keyword">return</span> i - M + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> N;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ‰ä¸¤ç§æ–¹å¼åˆ¤æ–­æ˜¯å¦åŒ¹é…ï¼š</p><ul><li>Monte Carlo version. Return match if hash match.<ul><li>Always runs in linear time. Extremely likely to return correct answer (but not always!).</li></ul></li><li>Las Vegas version. Check for substring match if hash match; continue search if false collision.<ul><li>Always returns correct answer. Extremely likely to run in linear time (but worst case is M N).</li></ul></li></ul><blockquote><p>In theory, if <code>Q</code> is a sufficiently large random prime (about $M N^2$), then the probability of a false collision is about <code>1 / N</code>.<br>In practice, choose <code>Q</code> to be a large prime (but not so large to cause overflow). Under reasonable assumptions, probability of a collision is about <code>1 / Q</code>.</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="/images/substring_search_cost_summary.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br>ç®—æ³•å¯ä»¥æ‹“å±•åˆ°äºŒç»´æ¨¡å¼åŒ¹é…, å¤šæ¨¡å¼åŒ¹é…ç­‰é—®é¢˜.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­—ç¬¦ä¸²æœç´¢/åŒ¹é…ç®—æ³•ä¸­, Boyer-Moore(BM)æ¯”å‰é¢çš„&lt;a href=&quot;/NLP-01-string-searching-algorithm-kmp&quot;&gt;Knuthâ€“Morrisâ€“Pratt(KMP)&lt;/a&gt;æ›´é«˜æ•ˆ. BMç®—æ³•ä»å³åˆ°å·¦æ‰«ææ¨¡å¼ä¸­çš„å­—ç¬¦ã€‚å½“åŒ¹é…çš„å­—ç¬¦åœ¨æ¨¡å¼ä¸­ä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥è·³è¿‡æœ€å¤šè¾¾Mä¸ªå­—ç¬¦.&lt;img src=&quot;/images/bm.png&quot; alt=&quot;&quot; title=&quot;image from: https://www.coursera.org/learn/algorithms-part2/&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Boyer-Moore" scheme="http://shukebeta.me/tags/Boyer-Moore/"/>
    
  </entry>
  
  <entry>
    <title>ä½æ“ä½œ - å¿«é€Ÿå¹‚</title>
    <link href="http://shukebeta.me/bits-operations-07/"/>
    <id>http://shukebeta.me/bits-operations-07/</id>
    <published>2018-09-25T16:00:00.000Z</published>
    <updated>2018-10-22T09:18:06.806Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚ä½•å®ç°å¿«é€Ÿçš„å¹‚è¿ç®—ï¼Ÿ<br><a id="more"></a></p><p>è¦æ±‚$c = a^b$, æŒ‰ç…§æœ´ç´ ç®—æ³•æŠŠ<code>a</code>è¿ä¹˜<code>b</code>æ¬¡çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$. è€Œå¿«é€Ÿå¹‚èƒ½åšåˆ°$O(\log n)$ã€‚æŠŠ<code>b</code>è½¬æ¢ä¸ºäºŒè¿›åˆ¶, äºŒè¿›åˆ¶æ•°ç¬¬<code>i</code>ä½çš„æƒä¸º$2^{i-1}$ï¼Œå°±å¯ä»¥æŠŠäºŒè¿›åˆ¶æ‹†åˆ†ä¸ºè‹¥å¹²ä¸ªä»¥<code>2</code>ä¸ºåº•çš„çœŸæ•°, ç„¶ååˆ©ç”¨å¹‚æ•°çš„æ€§è´¨ï¼Œä¾‹å¦‚ç”¨æœ´ç´ ç®—æ³•æ±‚$a^{11}$è¦æ±‚ä¹˜<code>11</code>æ¬¡. è€ƒè™‘åˆ°<code>11</code>çš„äºŒè¿›åˆ¶ä¸º<code>1011</code>, å¦‚æœæŠŠ$a^{11}$æ‹†åˆ†ä¸º:<br>$$a^{11} = a^{a_0 2^0 + a_1 2^1 + a_2 0 + a_3 2^3} = a^1 a^2 a^8$$<br>å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªå› å­éƒ½æ˜¯ä¸Šä¸€ä¸ªå› å­çš„å¹³æ–¹ï¼Œåˆ©ç”¨$a^2 a^2$æ±‚å‡º$a^4$, åŒæ ·åˆ©ç”¨$a^4$çš„å¹³æ–¹æ±‚å‡º$a^8$, æ¯æ¬¡è®¡ç®—åªéœ€è¦ç”¨åˆ°ä¸Šä¸€æ¬¡è®¡ç®—å‡ºæ¥çš„ç»“æœ, æ‰€ä»¥æ€»çš„è¿ç®—æ¬¡æ•°æ˜¯<code>4</code>æ¬¡. ä»»ä½•ä¸€ä¸ªæ•°<code>b</code>æœ€å¤šèƒ½å†™æˆé•¿åº¦ä¸º$O(\log b)$çš„äºŒè¿›åˆ¶, å› æ­¤è¿™ä¸ªç®—æ³•å°±æ˜¯$O(\log n)$.</p><p>åœ¨ç¨‹åºè®¾è®¡ä¸­æ˜¯æ ¹æ®<code>b</code>çš„äºŒè¿›åˆ¶ä¸­æ˜¯å¦ä¸º<code>1</code>æ¥æ§åˆ¶æ˜¯å¦ä¹˜ä»¥ä¸Šä¸€æ¬¡ç¿»å€çš„ç§¯</p><ul><li>ä¸æ–­å³ç§»<code>b</code>, ç›´åˆ°<code>b</code>ä¸å†æœ‰<code>1</code>ï¼š<ul><li>æ ¹æ®å½“å‰ä½çš„æƒé‡ï¼ˆå½“å‰<code>b</code>æœ€åä¸€ä½ï¼‰æ˜¯å¦ä¸º<code>1</code>æ¥å†³å®š<code>c</code>æ˜¯å¦ä¹˜ä»¥æœ€æ–°çš„<code>a</code></li><li>æŠŠ<code>a</code>å¹³æ–¹ï¼Œç”¨äºä¸‹ä¸€ä½è®¡ç®—</li></ul></li></ul><p>åœ¨Javaä¸­è¦è€ƒè™‘æç«¯å€¼INT_MIN<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">myPow</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> temp = myPow(x, n/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> ==<span class="number">0</span>) <span class="keyword">return</span> temp * temp;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &gt; <span class="number">0</span>) <span class="keyword">return</span> x*temp*temp;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> (temp*temp) / x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾ªç¯</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">myPow</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(n &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        n = -(n+<span class="number">1</span>); <span class="comment">// å¤„ç†æç«¯å€¼</span></span><br><span class="line">        x = <span class="number">1</span>/x;</span><br><span class="line">        ans *= x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">1</span>) ans *= x;</span><br><span class="line">        x *= x;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿå¹‚å–ä½™"><a href="#å¿«é€Ÿå¹‚å–ä½™" class="headerlink" title="å¿«é€Ÿå¹‚å–ä½™"></a>å¿«é€Ÿå¹‚å–ä½™</h3><p>æ±‚<code>a^b mod c</code>.<br>å¦‚æœ<code>b</code>æ˜¯å¶æ•°, <code>a^b mod c</code> = $(a^2)^{b/2} \% c$<br>å¦‚æœ<code>b</code>æ˜¯å¥‡æ•°, <code>a^b mod c</code> = $((a^2)^{b/2} \times a) \% c$</p><p>åˆå› ä¸ºå–ä½™æœ‰æ€§è´¨:<code>a^b mod c = (a mod c)^b</code></p><p>å¼•ç†ï¼š<code>(a * b) mod c = [( a mod c ) * (b mod c) ] mod c</code></p><p>è¯æ˜ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è®¾ a mod c =dï¼Œb mod c= e;</span><br><span class="line">       åˆ™ï¼ša=t*c + d ;  b=k*c + e ;</span><br><span class="line">       (a*b)mod c = (t*c+d)(t*c+e)</span><br><span class="line">                 = (tk c^2 + ( te+dk ) *c + d*e) mod c</span><br><span class="line">                 = de mod c</span><br></pre></td></tr></table></figure></p><p>å³ç§¯çš„å–ä½™ç­‰äºå–ä½™çš„ç§¯çš„å–ä½™.</p><p>åˆ©ç”¨å¿«é€Ÿå¹‚çš„æ€æƒ³, ä»¤<code>k = (a * a) mod c</code>ï¼Œæ‰€è¦æ±‚çš„æœ€ç»ˆç»“æœå³ä¸º <code>k^(b/2) mod c</code>, è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¿­ä»£ä¸‹å», å¦‚æœbæ˜¯å¥‡æ•°, æˆ–å¤šå‡ºä¸€é¡¹<code>a mod c</code>. å½“<code>b = 0</code>æ—¶, æ‰€æœ‰å› å­å·²ç»ç›¸ä¹˜, è¿­ä»£ç»“æŸ, å¤æ‚åº¦ä¸º<code>O(log b)</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span>  <span class="title">PowerMod</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span>  ans = <span class="number">1</span>;</span><br><span class="line">    a = a % c;</span><br><span class="line">    <span class="keyword">while</span>(b&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b % <span class="number">2</span> = = <span class="number">1</span>)</span><br><span class="line">            ans = (ans * a) % c;</span><br><span class="line">        b = b/<span class="number">2</span>;       <span class="comment">//   b&gt;&gt;=1;</span></span><br><span class="line">        a = (a * a) % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚ä½•å®ç°å¿«é€Ÿçš„å¹‚è¿ç®—ï¼Ÿ&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Software Engineer" scheme="http://shukebeta.me/tags/Software-Engineer/"/>
    
      <category term="Algorithms" scheme="http://shukebeta.me/tags/Algorithms/"/>
    
      <category term="Computer Science" scheme="http://shukebeta.me/tags/Computer-Science/"/>
    
  </entry>
  
  <entry>
    <title>NLPä¸ä¿¡æ¯å¤„ç† 01 - å­—ç¬¦æœç´¢åŒ¹é…ç®—æ³• 01 - KMP</title>
    <link href="http://shukebeta.me/NLP-01-string-searching-algorithm-01-kmp/"/>
    <id>http://shukebeta.me/NLP-01-string-searching-algorithm-01-kmp/</id>
    <published>2018-09-25T16:00:00.000Z</published>
    <updated>2018-10-07T07:57:01.029Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>In computer science, string-searching algorithms, sometimes called string-matching algorithms, are an important class of string algorithms that try to find a place where one or several strings (also called patterns) are found within a larger string or text.</p></blockquote><p>å­—ç¬¦ä¸²æœç´¢/åŒ¹é…ç®—æ³•åœ¨å¤§è§„æ¨¡æ–‡æœ¬åº”ç”¨ä¸­æœ‰éå¸¸é‡è¦çš„ä½œç”¨ï¼Œæ¯”å¦‚æ–‡ç« æ•æ„Ÿè¯æœç´¢ï¼Œå¤šå…³é”®è¯è¿‡æ»¤æœç´¢ç­‰ã€‚å¦‚æœä½¿ç”¨æš´åŠ›æœç´¢ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼ˆè‹¥ m ä¸ºå…³é”®å­—çš„é•¿åº¦ï¼Œ n ä¸ºè¦å¾…æœç´¢çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œ kä¸ºå…³é”®å­—æ•°é‡ï¼Œåˆ™å¤æ‚åº¦ä¸º$O(n \times m \times k)$ã€‚è€Œå¥½çš„ç®—æ³•å¯ä»¥è®©è¿™äº›é—®é¢˜çš„æ—¶é—´å¤æ‚åº¦å¤§å¤§é™ä½ã€‚</p><p>å¸¸ç”¨çš„ç®—æ³•æœ‰Knuthâ€“Morrisâ€“Pratt(KMP), Boyer-Moore(BM), Rabin-Karp(RK), Trie, Trieå›¾, ACè‡ªåŠ¨æœºç­‰.<br><a id="more"></a></p><h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><p>Knuthâ€“Morrisâ€“Pratt ç®—æ³•åœ¨æ¯æ¬¡æœç´¢åŒ¹é…å‰ï¼Œé¢„å¤„ç†æ¨¡å¼å­—ç¬¦ä¸²ï¼Œè®°å½•æ¨¡å¼å­—ç¬¦ä¸²è‡ªèº«é‡å¤çš„æƒ…å†µï¼Œå³åŒ…å«å·¦ä¸´ç•Œçš„å­å­—ç¬¦ä¸²å’ŒåŒ…å«å³ä¸´ç•Œçš„å­å­—ç¬¦ä¸²çš„é‡å¤é•¿åº¦ï¼Œä»¥æ­¤æ¥ä½œä¸ºåç»­åŒ¹é…çš„å‚è€ƒã€‚å½“å®é™…å»åŒ¹é…å¸¦æœç´¢å­—ç¬¦ä¸²æ—¶ï¼Œæƒ³è±¡æ˜¯æˆ‘ä»¬æ‹¿ç€æ¨¡å¼å­—ç¬¦ä¸²ä»å·¦åˆ°å³åŒ¹é…è¿‡å»ã€‚ä»»ä½•æ—¶å€™ï¼Œå¦‚æœå‘ç°åŒ¹é…ä¸ä¸Šçš„æ—¶ï¼Œä¸æ˜¯ç®€å•åœ°å³ç§»ä¸€ä½ç»§ç»­é‡æ–°åŒ¹é…ï¼Œè€Œæ˜¯åœ¨å·²åŒ¹é…éƒ¨åˆ†çš„èŒƒå›´å†…ï¼Œç›´æ¥è·³è¿‡kä¸ªå­—ç¬¦ï¼Œå³ç§»åˆ°ä¸æ¨¡å¼å¼€å¤´éƒ¨åˆ†é‡å¤çš„ä½ç½®ï¼Œå¹¶æ¥ç€é‡å¤éƒ¨åˆ†åé¢ç»§ç»­å¼€å§‹åŒ¹é…ï¼ˆé‡å¤çš„éƒ¨åˆ†è¯æ˜å·²ç»åŒ¹é…è¿‡ï¼‰ã€‚</p><p>ä¸€ä¸ªå¾ˆå¥½è§£é‡Š<a href="https://blog.csdn.net/v_july_v/article/details/7041827" target="_blank" rel="noopener">å‚è€ƒ</a><br><img src="/images/kmp1.png" alt=""><img src="/images/kmp2.png" alt="" title="https://blog.csdn.net/v_july_v/article/details/7041827"><br>KMPç®—æ³•çš„ç†è®ºåŸºç¡€åŸºäºç¡®å®šæ€§æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº DFAï¼ˆDeterministic finite state automatonï¼‰ã€‚DFAå¯ä»¥ç†è§£ä¸ºæŠ½è±¡çš„å­—ç¬¦æœç´¢æœºï¼š</p><ul><li>æœ‰é™æ•°é‡çš„<strong>çŠ¶æ€</strong>ï¼ˆåŒ…æ‹¬å¼€å§‹å’Œåœæ­¢ï¼‰ã€‚</li><li>å­—æ¯è¡¨æ¯ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªçŠ¶æ€è½¬æ¢ã€‚</li><li>åªæ¥å—èƒ½é€šå¾€åœæ­¢çŠ¶æ€çš„è½¬æ¢åºåˆ—ã€‚</li></ul><p><img src="/images/kmp_dfa.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br>å¦‚<code>ABCAABABABAB</code>å¯¹åº”<code>0â†’1â†’2â†’0â†’1â†’1â†’2â†’3â†’4â†’5â†’4â†’5â†’4</code></p><p>å¯ä»¥çœ‹å‡ºKMPç®—æ³•çš„å‡ ä¸ªè¦ç‚¹:</p><ul><li>çŠ¶æ€State: è¡¨ç¤ºæ¨¡å¼ä¸­å·²åŒ¹é…çš„å­—ç¬¦æ•°ã€‚<code>pattern[]</code>æœ€é•¿å‰ç¼€(åŒæ—¶æ˜¯<code>txt[0..i]</code>çš„åç¼€)çš„é•¿åº¦.</li><li>éœ€è¦é¢„å…ˆä»<code>pattern</code>ä¸­è®¡ç®—<code>dfa[][]</code></li><li>å­—ç¬¦ä¸²éå†æŒ‡é’ˆåªä¼šå‰è¿›ä¸ä¼šåé€€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String txt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i, j, N = txt.length();</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; N &amp;&amp; j &lt; M; i++)</span><br><span class="line">j = dfa[txt.charAt(i)][j];</span><br><span class="line"><span class="keyword">if</span> (j == M) <span class="keyword">return</span> i - M;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> N;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Running time: at most N character accesses to Simulate DFA on text.</p><h3 id="ä½¿ç”¨DFA"><a href="#ä½¿ç”¨DFA" class="headerlink" title="ä½¿ç”¨DFA"></a>ä½¿ç”¨DFA</h3><p>ç”¨çŠ¶æ€<code>state j</code>è¡¨ç¤ºæ¨¡å¼<code>pat</code>çš„å‰<code>j</code>ä¸ªå­—ç¬¦å·²ç»åŒ¹é…. ç”¨<code>dfa[c][j]</code>è¡¨ç¤ºåœ¨çŠ¶æ€<code>state j</code>æ—¶, é‡åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦<code>c</code>, åº”è¯¥è½¬ç§»åˆ°ä»€ä¹ˆçŠ¶æ€.</p><p>åœ¨çŠ¶æ€<code>state j</code>ï¼š<br>Â· å¦‚æœåŒ¹é…æˆåŠŸï¼Œ<code>char c == pat.charAt(j)</code>ï¼Œåˆ™è½¬ç§»åˆ°<code>state j+1</code>: <code>dfa[pat.charAt(j)][j] = j+1</code>.<br>Â· å¦‚æœå¤±è´¥ï¼Œåˆ™ä»<code>pat[1..j-1]</code>å¯¹åº”çš„DFAçŠ¶æ€<code>X</code>ï¼Œå‘ç€<code>c</code>æ–¹å‘è½¬ç§»ï¼š<code>copy dfa[][X] to dfa[][j]</code>.<br>ãƒ»Update <code>X</code>.<br><img src="/images/build_dfa.png" alt="" title="image from: https://www.coursera.org/learn/algorithms-part2/"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">KMP</span><span class="params">(String pat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.pat = pat;</span><br><span class="line">M = pat.length();</span><br><span class="line">dfa = <span class="keyword">new</span> <span class="keyword">int</span>[R][M];</span><br><span class="line">dfa[pat.charAt(<span class="number">0</span>)][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> X = <span class="number">0</span>, j = <span class="number">1</span>; j &lt; M; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; R; c++)</span><br><span class="line">dfa[c][j] = dfa[c][X]; <span class="comment">// copy mismatch cases</span></span><br><span class="line">dfa[pat.charAt(j)][j] = j+<span class="number">1</span>;</span><br><span class="line">X = dfa[pat.charAt(j)][X];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Running time. M character accesses (but space/time proportional to R M).</p><h3 id="NEXTæ•°ç»„"><a href="#NEXTæ•°ç»„" class="headerlink" title="NEXTæ•°ç»„"></a>NEXTæ•°ç»„</h3><p>å‡è®¾ç°åœ¨æ–‡æœ¬ä¸²<code>S</code>åŒ¹é…åˆ°<code>i</code>ä½ç½®ï¼Œæ¨¡å¼ä¸²<code>P</code>åŒ¹é…åˆ°<code>j</code>ä½ç½®:<br><img src="https://img-blog.csdn.net/20140812223633281" alt="" title="image from: https://blog.csdn.net/v_july_v/article/details/7041827"><br>é¦–å…ˆç¬¬ä¸€ä½NEXTå€¼<code>next[0]</code>ä¸€å®šæ˜¯<code>-1</code>, åé¢çš„ç¬¬<code>j+1</code>ä¸ªå€¼<code>next[j]</code>ä»£è¡¨<code>[0, j-1]</code>éƒ¨åˆ†æœ‰å¤šå°‘é‡å¤å‰åç¼€. å¯ä»¥æ ¹æ®å‰ä¸€ä½çš„<code>next[j-1]</code>å€¼<code>k</code>æ¨æ–­:</p><ul><li>å¦‚æœ<code>P[j] == P[k]</code>, åˆ™æ„å‘³ç€é‡å¤å‰åç¼€é•¿åº¦<code>+1</code>, é‚£ä¹ˆ<code>next[j] = next[j-1] + 1 = k + 1</code>.</li><li>å¦‚æœ<code>P[j] != P[k]</code>, åˆ™æ„å‘³ç€å‰é¢é‡å¤å‰åç¼€æ— æ³•ç»§ç»­ä¸‹å». æ­¤æ—¶ä¸èƒ½ç®€å•åœ°åˆ¤å®š<code>next[j] = 0</code>, éœ€è¦ç»§ç»­å¾€å‰çœ‹æ˜¯å¦æœ‰æ›´çŸ­å°çš„é‡å¤å‰åç¼€. åˆå› ä¸ºé‡å¤å‰åç¼€æ„å‘³ç€å‰åç«¯ç›¸åŒ, å› æ­¤å¯ä»¥ç›´æ¥åŒ¹é…<code>P[j] ?= P[k&#39;], k&#39; = next[k]</code>, ä»¥æ­¤å¾ªç¯ä¸‹å»ç›´åˆ°<code>k&#39; = -1</code>ä¸ºæ­¢.</li></ul><p>ä»¥ä¸Šç®—æ³•è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–: å½“<code>P[j] != S[i]</code>æ—¶ï¼Œä¸‹æ¬¡å¿…ç„¶åŒ¹é…<code>P[next [j]] ?= S[i]</code>ï¼Œæ­¤æ—¶å¦‚æœ<code>P[j] == P[next[j]]</code>ï¼Œåˆ™æ„å‘³ç€åŒ¹é…å¿…ç„¶å¤±è´¥. è¿™æ ·å°±å‡ºç°äº†å†—ä½™åŒ¹é…ã€‚æ‰€ä»¥å¦‚æœå‡ºç°<code>P[j] == P[next[j]]</code>ï¼Œåˆ™ä»¤<code>next[j] = next[next[j]] = next[next[j-1] + 1] = next[k + 1]</code>.<img src="http://hi.csdn.net/attachment/201106/14/8394323_13080758591kyV.jpg" alt="" title="image from: https://blog.csdn.net/v_july_v/article/details/7041827"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetNext</span><span class="params">(<span class="keyword">char</span>[] p, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> k = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> j = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (j &lt; p.length - <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">//p[k]è¡¨ç¤ºå‰ç¼€ï¼Œp[j]è¡¨ç¤ºåç¼€</span></span><br><span class="line"><span class="keyword">if</span> (k == -<span class="number">1</span> || p[j] == p[k]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p[++j] != p[++k])</span><br><span class="line">                next[j] = k;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">next[j] = next[k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">k = next[k];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>å¯¹äºä¼˜åŒ–åçš„nextæ•°ç»„å¯ä»¥å‘ç°ä¸€ç‚¹ï¼šå¦‚æœæ¨¡å¼ä¸²çš„åç¼€è·Ÿå‰ç¼€ç›¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬çš„nextå€¼ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œä¾‹å¦‚æ¨¡å¼ä¸²abcabcï¼Œå®ƒçš„å‰ç¼€åç¼€éƒ½æ˜¯abcï¼Œå…¶ä¼˜åŒ–åçš„nextæ•°ç»„ä¸ºï¼š-1 0 0 -1 0 0ï¼Œå‰ç¼€åç¼€abcçš„nextå€¼éƒ½ä¸º-1 0 0.</p></blockquote><h3 id="åŸºäºNEXTæ•°ç»„çš„KMPç®—æ³•"><a href="#åŸºäºNEXTæ•°ç»„çš„KMPç®—æ³•" class="headerlink" title="åŸºäºNEXTæ•°ç»„çš„KMPç®—æ³•"></a>åŸºäºNEXTæ•°ç»„çš„KMPç®—æ³•</h3><p>åŸºäºå‰é¢æ±‚å‡ºçš„NEXTæ•°ç»„, å¯ä»¥æ ¹æ®ä»¥ä¸‹æ­¥éª¤å®ç°KMPç®—æ³•:</p><ul><li>å‡è®¾ç°åœ¨æ–‡æœ¬ä¸²<code>S</code>åŒ¹é…åˆ°<code>i</code>ä½ç½®ï¼Œæ¨¡å¼ä¸²<code>P</code>åŒ¹é…åˆ°<code>j</code>ä½ç½®<ul><li>if <code>j = -1</code>, or <code>S[i] == P[j]</code>(å½“å‰å­—ç¬¦åŒ¹é…æˆåŠŸ), then <code>i++, j++</code></li><li>else, <code>j = next[j]</code>ã€‚å½“å¤±é…æ—¶ï¼Œæ¨¡å¼ä¸²<code>P</code>ç›¸å¯¹äºæ–‡æœ¬ä¸²<code>S</code>å‘å³ç§»åŠ¨<code>j - next[j]</code>ä½(å¤§äºç­‰äº1)ã€‚</li></ul></li></ul><p><img src="https://img-blog.csdn.net/20150812214857858" alt="" title="image from: https://img-blog.csdn.net/20150812214857858"><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** è¿”å›æ¨¡å¼ä¸²ç¬¬ä¸€æ¬¡åœ¨æ–‡æœ¬ä¸²ä¸­å‡ºç°çš„ä½ç½® */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">KmpSearch</span><span class="params">(<span class="keyword">char</span>[] s, <span class="keyword">char</span>[] p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; s.length &amp;&amp; j &lt; p.length) &#123;</span><br><span class="line"><span class="keyword">if</span> (j == -<span class="number">1</span> || s[i] == p[j]) &#123;</span><br><span class="line">i++;</span><br><span class="line">j++;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">j = next[j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (j == p.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> i - j;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="KMPåº”ç”¨"><a href="#KMPåº”ç”¨" class="headerlink" title="KMPåº”ç”¨"></a>KMPåº”ç”¨</h3><p>åˆ¤æ–­ä¸€æ®µæ–‡å­—ï¼ˆåŸä¸²ï¼‰é‡Œé¢æ˜¯å¦å­˜åœ¨æ•æ„Ÿè¯ï¼ˆæ¨¡å¼ä¸²ï¼‰ã€‚åŸé¢˜åœ°å€ <a href="http://hihocoder.com/problemset/problem/1015?sid=1368409ï¼š" target="_blank" rel="noopener">http://hihocoder.com/problemset/problem/1015?sid=1368409ï¼š</a></p><p>è¾“å…¥ï¼šç¬¬ä¸€è¡Œä¸€ä¸ªæ•´æ•°Nï¼Œè¡¨ç¤ºæµ‹è¯•æ•°æ®ç»„æ•°ã€‚æ¥ä¸‹æ¥çš„N*2è¡Œï¼Œæ¯ä¸¤è¡Œè¡¨ç¤ºä¸€ä¸ªæµ‹è¯•æ•°æ®ã€‚åœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ•°æ®ä¸­ï¼Œç¬¬ä¸€è¡Œä¸ºæ¨¡å¼ä¸²ï¼Œç”±ä¸è¶…è¿‡10^4ä¸ªå¤§å†™å­—æ¯ç»„æˆï¼Œç¬¬äºŒè¡Œä¸ºåŸä¸²ï¼Œç”±ä¸è¶…è¿‡10^6ä¸ªå¤§å†™å­—æ¯ç»„æˆã€‚å…¶ä¸­N&lt;=20.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">HA</span><br><span class="line">HAHAHA</span><br><span class="line">WQN</span><br><span class="line">WQN</span><br><span class="line">ADA</span><br><span class="line">ADADADA</span><br><span class="line">BABABB</span><br><span class="line">BABABABABABABABABB</span><br><span class="line">DAD</span><br><span class="line">ADDAADAADDAAADAAD</span><br></pre></td></tr></table></figure></p><p>è¾“å‡º: å¯¹äºæ¯ä¸€ä¸ªæµ‹è¯•æ•°æ®ï¼ŒæŒ‰ç…§å®ƒä»¬åœ¨è¾“å…¥ä¸­å‡ºç°çš„é¡ºåºè¾“å‡ºä¸€è¡ŒAnsï¼Œè¡¨ç¤ºæ¨¡å¼ä¸²åœ¨åŸä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæ˜¯éœ€è¦æ‰¾å‡ºå‡ºç°çš„æ¬¡æ•°ï¼Œå› æ­¤ä¸ä»…ä»…æ˜¯æ‰¾åˆ°ç¬¬ä¸€ä¸ªï¼Œè¿˜è¦ç»§ç»­éå†åŸä¸²ç»Ÿè®¡å‰©ä½™å‡ºç°çš„æ¬¡æ•°ï¼ŒåŒæ—¶è¦è€ƒè™‘é‡å çš„éƒ¨åˆ†ã€‚å…³é”®çš„åŠŸèƒ½ä»£ç å¯ä»¥å¤åˆ¶ä¸Šé¢çš„ï¼Œä½†æ˜¯éœ€è¦ä½œå‡ºä¸€äº›æ”¹åŠ¨ã€‚</p><p>é¦–å…ˆï¼Œå› ä¸ºéƒ¨åˆ†é‡å æƒ…å†µä¹Ÿæ˜¯è¦ç»Ÿè®¡çš„ï¼Œæ¯”å¦‚<code>ADADADA</code>è¿™ä¸ªåŸä¸², åŒ…å«3ä¸ª<code>ADA</code>. æ‰€ä»¥è¦è€ƒè™‘å³ä½¿åŒ¹é…æˆåŠŸå, æ¨¡å¼ä¸²çš„ç´¢å¼•<code>j</code>èƒ½å¤Ÿè·³å›å‰é¢çš„é‡å¤å‰ç¼€ä½ç½®. è€ƒè™‘ä½¿ç”¨æœªä¼˜åŒ–è¿‡çš„NEXTè®¡ç®—æ–¹æ³•.</p><p>é™¤æ­¤ä¹‹å¤–, é€šè¿‡é¢å¤–è®¡ç®—å¤šä¸€ä½NEXTå€¼, è®°å½•å®Œæ•´çš„æ¨¡å¼ä¸²çš„é‡å¤å‰åç¼€é•¿åº¦, ä»¥ååŠ©ç´¢å¼•.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GetNext</span><span class="params">(<span class="keyword">char</span>[] p, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">    next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (j &lt; p.length) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k == -<span class="number">1</span> || p[j] == p[k]) &#123;</span><br><span class="line">            next[++j] = ++k;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            k = next[k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯¹äº<code>ADA</code>, åŸæ¥æœªä¼˜åŒ–è¿‡çš„NEXTæ˜¯<code>-1,0,0</code>, ç°åœ¨æ˜¯<code>-1,0,0,1</code>, æœ€åä¸€ä½<code>1</code>è¡¨ç¤º<code>ADA</code>è¿™ä¸ªæ¨¡å¼ä¸²çš„é‡å¤å‰åç¼€æ˜¯é•¿åº¦ä¸º<code>1</code>çš„<code>A</code>.</p><p>å€ŸåŠ©é¢å¤–é•¿åº¦çš„NEXT, åªéœ€è¦å°å°åœ°æ”¹åŠ¨KMPè®¡ç®—é€»è¾‘, æœ€é‡è¦çš„æ˜¯å½“<code>j</code>åˆ°è¾¾<code>NEXT</code>çš„é¢å¤–ä½ç½®æ—¶, é€šè¿‡<code>j = next[j];</code>æŠŠ<code>j</code>åæ‹¨åˆ°é‡å¤å‰ç¼€çš„ä½ç½®, ä»¥æ–¹ä¾¿è¿›è¡Œåé¢çš„æœç´¢.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** è¿”å›æ¨¡å¼ä¸²åœ¨åŸä¸²ä¸­å‡ºç°çš„æ¬¡æ•° */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">KmpSearch</span><span class="params">(<span class="keyword">char</span>[] s, <span class="keyword">char</span>[] p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[p.length + <span class="number">1</span>]; <span class="comment">// é¢å¤–å¤šè®¡ç®—ä¸€ä½</span></span><br><span class="line">    GetNext(p, next);</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">0</span>, i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = s.length;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == -<span class="number">1</span> || s[i] == p[j]) &#123;</span><br><span class="line">            i++; j++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j = next[j];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (j == p.length) &#123;</span><br><span class="line">            c++;</span><br><span class="line">            j = next[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;In computer science, string-searching algorithms, sometimes called string-matching algorithms, are an important class of string algorithms that try to find a place where one or several strings (also called patterns) are found within a larger string or text.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å­—ç¬¦ä¸²æœç´¢/åŒ¹é…ç®—æ³•åœ¨å¤§è§„æ¨¡æ–‡æœ¬åº”ç”¨ä¸­æœ‰éå¸¸é‡è¦çš„ä½œç”¨ï¼Œæ¯”å¦‚æ–‡ç« æ•æ„Ÿè¯æœç´¢ï¼Œå¤šå…³é”®è¯è¿‡æ»¤æœç´¢ç­‰ã€‚å¦‚æœä½¿ç”¨æš´åŠ›æœç´¢ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦å¾ˆé«˜ï¼ˆè‹¥ m ä¸ºå…³é”®å­—çš„é•¿åº¦ï¼Œ n ä¸ºè¦å¾…æœç´¢çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œ kä¸ºå…³é”®å­—æ•°é‡ï¼Œåˆ™å¤æ‚åº¦ä¸º$O(n \times m \times k)$ã€‚è€Œå¥½çš„ç®—æ³•å¯ä»¥è®©è¿™äº›é—®é¢˜çš„æ—¶é—´å¤æ‚åº¦å¤§å¤§é™ä½ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸ç”¨çš„ç®—æ³•æœ‰Knuthâ€“Morrisâ€“Pratt(KMP), Boyer-Moore(BM), Rabin-Karp(RK), Trie, Trieå›¾, ACè‡ªåŠ¨æœºç­‰.&lt;br&gt;
    
    </summary>
    
      <category term="AI" scheme="http://shukebeta.me/categories/AI/"/>
    
      <category term="NLP" scheme="http://shukebeta.me/categories/AI/NLP/"/>
    
    
      <category term="NLP" scheme="http://shukebeta.me/tags/NLP/"/>
    
      <category term="Algorithm" scheme="http://shukebeta.me/tags/Algorithm/"/>
    
      <category term="Trie" scheme="http://shukebeta.me/tags/Trie/"/>
    
      <category term="KMP" scheme="http://shukebeta.me/tags/KMP/"/>
    
      <category term="Ahoâ€“Corasick algorithm" scheme="http://shukebeta.me/tags/Aho%E2%80%93Corasick-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>ä½æ“ä½œ - æ±‰æ˜è·ç¦»</title>
    <link href="http://shukebeta.me/bits-operations-06/"/>
    <id>http://shukebeta.me/bits-operations-06/</id>
    <published>2018-09-24T16:00:00.000Z</published>
    <updated>2018-10-10T03:26:37.010Z</updated>
    
    <content type="html"><![CDATA[<p>æ±‚ä¸¤ä¸ªæ•´æ•°çš„æ±‰æ˜è·ç¦» hamming distance<br><a id="more"></a><br><a href="https://leetcode.com/problems/hamming-distance/description/" target="_blank" rel="noopener">Leetcode 461</a><br>ä¸¤ä¸ªæ•´æ•°ä¹‹é—´çš„æ±‰æ˜è·ç¦»æ˜¯è¯¥ä¸¤ä¸ªæ•°ä¹‹é—´ä¸åŒçš„ä½æ•°ã€‚ ç»™å®šä¸¤ä¸ªæ•´æ•°xå’Œyï¼Œè®¡ç®—æ±‰æ˜è·ç¦»ã€‚é—®é¢˜ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯¹äºä¸¤ä¸ªæ•´æ•°<code>m</code>å’Œ<code>n</code>, éœ€è¦æ”¹å˜<code>m</code>çš„äºŒè¿›åˆ¶å¤šå°‘ä½æ‰èƒ½å¾—åˆ°<code>n</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Use Brian Kernighan's way to count bits */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hammingDistance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    x = x ^ y;</span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x != <span class="number">0</span>)&#123;</span><br><span class="line">        y++;</span><br><span class="line">        x &amp;= x - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hammingDistance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.bitCount(x ^ y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ç”¨åˆ°Brian Kernighanç®—æ³•ï¼š</p><blockquote><p>Lets say that the bit at index n is 1 and that the bits in indexes 0 up to <code>n-1</code> are all 0 (weâ€™ll use little endianess - so index 0 is 1, index 1 is 2, index 2 is 4, index 3 is 8 and so on).</p></blockquote><blockquote><p><code>v-1</code> subtracts from index 0 - but itâ€™s 0, so it converts it to 1 and subtracts from index 1 - but itâ€™s also 0, so it converts it to 1 and subtracts from index 2 - and so on until we reach index n. Since index n is 1 it can subtract from it and turn it to 0 - and there it stops: <code>1101000 - 1 = 1100111</code></p></blockquote><blockquote><p>So, <code>v-1</code> is like <code>v</code> except there are <code>n</code> 0 that became 1 and one 1 that became 0. In <code>v &amp; v - 1</code> all the other bits remain as is, the <code>n</code> zeros that where turned to ones remain 0 (because <code>0 &amp; 1 == 0</code>), and the one 1 that was turned to 0 turns to 0(because <code>1 &amp; 0 == 0</code>). So overall - only a single bit was changed in the iteration, and this change was from 1 to 0: <code>1101000 &amp; 1100111 = 1100000</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ±‚ä¸¤ä¸ªæ•´æ•°çš„æ±‰æ˜è·ç¦» hamming distance&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Software Engineer" scheme="http://shukebeta.me/tags/Software-Engineer/"/>
    
      <category term="Algorithms" scheme="http://shukebeta.me/tags/Algorithms/"/>
    
      <category term="Computer Science" scheme="http://shukebeta.me/tags/Computer-Science/"/>
    
  </entry>
  
  <entry>
    <title>ä½æ“ä½œ - æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„æ•° - åŠç±»ä¼¼é—®é¢˜</title>
    <link href="http://shukebeta.me/bits-operations-04/"/>
    <id>http://shukebeta.me/bits-operations-04/</id>
    <published>2018-09-23T16:00:00.000Z</published>
    <updated>2018-10-16T10:30:09.411Z</updated>
    
    <content type="html"><![CDATA[<p>â€œæ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„æ•°â€ï¼Œ â€œæ‰¾å‡ºå”¯äºŒçš„åªå‡ºç°Mæ¬¡çš„æ•°â€ï¼Œ â€œæ‰¾å‡ºç¼ºå¤±çš„æ•°â€ç­‰ç­‰ï¼Œéƒ½å¯ä»¥åˆ©ç”¨å¼‚æˆ–æ“ä½œçš„ç‰¹æ€§ï¼Œ å³ä¸€ä¸ªæ•´æ•°å’Œè‡ªå·±è¿›è¡Œå¼‚æˆ–è¿ç®—ä¼šå½’0çš„æ€§è´¨ã€‚</p><h2 id="æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°"><a href="#æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°" class="headerlink" title="æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°"></a>æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°</h2><p>åœ¨ä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ï¼Œå·²çŸ¥å…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚<br><a id="more"></a><br>è¦è¾¾åˆ°O(n)å¤æ‚åº¦éœ€è¦åˆ©ç”¨<strong>ä½å¼‚æˆ–</strong>. ä½å¼‚æˆ–è¿ç®—èƒ½å¤ŸæŠŠäºŒè¿›åˆ¶ç›¸åŒçš„æ•°åŒ–ä¸º0. æŠŠæ•°ç»„æ‰€æœ‰çš„æ•°éƒ½å¼‚æˆ–, å‡ºç°ä¸¤æ¬¡çš„æ•°å°±ä¼šäº’ç›¸æŠµæ¶ˆä¸º0, å‰©ä½™çš„å°±æ˜¯é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> output = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : nums)</span><br><span class="line">        output ^= i;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†å¦‚æœæŠŠé—®é¢˜æ‰©å±•ä¸ºâ€œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸‰æ¬¡â€ï¼Œ è¿™æ ·å°±æ— æ³•ç›´æ¥åˆ©ç”¨å¼‚æˆ–æŠµæ¶ˆçš„æ€§è´¨äº†ã€‚å‰‘æŒ‡Offerçš„è§£æ³•æ˜¯ç”¨ä¸€ä¸ªé•¿åº¦<code>32</code>çš„æ•°ç»„<code>bitSum</code>, æŠŠåŸæ•°ç»„æ‰€æœ‰æ•´æ•°çš„äºŒè¿›åˆ¶æ¯ä¸€ä½åˆ†åˆ«ç´¯åŠ åˆ°<code>bitSum</code>é‡Œé¢, è¿™æ ·å°±å¯ä»¥é€šè¿‡åˆ¤æ–­<code>bitSum</code>å“ªäº›ä½ä¸å¯ä»¥è¢«3æ•´é™¤æ¥æ‰¾å‡ºé‚£ä¸ªæ•°:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] bitSum = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> bitMask = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">31</span>; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> b = nums[i] &amp; bitMask;</span><br><span class="line">            <span class="keyword">if</span> (b != <span class="number">0</span>)</span><br><span class="line">                bitSum[j] += <span class="number">1</span>;</span><br><span class="line">            bitMask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        res &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        res += bitSum[i] % <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å› ä¸º<code>bitSum</code>çš„é•¿åº¦æ˜¯å¸¸æ•°, æ‰€ä»¥è¯¥æ–¹æ³•å¤æ‚åº¦è¿˜æ˜¯O(N). è¯¥æ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•é—®é¢˜ä¸ºæ±‚å”¯ä¸€ä¸€ä¸ªå…ƒç´ å‡ºç°Mæ¬¡ï¼Œå…¶ä»–æ‰€æœ‰å…ƒç´ å‡ºç°Kæ¬¡çš„é—®é¢˜ã€‚</p><p>é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰å…¶ä»–æ›´ç²¾ç®€çš„é€šç”¨çš„æ–¹æ³•æ¥è§£å†³æ­¤ç±»é—®é¢˜.</p><h3 id="æ„é€ çŠ¶æ€è½¬ç§»è¡¨"><a href="#æ„é€ çŠ¶æ€è½¬ç§»è¡¨" class="headerlink" title="æ„é€ çŠ¶æ€è½¬ç§»è¡¨"></a>æ„é€ çŠ¶æ€è½¬ç§»è¡¨</h3><p>æ–¹æ³•æ¥è‡ª<a href="https://leetcode.com/problems/single-number-ii/discuss/43296/An-General-Way-to-Handle-All-this-sort-of-questions." target="_blank" rel="noopener">An General Way to Handle All this sort of questions</a>, è¿™ä¸ªæ–¹æ³•æ ¸å¿ƒæ€æƒ³æ˜¯å»ºç«‹ä¸€ä¸ªè®°å½•çŠ¶æ€çš„å˜é‡, è¯¥å˜é‡ä»£è¡¨æŸä¸ªæ•°å­—å‡ºç°ä¸€æ¬¡åçš„çŠ¶æ€. ç›®æ ‡å°±æ˜¯ä½¿å¾—ä¸€ä¸ªæ•°å­—é‡å¤å‡ºç°Kæ¬¡åçŠ¶æ€åˆšå¥½å½’0.</p><p>å¯¹äº<code>K=2</code>, å°±è¦ä½¿ä¸¤æ¬¡å åŠ åå½’0, éœ€è¦ä¸¤ç§çŠ¶æ€, ä»ä¿¡æ¯è®ºçš„è§’åº¦çœ‹å¾…, åªéœ€è¦ä¸€ä¸ªä½(<code>0</code>,<code>1</code>)æ¥è¡¨è¾¾ï¼ŒçŠ¶æ€<code>0</code>å¯¹åº”ç€ä¸¤ç§ç­‰ä»·çš„æƒ…å†µ: ä¸€ä¸ªæ•°å­—å®Œå…¨æ²¡å‡ºç°è¿‡, æˆ–è€…å‡ºç°äº†2æ¬¡åä¸€èµ·æŠµæ¶ˆé‡ç½®. çŠ¶æ€<code>1</code>å¯¹åº”ç€ä»…ä»…å‡ºç°ä¸€æ¬¡çš„æƒ…å†µ. åœ¨è¿™é‡Œæ•°å­—å’ŒçŠ¶æ€æ¦‚å¿µç­‰ä»·ï¼Œæ„å»ºä¸€ä¸ªçŠ¶æ€è½¬ç§»è¡¨ï¼ˆçœŸå€¼è¡¨ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">çŠ¶æ€ è¾“å…¥ è¾“å‡º</span><br><span class="line">a    c    a</span><br><span class="line">0    0    0</span><br><span class="line">1    0    1</span><br><span class="line">0    1    1</span><br><span class="line">1    1    0</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯çŠ¶æ€1è¿˜æ˜¯0ï¼Œå¦‚æœè¾“å…¥ç›¸åŒæ•°å­—ï¼Œå°±ä¼šå˜ä¸º0ï¼›å¦‚æœè¾“å…¥ä¸åŒçš„æ•°å­—ï¼Œå°±ä¼šå˜ä¸º1. æ ¹æ®è¡¨å†™å‡ºé€»è¾‘è¡¨è¾¾å¼ä¸ºå¼‚æˆ–è¿ç®—.</p><p>æ ¹æ®çœŸå€¼è¡¨å†™å‡ºé€»è¾‘å¼çš„åŸºæœ¬å¥—è·¯æ˜¯: åªçœ‹è¾“å‡ºç»“æœä¸º1çš„è½¬ç§», å‡¡å–å€¼ä¸º1çš„å˜é‡å†™æˆåŸå˜é‡ï¼Œå–å€¼ä¸º0çš„å˜é‡å†™æˆåå˜é‡, å¾—å‡ºå¯¹åº”çš„è¡¨è¾¾å¼, å†æŠŠæ‰€æœ‰è½¬ç§»æ–¹ç¨‹çš„è¡¨è¾¾å¼åŠ èµ·æ¥. å¦‚è¾“å‡ºä¸º1çš„æ˜¯<code>0 &amp; 1 = 1, 1 &amp; 0 = 1</code>, è¡¨è¾¾å¼å°±æ˜¯<code>(~a &amp; c) | (a &amp; ~c)</code>, è¿™ä¸ªæœ¬è´¨ä¸Šå°±æ˜¯<code>a ^ c</code></p><p>å¯¹äº<code>K = 3, M = 1(or 2)</code>, éœ€è¦ä¸‰ç§çŠ¶æ€, é‚£ä¹ˆè‡³å°‘éœ€è¦ä¸¤ä¸ªä½(<code>00</code>, <code>01</code>, <code>10</code>)æ¥è¡¨è¾¾. è®©çŠ¶æ€<code>00</code>å¯¹åº”â€å‡â€è¾“å‡º, å¯¹åº”ä¸¤ç§ç­‰ä»·çš„æƒ…å†µ: ä¸€ä¸ªæ•°å­—å®Œå…¨æ²¡å‡ºç°è¿‡, æˆ–è€…å‡ºç°äº†3æ¬¡åä¸€èµ·æŠµæ¶ˆé‡ç½®. å†å®šä¹‰<code>01</code>ä¸ºå‡ºç°äº†ä¸€æ¬¡çš„çŠ¶æ€, <code>10</code>ä¸ºå‡ºç°äº†2æ¬¡, è¿™ä¸¤ç§çŠ¶æ€éƒ½å¯¹åº”ç€â€çœŸâ€è¾“å‡º, ä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆ, å¾—å‡ºçŠ¶æ€è½¬ç§»ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">çŠ¶æ€      è¾“å…¥      è¾“å‡º</span><br><span class="line">(a, b)    (c)      (a,b)</span><br><span class="line">0, 0   0   0, 0</span><br><span class="line">0, 1   0   0, 1</span><br><span class="line">1, 0   0   1, 0</span><br><span class="line">0, 0   1   0, 1</span><br><span class="line">0, 1   1   1, 0</span><br><span class="line">1, 0   1   0, 0</span><br></pre></td></tr></table></figure></p><p>å¾—å‡º<code>a = (a &amp; ~b &amp; ~c) | (~a &amp; b &amp; c)</code>, <code>b = (~a &amp; b &amp; ~c) | (~a &amp; ~b &amp; c)</code>.<br>åªè¦æŠŠæ•°ç»„æ‰€æœ‰æ•°æŒ‰ç…§è¿™ä¸ªé€»è¾‘åˆ†åˆ«å åŠ åˆ°<code>a</code>å’Œ<code>b</code>ä¸Šé¢, æœ€åç­”æ¡ˆå°±æ˜¯<code>a | b</code>.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c : nums)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> temp = (a &amp; ~b &amp; ~c) | (~a &amp; b &amp; c);</span><br><span class="line">        b = (~a &amp; b &amp; ~c) | (~a &amp; ~b &amp; c);</span><br><span class="line">        a = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (a | b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šåªæ˜¯ä¸€ç§é€šç”¨çš„å¥—è·¯ï¼Œå¯¹äºæ¯ä¸€ç§ç‰¹å®šçš„<code>K, M</code>ç»„åˆ, å¯èƒ½ä¼šæœ‰ä¸åŒçš„ç‰¹æ®Šæœ€ä¼˜æ–¹æ¡ˆ.</p><h3 id="é€šè¿‡ä¸åŒé›†åˆæ”¶å½•ä¸åŒæ•°å­—"><a href="#é€šè¿‡ä¸åŒé›†åˆæ”¶å½•ä¸åŒæ•°å­—" class="headerlink" title="é€šè¿‡ä¸åŒé›†åˆæ”¶å½•ä¸åŒæ•°å­—"></a>é€šè¿‡ä¸åŒé›†åˆæ”¶å½•ä¸åŒæ•°å­—</h3><p>åŒä¸Šé¢çš„é—®é¢˜ï¼ŒLeetCodeæŸå¤§ç¥ç»™å‡ºä¸€ä¸ª<a href="https://leetcode.com/problems/single-number-ii/discuss/43294/Challenge-me-thx" target="_blank" rel="noopener">ç›®å‰ä¸ºæ­¢æœ€ä¼˜çš„æ–¹æ¡ˆ</a>, å¹¶æ”¾è¨€â€Challenge meâ€, è‰é¸¡ä»¬çœ‹äº†ç‘Ÿç‘Ÿå‘æŠ–ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ones = <span class="number">0</span>, twos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c : nums)</span><br><span class="line">    &#123;</span><br><span class="line">        ones = (ones ^ c) &amp; ~twos;</span><br><span class="line">        twos = (twos ^ c) &amp; ~ones;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ones;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŸç†æ˜¯åˆ©ç”¨ä¸¤ä¸ªæ•°<code>ones</code>å’Œ<code>twos</code>ä½œä¸ºä¸€ç§æ¦‚å¿µä¸Šçš„é›†åˆ<code>set</code>ï¼Œé€šè¿‡å¼‚æˆ–æ“ä½œæ¥æ”¶å½•åˆ†åˆ«å‡ºç°äº†1æ¬¡å’Œ2æ¬¡çš„æ•°, <code>set ^ val</code>æœ‰ä¸¤ç§ç»“æœ:</p><ul><li>å¦‚æœ<code>set</code>é‡Œé¢æ²¡æœ‰<code>val</code>, æŠŠ<code>val</code>å¼‚æˆ–è¿›å», å¦‚<code>a ^ 0 = a</code></li><li>å¦‚æœ<code>set</code>ä¹‹å‰å·²ç»æ”¶å½•äº†<code>val</code>, é‚£ä¹ˆäº¦æˆ–æ“ä½œå°±ä¼šåœ¨<code>set</code>ä¸­ç§»é™¤è¿™ä¸ª<code>val</code>, å¦‚ <code>a ^ a = 0</code></li></ul><p>æŒ‰ç…§ä¸Šé¢çš„å®šä¹‰æ¥ç†è§£:</p><ul><li><code>(ones ^ c) &amp; ~twos</code>: å½“ä¸”ä»…å½“<code>c</code>æ²¡æœ‰æ”¶å½•åœ¨<code>twos</code>ä¸­, æŠŠ<code>ones</code>æ”¶å½•<code>c</code>ï¼Œå¦åˆ™ç§»é™¤<code>c</code>ã€‚è¿™æ ·çš„è¯ï¼Œä»»ä½•ç¬¬ä¸€æ¬¡å‡ºç°çš„æ•°éƒ½ä¼šè¢«æ”¶å…¥<code>ones</code>ä¸­, è€Œä»»ä½•ç¬¬äºŒæ¬¡å‡ºç°çš„æ•°ä¼šä»<code>ones</code>ä¸­ç§»å‡º.<br>So, effectively anything that appears for the first time will be in the set. Anything that appears a second time will be removed. Weâ€™ll see what happens when an element appears a third time (thats handled by the set â€œtwosâ€).</li><li>ç´§æ¥ç€, <code>(twos ^ c) &amp; ~ones</code>ç”¨åŒæ ·çš„é€»è¾‘æ›´æ–°<code>twos</code>. è¿™æ ·æ„å‘³ç€<ul><li><code>twos</code>ä¸ä¼šæ”¶å½•ç¬¬ä¸€æ¬¡å‡ºç°çš„æ•°;</li><li>ä½†å¯¹äºç¬¬äºŒæ¬¡å‡ºç°çš„æ•°, å› ä¸ºä¸Šä¸€æ­¥å·²ç»æŠŠè¿™ä¸ªæ•°ä»<code>ones</code>ä¸­ç§»é™¤, é‚£ä¹ˆè¿™ä¸ªæ•°å°±ä¼šè¢«æ”¶å½•è¿›<code>twos</code>ä¸­,</li><li>å¯¹äºç¬¬ä¸‰æ¬¡å‡ºç°çš„æ•°, å› ä¸º<code>twos</code>ä¸­å·²ç»æ”¶å½•äº†, æ‰€ä»¥<code>ones</code>ä¸ä¼šå†æ”¶å½•, è€Œå¼‚æˆ–æ“ä½œä¼šæŠŠ<code>twos</code>ä¸­çš„è¿™ä¸ªæ•°ç§»é™¤.</li></ul></li></ul><p>æœ€åçš„ç»“æœå°±æ˜¯, <code>ones</code>ä»…ä¿ç•™å‡ºç°äº†1æ¬¡çš„æ•°, <code>twos</code>ä»…ä¿ç•™å‡ºç°äº†2æ¬¡çš„æ•°, è€Œé‚£äº›å‡ºç°äº†3æ¬¡çš„æ•°éƒ½è¢«ç§»é™¤äº†.</p><p>è¿™ç§æ–¹æ³•å¯ä»¥æ‰©å±•ä¸ºé€šç”¨æ–¹æ³•, é€‚ç”¨äºä»»ä½•ä»…å­˜åœ¨ä¸€ä¸ªåªå‡ºç°äº†<code>M</code>æ¬¡çš„æ•°, å…¶ä»–æ•°éƒ½å‡ºç°äº†<code>K</code>æ¬¡çš„æ•°ç»„, å¦‚<code>K = 4, M = 3</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ones = <span class="number">0</span>, twos = <span class="number">0</span>, threes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> c : nums)</span><br><span class="line">    &#123;</span><br><span class="line">        ones = (ones ^ c) &amp; ~twos &amp; ~threes;</span><br><span class="line">        twos = (twos ^ c) &amp; ~ones &amp; ~threes;</span><br><span class="line">        threes = (threes ^ c) &amp; ~twos &amp; ~ones;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> threes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] nums = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    System.out.println(singleNumber(nums)); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ‰¾å‡ºå”¯äºŒçš„ä»…å‡ºç°Mæ¬¡çš„æ•°"><a href="#æ‰¾å‡ºå”¯äºŒçš„ä»…å‡ºç°Mæ¬¡çš„æ•°" class="headerlink" title="æ‰¾å‡ºå”¯äºŒçš„ä»…å‡ºç°Mæ¬¡çš„æ•°"></a>æ‰¾å‡ºå”¯äºŒçš„ä»…å‡ºç°Mæ¬¡çš„æ•°</h2><p><a href="https://leetcode.com/problems/single-number-iii/" target="_blank" rel="noopener">LeetCodeåŸé¢˜</a>:ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„<code>nums</code>ï¼Œå…¶ä¸­æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚ æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´ ã€‚è·Ÿå‰é¢çš„é—®é¢˜ç±»ä¼¼, æˆ‘ä»¬éœ€è¦å†æ¬¡ä½¿ç”¨XORæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡åˆ†å‰²æ•°ç»„, æŠŠå‡ºç°ä¸€æ¬¡çš„ä¸¤ä¸ªæ•°, åˆ’åˆ†åˆ°ä¸åŒçš„æ•°ç»„ä¸­, é—®é¢˜å°±è½¬åŒ–ä¸ºå¯»æ‰¾å”¯ä¸€çš„å‡ºç°ä¸€æ¬¡çš„æ•°é—®é¢˜. æ‰€ä»¥å…³é”®å°±æ˜¯å¦‚ä½•æ‹†åˆ†æ•°ç»„.</p><p>å…·ä½“éœ€è¦ä¸¤æ¬¡éå†ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡éå†ï¼Œå¯¹æ•°ç»„æ‰€æœ‰å…ƒç´ è¿›è¡Œå¼‚æˆ–ï¼Œè·å¾—è¦æ‰¾çš„ä¸¤ä¸ªæ•°å­—çš„XORã€‚ç”±äºä¸¤ä¸ªæ•°å­—æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åœ¨XORç»“æœä¸­å¿…å®šæœ‰ä¸€ä¸ª<code>set bit</code>, å³ä½å€¼ä¸ºâ€™1â€™çš„ä½ã€‚</li><li>æ‰¾å‡ºä»»æ„<code>set bit</code>ï¼ˆå¦‚æœ€å³è¾¹çš„ï¼‰ã€‚</li><li>ç¬¬äºŒæ¬¡éå†ï¼Œå°†æ‰€æœ‰æ•°å­—åˆ†æˆä¸¤ç»„: ä¸€ç»„ä¸ºå…·æœ‰ä¸Šè¿°<code>set bit</code>çš„æ•°, å¦ä¸€ç»„æ²¡æœ‰ã€‚æŒ‰ç…§è¿™ç§æ–¹æ³•åˆ†ç»„, ç›¸åŒçš„æ•°å­—ä¸€å®šä¼šè¢«åˆ†é…åˆ°åŒä¸€ç»„ä¸­, è€Œä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°ä¼šåˆ†é…åˆ°ä¸åŒæ•°ç»„ä¸­ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**ä»£ç æ¥è‡ª: https://leetcode.com/problems/single-number-iii/discuss/68900/Accepted-C%2B%2BJava-O(n)-time-O(1)-space-Easy-Solution-with-Detail-Explanations</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] singleNumber(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        <span class="comment">// Pass 1 :</span></span><br><span class="line">        <span class="comment">// Get the XOR of the two numbers we need to find</span></span><br><span class="line">        <span class="keyword">int</span> diff = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">            diff ^= num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Get its last set bit</span></span><br><span class="line">        diff &amp;= -diff;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Pass 2 :</span></span><br><span class="line">        <span class="keyword">int</span>[] rets = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;; <span class="comment">// this array stores the two numbers we will return</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((num &amp; diff) == <span class="number">0</span>) <span class="comment">// the bit is not set</span></span><br><span class="line">            &#123;</span><br><span class="line">                rets[<span class="number">0</span>] ^= num;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="comment">// the bit is set</span></span><br><span class="line">            &#123;</span><br><span class="line">                rets[<span class="number">1</span>] ^= num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rets;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾å‡ºç¼ºå¤±çš„æ•°"><a href="#æ‰¾å‡ºç¼ºå¤±çš„æ•°" class="headerlink" title="æ‰¾å‡ºç¼ºå¤±çš„æ•°"></a>æ‰¾å‡ºç¼ºå¤±çš„æ•°</h2><p>ç»™å®šä¸€ä¸ªåŒ…å«nä¸ªä¸åŒæ•°å­—çš„æ•°ç»„ï¼Œå–è‡ª<code>0,1,2,...,n</code>ï¼Œæ‰¾åˆ°æ•°ç»„ä¸­ç¼ºå°‘çš„æ•°å­—ã€‚æŠŠæ‰€æœ‰æ•°å­—å’Œç´¢å¼•<code>0 ~ n</code>å–å¼‚æˆ–, ç´¢å¼•æ˜¯å®Œæ•´çš„, ä½†æ•°å­—ç¼ºå¤±äº†ä¸€ä¸ª, æœ€åå¾—åˆ°çš„å°±ä¸€å®šæ˜¯é‚£ä¸ªç¼ºå¤±çš„æ•°.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> miss = nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++)</span><br><span class="line">        miss ^= (nums[i] ^ i);</span><br><span class="line">    <span class="keyword">return</span> miss;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥é€šè¿‡æ±‚ç­‰å·®æ•°åˆ—å’Œï¼Œ ç„¶åå‡å»å®é™…çš„æ•°ç»„å’Œï¼Œå¾—å‡ºç¼ºå¤±çš„æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;â€œæ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„æ•°â€ï¼Œ â€œæ‰¾å‡ºå”¯äºŒçš„åªå‡ºç°Mæ¬¡çš„æ•°â€ï¼Œ â€œæ‰¾å‡ºç¼ºå¤±çš„æ•°â€ç­‰ç­‰ï¼Œéƒ½å¯ä»¥åˆ©ç”¨å¼‚æˆ–æ“ä½œçš„ç‰¹æ€§ï¼Œ å³ä¸€ä¸ªæ•´æ•°å’Œè‡ªå·±è¿›è¡Œå¼‚æˆ–è¿ç®—ä¼šå½’0çš„æ€§è´¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°&quot;&gt;&lt;a href=&quot;#æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°&quot; class=&quot;headerlink&quot; title=&quot;æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°&quot;&gt;&lt;/a&gt;æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªä»…å‡ºç°Mæ¬¡çš„æ•°&lt;/h2&gt;&lt;p&gt;åœ¨ä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ï¼Œå·²çŸ¥å…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Software Engineer" scheme="http://shukebeta.me/tags/Software-Engineer/"/>
    
      <category term="Algorithms" scheme="http://shukebeta.me/tags/Algorithms/"/>
    
      <category term="Computer Science" scheme="http://shukebeta.me/tags/Computer-Science/"/>
    
  </entry>
  
  <entry>
    <title>ä½æ“ä½œ - ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°</title>
    <link href="http://shukebeta.me/bits-operations-05/"/>
    <id>http://shukebeta.me/bits-operations-05/</id>
    <published>2018-09-22T16:00:00.000Z</published>
    <updated>2018-10-16T03:13:41.605Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°"><a href="#ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°" class="headerlink" title="ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°"></a>ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°</h2><p>ä¸èƒ½ä½¿ç”¨<code>+</code>å’Œ<code>-</code>, ä»…é€šè¿‡<code>^</code>å’Œ<code>&amp;</code>æ“ä½œæ¥æ±‚å’Œä¸¤ä¸ªæ•´æ•°<code>a</code>.<br><a id="more"></a><br>å‚è€ƒ<a href="https://www.cnblogs.com/kiven-code/archive/2012/09/15/2686922.html" target="_blank" rel="noopener"></a><br>æ¯ä½ç›¸åŠ å¯èƒ½ä¼šäº§ç”Ÿè¿›ä½(carry), æ‰€ä»¥å¯ä»¥æŠŠç›¸åŠ æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†, å¦‚<code>759 + 674</code>å¯ä»¥æ‹†åˆ†ä¸ºä¸è€ƒè™‘è¿›ä½çš„éƒ¨åˆ†<code>323</code>å’Œä»…è€ƒè™‘è¿›ä½çš„éƒ¨åˆ†<code>1110</code>, æ•…<code>759 + 674 = 323 + 1110 = 1433</code>.</p><p>äºŒè¿›åˆ¶çš„åŠ æ³•ä¹Ÿæ˜¯ä»ä½ä½å¼€å§‹é€æ­¥å¾€é«˜ä½è®¡ç®—:</p><ol><li>è¿›è¡Œä¸€ä½äºŒè¿›åˆ¶çš„åŠ æ³•, ä¹Ÿå°±æ˜¯æš‚ä¸è€ƒè™‘è¿›ä½çš„ä½ç›¸åŠ : <code>0+0=0ï¼Œ 0+1=1, 1+0=1ï¼Œ 1+1=0</code>, é‚£ä¹ˆå°±æ˜¯<code>^</code>æ“ä½œ. æ‰€å¾—çš„å’Œä½œä¸ºæ–°çš„<code>a</code>.</li><li>æ±‚è¿›ä½: é€šè¿‡<code>a &amp; b</code>åˆ¤æ–­æ˜¯å¦è¿›ä½, å› ä¸ºåªæœ‰ä¸¤ä¸ªä½å‡ä¸º<code>1</code>æ‰ä¼šè¿›ä½. æ‰€å¾—çš„è¿›ä½å·¦ç§»ä¸€ä½ä½œä¸ºæ–°çš„<code>b</code>.</li><li>ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹, æŠŠä½ä½çš„è¿›ä½ä¼ é€’åˆ°é«˜ä½, ç´¯åŠ åˆ°<code>a</code>ä¸­, ç›´åˆ°è¿›ä½ä¸º<code>0</code>, æœ€åå¾—åˆ°çš„<code>a</code>å°±æ˜¯ç­”æ¡ˆ.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (b != <span class="number">0</span>) &#123; <span class="comment">// å…³é”®åœ¨äºåˆ¤æ–­ç»ˆæ­¢çš„æ—¶æœº</span></span><br><span class="line"><span class="keyword">int</span> c = a &amp; b; <span class="comment">//carry</span></span><br><span class="line">a ^= b; <span class="comment">//add</span></span><br><span class="line">b = c &lt;&lt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶‰åŠçš„è¿ç®—å°±æ˜¯ä¸€ä¸ªå¤šä½äºŒè¿›åˆ¶åŠ æ³•çœŸå€¼è¡¨ï¼š(å¯¹åº”äºç¡¬ä»¶ä¸­çš„å…¨åŠ å™¨)</p><blockquote><p>å…¨åŠ å™¨ï¼ˆfull adderï¼‰å°†ä¸¤ä¸ªä¸€ä½äºŒè¿›åˆ¶æ•°ç›¸åŠ ï¼Œå¹¶æ ¹æ®æ¥æ”¶åˆ°çš„ä½ä½è¿›ä½ä¿¡å·ï¼Œè¾“å‡ºå’Œã€è¿›ä½è¾“å‡ºã€‚å…¨åŠ å™¨çš„ä¸‰ä¸ªè¾“å…¥ä¿¡å·ä¸ºä¸¤ä¸ªåŠ æ•°Aã€Bå’Œä½ä½è¿›ä½Cinã€‚å…¨åŠ å™¨é€šå¸¸å¯ä»¥é€šè¿‡çº§è”ï¼ˆcascadeï¼‰çš„æ–¹å¼ï¼Œæ„æˆå¤šä½ï¼ˆå¦‚8ä½ã€16ä½ã€32ä½ï¼‰äºŒè¿›åˆ¶æ•°åŠ æ³•å™¨çš„åŸºæœ¬éƒ¨åˆ†ã€‚å…¨åŠ å™¨çš„è¾“å‡ºå’ŒåŠåŠ å™¨ç±»ä¼¼ï¼ŒåŒ…æ‹¬å‘é«˜ä½çš„è¿›ä½ä¿¡å·Coutå’Œæœ¬ä½çš„å’Œä¿¡å·Sï¼Œç›¸åŠ ç»“æœçš„æ€»å’Œè¡¨è¾¾ä¸º ${\displaystyle \mathrm {sum} =2\times C_{out}+S}$ã€‚</p></blockquote><p><img src="/images/full_adder.png" alt="" title="image from https://en.wikipedia.org/wiki/Adder_(electronics)"><br>è§„åˆ™æ˜¯<br><code>s = (x ^ y) ^ Cin</code><br><code>Cout = (x &amp; y) | (y &amp; Cin) | (x &amp; Cin)</code></p><p>æ›´ç®€å•çš„ç‰ˆæœ¬:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getSum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : getSum(a ^ b, (a &amp; b) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ä¸ä½¿ç”¨ç¼“å­˜äº¤æ¢æ•´æ•°"><a href="#ä¸ä½¿ç”¨ç¼“å­˜äº¤æ¢æ•´æ•°" class="headerlink" title="ä¸ä½¿ç”¨ç¼“å­˜äº¤æ¢æ•´æ•°"></a>ä¸ä½¿ç”¨ç¼“å­˜äº¤æ¢æ•´æ•°</h2><p>åˆ©ç”¨ä¸€ä¸ªæ•´æ•°å’Œè‡ªå·±è¿›è¡Œå¼‚æˆ–è¿ç®—ä¼šå½’0çš„æ€§è´¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] exchangeAB(<span class="keyword">int</span>[] AB) &#123;</span><br><span class="line">   AB[<span class="number">0</span>] = AB[<span class="number">0</span>] ^ AB[<span class="number">1</span>];</span><br><span class="line">   AB[<span class="number">1</span>] = AB[<span class="number">0</span>] ^ AB[<span class="number">1</span>]; <span class="comment">// åªå‰©ä¸‹AB[0]</span></span><br><span class="line">   AB[<span class="number">0</span>] = AB[<span class="number">0</span>] ^ AB[<span class="number">1</span>]; <span class="comment">// åªå‰©ä¸‹AB[1]</span></span><br><span class="line">   <span class="keyword">return</span> AB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ å‡æ³•æ¥æ“ä½œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] exchangeAB(<span class="keyword">int</span>[] AB) &#123;</span><br><span class="line">   AB[<span class="number">0</span>] = AB[<span class="number">0</span>] + AB[<span class="number">1</span>];</span><br><span class="line">   AB[<span class="number">1</span>] = AB[<span class="number">0</span>] - AB[<span class="number">1</span>]; <span class="comment">// åªå‰©ä¸‹AB[0]</span></span><br><span class="line">   AB[<span class="number">0</span>] = AB[<span class="number">0</span>] - AB[<span class="number">1</span>]; <span class="comment">// åªå‰©ä¸‹AB[1]</span></span><br><span class="line">   <span class="keyword">return</span> AB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°&quot;&gt;&lt;a href=&quot;#ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°&quot; class=&quot;headerlink&quot; title=&quot;ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°&quot;&gt;&lt;/a&gt;ä¸ä½¿ç”¨åŠ å‡ç¬¦å·æ±‚å’Œæ•´æ•°&lt;/h2&gt;&lt;p&gt;ä¸èƒ½ä½¿ç”¨&lt;code&gt;+&lt;/code&gt;å’Œ&lt;code&gt;-&lt;/code&gt;, ä»…é€šè¿‡&lt;code&gt;^&lt;/code&gt;å’Œ&lt;code&gt;&amp;amp;&lt;/code&gt;æ“ä½œæ¥æ±‚å’Œä¸¤ä¸ªæ•´æ•°&lt;code&gt;a&lt;/code&gt;.&lt;br&gt;
    
    </summary>
    
      <category term="CS" scheme="http://shukebeta.me/categories/CS/"/>
    
    
      <category term="Software Engineer" scheme="http://shukebeta.me/tags/Software-Engineer/"/>
    
      <category term="Algorithms" scheme="http://shukebeta.me/tags/Algorithms/"/>
    
      <category term="Computer Science" scheme="http://shukebeta.me/tags/Computer-Science/"/>
    
  </entry>
  
</feed>
